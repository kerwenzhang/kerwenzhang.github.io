---                
layout: post                
title: "FTBatch Equipment Editor User Manual"                
date:   2025-6-27 17:30:00                 
categories: "FTBatch"                
catalog: true                
tags:                 
    - FTBatch                
---      

使用 FactoryTalk Batch 设备编辑器创建和维护设备数据库。区域模型(Area Model)是批量生产设施的物理组件，该数据库包含设施中的所有设备及其能够执行的所有任务。区域模型(Area Model)存储在扩展名为 .cfg 的文件中，可供所有其他 FactoryTalk Batch 程序使用，包括 FactoryTalk Batch 配方编辑器、FactoryTalk Batch 视图和阶段模拟器。  

例如，在配方配置期间，区域模型(Area Model)会提供可用单元和阶段的列表。在后续的配方验证过程中，它会验证指定设备是否能够执行相关程序。在配方执行期间，资源仲裁功能会使用区域模型(Area Model)根据配方和操作员请求分配设备。  

仲裁是一种协调控制方式，用于确定当资源请求数量超过其同一时间可容纳的数量时，资源应如何分配。    

根据 ISA S88.01 批量控制标准的概述，工厂区域模型(Area Model)按以下模型组件组织：  
- 工艺单元（Process Cell）  
- 设备单元（Unit）  
- 阶段（Phase）  
- 控制模块（Control Module）  

除创建区域模型(Area Model)外，FactoryTalk Batch 设备编辑器还可：  
- 定义电子签名和配方审批签核的签名模板。  
- 配置配方审批的步骤和签核环节。  
- 启用配方版本控制。  
- 使用安全权限保护区域模型(Area Model)。  
- 指定服务器通信功能。  
- 指定 FactoryTalk 事件归档器筛选器和报告选项。  


### 区域模型(Area Model)Area Model  

区域模型(Area Model)定义了与FactoryTalk Batch服务器交互的制造设施能力。设施信息存储在通过FactoryTalk Batch设备编辑器构建的配置文件中，并保存为.cfg扩展名的文件（如SouthPlant.cfg）。  

区域模型(Area Model)包含用于创建批次的工艺设备信息，包括为特定物理工厂某一区域配置的所有设备。一个区域模型(Area Model)对应单个FactoryTalk Batch服务器，其配置文件（.cfg）可供FactoryTalk Batch配方编辑器、FactoryTalk Batch服务器和阶段模拟器使用。  

**创建区域模型(Area Model)的顺序**：  
- 枚举（Enumerations）  
- 数据服务器（Data servers）  
- 资源（Resources）  
- 工艺单元（Process cells）  
- 设备单元（Units）  
- 阶段类（Phase classes）  
- 阶段（Phases）  

在某些情况下，定义下层设备后需要重新配置上层设备。  


#### 运行时区域模型(Area Model)  
区域模型(Area Model)配置完成后即可上线，并在运行时用于生产批次。若运行时需要修改区域模型(Area Model)，可修改在线区域模型(Area Model)，然后将其部署到运行时区域模型(Area Model)以响应更新需求。  

区域模型(Area Model)配置由一组定义区域功能的元素组成，其中部分元素在模型运行时不可更改。修改区域模型(Area Model)后，必须对照运行时区域模型(Area Model)验证，确认允许更新已修改的元素。验证通过后，可将更改部署到运行时区域模型(Area Model)。  



#### 创建区域模型(Area Model)  
某些FactoryTalk Batch模块使用区域模型(Area Model)名称来标识与之关联的FactoryTalk Batch系统数据。  

**创建区域模型(Area Model)步骤**：  
1. 选择 **开始 > Rockwell Software > 设备编辑器**。  
2. 选择 **文件 > 新建**，打开空白区域模型(Area Model)。  
3. 选择 **编辑区域（ ）**，打开“编辑区域”对话框。  
4. 在“名称”中输入区域的唯一名称。  
5. 在“版本”中输入版本号。  
6. 选择 **确定** 返回设计视图区域，区域名称将显示在设计视图标题栏中。  
7. 选择 **文件 > 保存**。  
8. 输入合适的文件名，然后选择 **保存** 保存区域模型(Area Model)。  

区域模型(Area Model)将保存到配置文件中，可随时打开修改。  

**重要事项**：重启FactoryTalk Batch服务器以应用更改，并重新验证所有基于修改后区域模型(Area Model)运行的配方。  


#### 打开区域模型(Area Model)  
**打开区域模型(Area Model)步骤**：  
1. 选择 **开始 > Rockwell Software > 设备编辑器**。  
2. 选择 **文件 > 打开**。  
3. 定位并选择区域模型(Area Model)文件（.cfg），然后选择 **打开**。  


#### 区域模型(Area Model)与FactoryTalk Batch物料管理器(Material Manager)  
当FactoryTalk Batch与物料管理器结合使用时，区域模型(Area Model)与物料数据库存在依赖关系。打开区域模型(Area Model)时，MATERIALS和CONTAINERS枚举集会基于物料数据库中的物料和容器重新创建。若物料服务器不可用，枚举集将仅包含默认值（NULL_MATERIAL和NULL_CONTAINER）。  

#### 验证和部署区域模型(Area Model)  
为准备部署区域模型(Area Model)，操作员可验证对模型所做的更改是否允许，然后将更改部署到运行时区域模型(Area Model)。  

**使用FactoryTalk Batch设备编辑器验证区域模型(Area Model)步骤**：  
1. 选择 **开始 > Rockwell Software > 设备编辑器**。  
2. 选择 **文件 > 打开**。  
3. 定位并选择要验证的区域模型(Area Model)文件（.cfg），然后选择 **打开**。  
4. 选择 **文件 > 验证/部署...**。  
5. 在“验证/部署区域模型(Area Model)”对话框中，查看信息并选择 **验证区域模型(Area Model)**，将原始区域模型(Area Model)与更改后的模型进行比较。  
6. 若验证失败，将显示消息，选择 **查看日志** 查看不允许的差异原因。  
7. 选择 **关闭**。  

**使用FactoryTalk Batch设备编辑器部署区域模型(Area Model)步骤**：  
1. 选择 **开始 > Rockwell Software > 设备编辑器**。  
2. 选择 **文件 > 打开**。  
3. 定位并选择要部署的区域模型(Area Model)文件（.cfg），然后选择 **打开**。  
4. 选择 **文件 > 验证/部署...**。  
5. 在“验证/部署区域模型(Area Model)”对话框中，选择 **部署区域模型(Area Model)**。  
   - 状态区域将显示是否允许部署。若失败，将显示消息，选择 **查看日志** 查看详细信息。  
   - **提示**：若操作员无FactoryTalk权限，“部署区域模型(Area Model)”按钮将禁用。  
6. 选择 **关闭**。  



### 区域模型的导入与导出
FactoryTalk Batch 支持导入 XML 格式的区域模型，也能将区域模型导出为 XML 格式。XML 作为一种标准的非专有格式，十分适合用于发布区域模型配置。

### XML 区域模型
在提供中立信息实现方面，XML 模式和 XML 实例文档已成为行业标准。借助 FactoryTalk Batch，用户可通过 FactoryTalk Batch 设备编辑器导入或导出 XML 格式的区域模型。这一功能使得企业间能以标准的非专有 XML 格式交换区域模型信息，而且该区域模型信息还能使用文本编辑器或 XML 编辑器进行编辑。

**提示**：当把某个区域模型关联到安全权限标识符时，“导出”命令会被禁用，此时该区域模型无法导出。

### 导入 XML 区域模型
导入 XML 区域模型时，FactoryTalk Batch 设备编辑器会在内存中构建该区域模型。用户可将导入的区域模型保存为专有二进制文件，也可将其导出到其他文本文件。

FactoryTalk Batch 设备编辑器会对 XML 文件提供的信息进行验证，只有格式规范且经过验证的 XML 文件才能被导入。要成功导入，XML 文件的扩展名必须为 .axml。FactoryTalk Batch 设备编辑器仅会将具有正确文件扩展名的文件当作 XML 文件来读取。

对于扩展名不是 .axml 的文件，系统会将其作为制表符分隔文件来读取。尽管制表符分隔文本文件通常期望的文件扩展名为 .txt，但 FactoryTalk Batch 设备编辑器会把所有扩展名不是 .axml 的文件都尝试作为制表符分隔文本文件来读取。

**提示**：每次创建、打开或导入新的区域模型时，YES_NO、MATERIALS、MATERIAL_CLASSES 和 CONTAINERS 枚举集都会重新创建，已有的值不会被导入。若材料服务器不可用，MATERIALS、MATERIAL_CLASSES 和 CONTAINERS 枚举集将仅使用 NULL_MATERIAL、NULL_CLASS 和 NULL_CONTAINER 默认值创建。（更多信息请参见“导入枚举”）

### 导入 XML 区域模型的步骤
1. 依次选择“开始”>“Rockwell Software”>“设备编辑器”。
2. 选择“文件”>“导入”。
3. 在“文件类型”列表里，选择“XML 文件 (*.axml)”。
4. 找到并选择要导入的 XML 文件。
5. 选择“打开”来启动导入过程，此时会弹出一个消息框，显示每个已导入并验证的组件名称。
6. 选择“确定”完成导入过程，返回 FactoryTalk Batch 设备编辑器。
7. 选择“文件”>“另存为”，保存新导入的文件。此时会打开“另存为”对话框，文件名框中会高亮显示“无标题.cfg”。
8. 在“文件名”中输入新的文件名。若想覆盖当前文件，可使用与当前所选区域模型相同的名称。
9. 选择“保存”，新的区域模型将被保存，并且文件名会显示在 FactoryTalk Batch 设备编辑器的标题栏上。

**提示**：若文件名与“服务器选项”对话框中当前所选的区域模型名称不同，在使用新区域模型之前，需更改“服务器选项”设置。

### 导入枚举
在 FactoryTalk Batch 设备编辑器中，可创建并维护以下系统枚举集：
- PHASE_FAILURES
- YES_NO
- REPORTING_CONTEXTS
- MATERIALS（需安装材料服务器）
- MATERIAL_CLASSES（需安装材料服务器）
- CONTAINERS（需安装材料服务器）

除了 PHASE_FAILURES 和 REPORTING_CONTEXTS，这些由系统维护的枚举集的数据类型或成员不能更改。XML 文件必须包含这些系统枚举集，以便根据架构进行验证，不过这些系统枚举集无法导入。

**提示**：PHASE_FAILURES 和 REPORTING_CONTEXTS 系统枚举集可与这些枚举集中的任何用户定义枚举一起导入。

### 导入系统阶段类(Phase Class)
FactoryTalk Batch 设备编辑器会创建并维护以下系统阶段类(Phase Class)集：
- $NULL
- $TIMER

在导入系统阶段类(Phase Class)时，会对整个阶段类(Phase Class)进行验证，只有完全匹配的阶段类(Phase Class)才会被导入。

**提示**：若任何系统阶段类(Phase Class)（$TIMER 或 $NULL）存在错误，仅会显示第一个错误。

### $NULL 阶段
$NULL 阶段类的验证规则如下：
- 阶段类名称必须为 $NULL。
- 不能配置配方或报告参数。
- 不能配置消息。
- 不能配置控制策略。
- 不能配置请求参数。
- 不能配置消息伙伴。
- 所有其他可配置值均未设置。

### $TIMER 阶段
$TIMER 阶段类的验证规则如下：
- 阶段类名称必须为 $TIMER_X（其中 X 为计时器类型和度量单位，例如 $TIMER_DN_SECOND 或 $TIMER_UP_DAY）。
- 不能配置消息。
- 不能配置控制策略。
- 不能配置请求参数。
- 不能配置消息伙伴。

### 将区域模型导出为 XML
FactoryTalk Batch 支持将区域模型导出为格式规范的 XML 格式。除了 PHASE_FAILURES 和 REPORTING_CONTEXTS，系统维护的枚举集的数据类型或成员不能更改。XML 文件必须包含这些系统枚举集，以便根据架构进行验证。这些系统枚举集可以导出，但不能导入。

所有系统阶段（$NULL 或 $TIMER）都会被导出。所有关联的配方和报告参数以及关联数据（对于 $TIMER_X 阶段）都是导出的一部分（例如，其中 X 是计时器类型和度量单位；$TIMER_DN_SECOND 或 $TIMER_UP_DAY）。

**提示**：
- PHASE_FAILURES 和 REPORTING_CONTEXTS 系统枚举集将与这些枚举集中的任何用户定义枚举一起导出。
- 当区域模型安全到 FactoryTalk 网络目录安全权限标识符时，“导出”命令将被禁用。

### 将区域模型导出为 XML 的步骤
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。
2. 选择“文件”>“打开”以打开区域模型。
3. 选择“文件”>“导出”。此时将打开“文件导出为”对话框。
4. 找到并选择要导出区域模型的文件，或者在“文件名”中键入新的文件名。
5. 在“保存类型”中，选择“XML 文件 (*.axml)”。
6. 选择“保存”以启动导出过程。如果文件已存在，请确认是否替换该文件。
7. 选择“确定”完成导出过程并返回 FactoryTalk Batch 设备编辑器。

### 从命令行将 XML 转换为二进制
可以使用随附的程序 AreaModelConvert.exe 从命令行将 XML 区域模型转换为专有二进制格式。只有格式规范、符合架构且经过程序验证的 XML 文件才能转换。从命令行导出时，请更改为包含 AreaModelConvert.exe 的目录，并且路径不能包含任何空格。UNC 名称也受支持，如下列语法示例所示：命令行的语法为：C:AreaModelConvert.EXE 输入文件 输出文件 日志文件 其中：
- InputFile 指定输入 XML 文件名的路径。
- OutputFile 指定输出二进制文件名的路径。
- LogFile 指定日志文件的路径。

**示例**：C:AreaModelConvert.EXE \Batchctl\SampleDemo1\recipes\ice_cream1.axml \Batchctl\SampleDemo1\recipes\ice_cream1.cfg \Batchctl\SampleDemo1\logs\convert.log

命令行验证 XML 文件中的信息并覆盖 OutputFile 指定的现有文件。错误消息将附加到日志文件中。

**重要提示**：命令行程序不会验证特定于材料的信息，包括：
- 材料服务器的运行状态
- 引用材料的存在性
- 引用材料类的存在性
- 引用容器的存在性

如果命令行参数有效，程序将返回 0（零），表示导入成功。如果命令行参数无效，命令行程序将返回 1（一），表示失败。在日志文件中查看返回代码以检查转换是成功还是失败。


### 脚本化区域模型导入  
区域模型导入工具（Area Model Importer）是一款可脚本化的命令行实用程序，可用于导入新的区域模型或向现有区域模型添加内容。待导入的文件必须为XML区域模型格式。此外，可提供现有区域模型二进制文件（.cfg），以创建合并了两个输入数据的新区域模型二进制文件。  

该工具安装在安装设备编辑器的BATCHCTL\bin目录中。尽管设备编辑器也具备导入XML区域模型的类似功能，但区域模型导入工具是专门设计的“可脚本化”工具。这意味着该工具可从命令行或脚本执行，无任何用户界面，并返回整数值，供脚本用于判断请求的区域模型导入是否成功。区域模型导入工具还会为每次执行生成日志文件，可用于查看额外信息（通常在导入失败时尤为重要）。此外，该工具支持更新现有二进制区域模型。  


#### 完整区域模型导入  
区域模型导入工具可通过输入区域模型XML创建新的二进制区域模型。-Input开关用于指定输入文件路径，-Output开关用于指定要创建的二进制区域模型（.cfg）文件。  
输入的区域模型XML文件需遵循现有区域模型XML架构。“AreaModel.xsd”架构文件可在安装FactoryTalk Batch编辑器时创建的BATCHCTL共享目录的“Schemas”子目录中找到。  


#### 部分区域模型导入  
区域模型导入工具可使用XML文件向现有区域模型添加内容。此过程需要输入现有二进制区域模型文件和部分区域模型XML文件。通过添加-AreaModel开关启用此功能，最终将生成包含两个输入数据的新二进制区域模型文件。  
输入的部分区域模型XML文件需遵循新的XML架构。“PartialAreaModel.xsd”架构文件可在安装FactoryTalk Batch编辑器时创建的BATCHCTL共享目录的“Schemas”子目录中找到。  

可向现有二进制区域模型（.cfg）文件添加以下区域模型对象：  
- 枚举集  
- 枚举  
- 数据服务器  
- 标签类  
- 工艺单元类  
- 单元类  
- 阶段类  
- 操作序列类  
- 工艺单元实例  
- 单元实例  
- 阶段实例  
- 操作序列实例  

部分区域模型导入要求对其他对象的任何引用必须在输入XML或现有区域模型中定义。为确保所有引用有效，导入逻辑将检查冲突对象。若输入区域模型XML中定义的重复对象必须与现有二进制区域模型文件中定义的对象匹配。  
检测到重复不匹配对象时，将输出描述冲突的错误消息。例如：  
**现有“TEST_PHASE”配方阶段与XML配方阶段冲突！以下数据不匹配：**  
- 阶段参数“P_REAL”的可缩放属性  
- 阶段参数“P_REAL”的数值类型  
- 阶段参数“P_REAL”的下载标志  


#### FactoryTalk安全集成  
区域模型导入工具利用FactoryTalk安全单点登录功能确定执行工具的用户。此外，可指定命令行开关（-UserName和-Password）强制区域模型导入工具以指定用户身份运行。  
执行区域模型导入工具的用户必须具备与使用设备编辑器创建/编辑区域模型的用户相同的权限。具体而言，工具会检查用户对FactoryTalk目录中“Batch/Equipment Editor>AccessModes>FullEdit” FTSecurity策略的访问权限，以确定用户是否允许导入区域模型。  


#### FactoryTalk目录锁定  
在部分区域模型导入期间，将检查现有区域模型二进制文件的安全权限标识符（SAI）。SAI要求规定：锁定到特定FactoryTalk目录的区域模型不得由未在指定FactoryTalk目录上运行的任何应用程序打开。区域模型导入工具必须打开现有区域模型以执行部分导入。在此情况下，工具将检查区域模型是否包含SAI：  
- 若区域模型包含SAI，工具将检查指定的SAI是否与当前FTSP SAI匹配。若不匹配，工具将返回错误消息和代码，表明无法执行部分区域模型导入。  


#### 日志记录  
每次调用时，区域模型导入工具会生成唯一的日志文件，记录区域模型导入尝试的结果；若导入失败，还会记录失败原因。每个日志文件的唯一名称格式如下：  
**AreaModelImportLog_<月>_<日>_<年>_<时>_<分>_<秒>_<毫秒>.log**  
其中：  
- <月>：两位整数（01..12）  
- <日>：两位整数（01..31）  
- <年>：四位整数（0000..9999）  
- <时>：两位整数（00..23）  
- <分>：两位整数（00..59）  
- <秒>：两位整数（00..59）  
- <毫秒>：三位整数（000..999）  

**示例**：AreaModelImportLog_10_09_2023_08_52_06_096.log  

区域模型导入工具的日志文件包含两个部分：  
1. **头部块**：记录导入工具执行的关键信息。  
2. **主体块**：记录进度/状态消息。若日志文件达到最大大小（9,999,999字节），主体块将作为循环缓冲区，新日志条目覆盖最旧的条目。  

调用AreaModelImporter.exe工具时，可使用-Verbosity开关控制日志详细程度。支持的详细程度设置（优先级由低到高）为：INFO、WARN、SEVERE。若未指定详细程度，工具将按INFO级别执行。详细程度设置用于控制写入日志文件主体块的记录——仅写入优先级大于或等于指定级别的记录，且不影响头部块的记录。  

日志文件的写入目录由调用工具时的-LogPath开关控制。若未指定-LogPath开关，日志将写入当前工作目录。  


#### 区域模型导入工具程序详情  
区域模型导入工具是名为AreaModelImporter.exe的Windows命令行应用程序，可在安装FactoryTalk Batch编辑器时创建的BATCHCTL共享目录的bin子目录中找到。  


#### 语法-区域模型  
调用区域模型导入工具的语法如下：  
**AreamodelImporter.exe [<参数>]**  
若未指定参数或参数无效，将生成文本输出，说明支持的程序参数。  

区域模型导入工具支持以下参数：  


| **参数**                | **描述**                                                                                                                                                                                                                                                                                                                                 |
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -Input <文件路径名>      | 指定导入指定区域模型XML文件的请求。文件名可为完整文件路径；若未包含路径信息，默认文件位于当前工作目录。文件名必须以FTBatch认可的XML区域模型文件扩展名“.axml”结尾（不区分大小写）。<br>- 若指定-AreaModel开关，XML文件必须符合PartialAreaModel.xsd架构；<br>- 若未指定-AreaModel开关，XML文件必须符合AreaModel.xsd架构。 |
| -Output <文件路径名>     | 指定在提供的文件路径创建二进制区域模型文件的请求。                                                                                                                                                                                                                     |
| -Overwrite              | 指定允许导入覆盖与指定输出匹配的现有二进制区域模型文件。若未指定此参数，若导入的区域模型与现有区域模型名称冲突，将拒绝导入。                                                                                                                                                                                                                                                       |
| -Username <用户名>       | 指定用于检查访问权限的用户名（可选）。若提供此参数，必须同时提供-Password开关。                                                                                                                                                                                                                                                     |
| -Password <密码>         | 指定用于检查访问权限的密码（可选）。若提供此参数，必须同时提供-Username开关。                                                                                                                                                                                                                                                       |
| -Verbosity <值>         | 指定设置区域模型导入工具的日志详细程度级别。支持的详细程度值（优先级由低到高）为INFO、WARN、SEVERE。工具仅向日志主体块写入优先级大于或等于指定级别的记录。若未指定，默认按INFO级别执行。头部块的记录不受详细程度设置影响，始终写入。                                                                 |
| -LogPath <目录路径>      | 指定导入工具写入生成的日志文件的目录。若未指定，日志将写入当前工作目录（即调用工具的目录）。                                                                                                                                                                                                                                   |
| -AreaModel <文件路径名>  | 指定现有二进制区域模型的路径作为输入，激活工具的部分区域模型导入功能。                                                                                                                                                                                                                                                             |


**示例1：覆盖目标文件的完整区域模型导入命令行参数**  
AreaModelImporter.exe -Input "ice_cream1.axml" -Output "ice_cream1.cfg" -Overwrite  

**示例2：向现有区域模型二进制文件导入部分区域模型XML的命令行参数**  
AreaModelImporter.exe -Input "new_units.axml" -Output "updated_ice_cream1.cfg" -AreaModel "ice_cream1.cfg"  


#### 控制台文本输出  
区域模型导入工具在执行期间生成控制台文本输出，记录区域模型导入过程中的进度和问题。大部分控制台输出文本会记录在每次执行生成的唯一日志文件中。  


#### 退出返回代码  
AreaModelImporter.exe工具返回整数错误结果代码，通用错误代码定义如下：  


| **通用错误代码** | **描述**                                                                                                                                                                                                                                                                                                                                 |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 0                | 成功：请求的区域模型导入成功。                                                                                                                                                                                                                                                                                                         |
| 1                | 参数无效：命令行参数无效。                                                                                                                                                                                                                                                                                                             |
| 2                | 文件扩展名无效：使用-Input开关指定的文件名扩展名非有效（.axml），或-Output开关指定的扩展名非有效（.cfg）。                                                                                                                                                                                                                         |
| 3                | 文件未找到：使用-Input开关指定的输入路径不存在。                                                                                                                                                                                                                                                                                       |
| 4                | 不允许覆盖：导入的区域模型将覆盖输出路径中的现有区域模型，且未指定-Overwrite开关，拒绝导入。                                                                                                                                                                                                                                   |
| 5                | 文件权限：由于文件权限问题，无法打开/读取使用-Input或-Output开关指定的文件。                                                                                                                                                                                                                                                         |
| 6                | 内部错误：发生内部错误。                                                                                                                                                                                                                                                                                                               |
| 7                | 保留。                                                                                                                                                                                                                                                                                                                                 |
| 8                | XML解析失败：解析区域模型XML时失败。                                                                                                                                                                                                                                                                                                   |
| 9                | XML架构失败：区域模型XML不符合所需架构。                                                                                                                                                                                                                                                                                               |
| 10               | 用户身份验证失败：无法验证用户身份。                                                                                                                                                                                                                                                                                                   |
| 11               | 访问被拒绝：用户无权创建区域模型。                                                                                                                                                                                                                                                                                                     |
| 12               | 日志初始化错误：尝试初始化日志时出错。                                                                                                                                                                                                                                                                                               |
| 13               | 日志路径无效：指定的日志目录无效。                                                                                                                                                                                                                                                                                                     |
| 14               | -AreaModel开关指向的区域模型二进制文件无法打开。                                                                                                                                                                                                                                                                                       |
| 15               | FactoryTalk网络目录与现有区域模型所需的SAI不匹配。                                                                                                                                                                                                                                                                                   |


### 枚举概述  
枚举是定义为变量数据类型的系统对象，由数值（称为**序数值**）和关联文本字符串组成。过程连接设备（PCD）与FactoryTalk Batch服务器通过序数值通信，服务器随后向操作员显示与序数值关联的文本字符串。使用枚举可向操作员显示有意义的文本，而非数字。  

枚举集包含相关枚举的分组。FactoryTalk Batch和PCD会创建并维护以下默认系统枚举集：  
- PHASE_FAILURES（阶段故障）  
- YES_NO（是/否）  
- MATERIALS（适用于安装材料服务器的系统）  
- MATERIAL_CLASSES（适用于安装材料服务器的系统）  
- CONTAINERS（适用于安装材料服务器的系统）  
- REPORTING_CONTEXTS（报告上下文）  

由系统维护的YES_NO、MATERIALS、MATERIAL_CLASSES或CONTAINERS枚举集的数据类型和成员不可更改。可在区域模型内创建自定义枚举和枚举集。  

**示例**：负数序数的使用  
预混器B（单元#2）中的搅拌器可能使用：  
- 枚举集名称：MOTORS  
- 枚举名称 | 序数 | 字符串  
  - Enumeration_1 | 0 | OFF（关闭）  
  - Enumeration_2 | 1 | FORWARD（正向）  
  - Enumeration_3 | -1* | REVERSE（反向）  


#### 系统枚举集  
存在五个默认系统枚举集。除PHASE_FAILURES和REPORTING_CONTEXTS枚举集外，这些系统维护的枚举集的数据类型或成员不允许更改。  


| **系统枚举集**       | **用途**                                                                                                                                                                                                                                                                                                                                 |
|----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PHASE_FAILURES       | 默认情况下，此枚举集不含成员。可根据具体实施需求添加枚举。<br>**重要提示**：PHASE_FAILURES枚举的序数值不能大于32767或小于0（零）。                                                                                                                                                                                                                                                         |
| REPORTING_CONTEXTS   | 此枚举集支持向阶段类参数和报告添加报告上下文字符串，便于查询和排序与集合相关的事件。可添加、删除和编辑此枚举集的成员。默认枚举为NULL，序数值为0。                                                                                                                                                                                                                                           |
| YES_NO               | 简单枚举集，包含两个成员：NO（序数值0）和YES（序数值1），不可修改。                                                                                                                                                                                                                                                                                                                                 |
| MATERIALS（安装材料服务器） | 表示FactoryTalk Batch材料管理器数据库中配置的材料集合。默认枚举为NULL_MATERIAL，序数值0，允许将枚举分配给MATERIALS类型的参数（实际材料分配将延迟到构建配方时）。每次创建、打开或导入区域模型时，其他枚举集成员将基于材料数据库中的材料数据重新创建。材料的控制器ID范围为1到9999999999。                                                                                     |
| CONTAINERS（安装材料服务器） | 表示FactoryTalk Batch材料管理器数据库中配置的容器集合。默认枚举为NULL_CONTAINER，序数值0。每次创建、打开或导入区域模型时，其他枚举集成员将基于材料数据库中的容器数据重新创建。容器的控制器ID范围为1到9999999999。<br>若FactoryTalk Batch材料管理器数据库不可用，MATERIALS和CONTAINERS枚举集仅包含默认枚举。<br>材料和容器的控制器ID即枚举的序数值。若修改材料数据库中的控制器ID，关联枚举的序数值将变更，可能影响阶段逻辑。                                                                 |

**说明**：PHASE_FAILURES和REPORTING_CONTEXTS是唯一可添加枚举的系统枚举集。系统枚举集以粗体显示，与自定义枚举集区分。  


#### 创建枚举集  
**操作步骤**：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“枚举集”，打开“创建枚举集和枚举”对话框。  
3. 在“集合”下，选择“新建”。  
4. 在“创建枚举集”对话框中，输入新枚举集名称，选择“确定”返回“创建枚举集和枚举”对话框。新枚举集名称将显示在“枚举集”列中。  
   **提示**：若未向新枚举集添加成员，在更新阶段类参数和报告时，该集合不会作为选项显示在“Enum/E.U.”列表中。  


#### 添加枚举成员  
**操作步骤**：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“枚举集”，打开“创建枚举集和枚举”对话框。  
3. 选择目标枚举集。  
4. 在“枚举”下，选择“新建”。  
   **提示**：不可向YES_NO、MATERIALS、MATERIAL_CLASSES和CONTAINERS系统枚举集添加成员。  
5. 输入枚举名称和序数值，或接受默认序数值。  
   **重要提示**：PHASE_FAILURES枚举仅支持0到32767的正序数值。  
6. 选择“确定”返回对话框，新枚举名称将显示在“枚举”下。  


#### 编辑枚举和枚举集  
**操作步骤**：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“枚举集”，打开“创建枚举集和枚举”对话框。  
3. 选择要编辑的枚举集或枚举。  
4. 选择对应的“编辑”按钮（集合或枚举）。  
5. 若编辑枚举，输入新枚举名称。  
   **重要提示**：PHASE_FAILURES枚举仅支持0到32767的正序数值。  
6. 若编辑未分配的枚举集，将显示“编辑枚举集名称”对话框，输入新名称后选择“确定”返回。  
   若编辑已分配的枚举集，将显示警告并列出使用该枚举的项目：  
   - 选择“是”编辑名称，列表中的项目将更新为新名称；选择“否”取消修改。  
7. 选择“确定”返回对话框。  


#### 删除枚举和枚举集  
**操作步骤**：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“枚举集”，打开“创建枚举集和枚举”对话框。  
3. 选择要删除的枚举集或枚举。  
4. 选择“删除”：  
   - 若删除枚举，继续步骤5；若删除枚举集，跳至步骤6。  
5. **删除枚举**：  
   - 若枚举非阶段类(Phase Class)参数的默认值，将显示确认删除的警告，选择“是”删除，“否”取消。  
   - 若枚举是阶段类(Phase Class)参数的默认值且选择“是”，将显示提示无法删除，并列出使用该枚举的参数名称。需先修改阶段类(Phase Class)参数以移除默认枚举，再选择“确定”关闭警告。  
6. **删除枚举集**：  
   **提示**：使用已删除枚举集的项目将默认设置为“类型=整数”和“工程单位=工程单位”。  
   - 显示确认删除的警告，选择“是”删除，“否”取消。  
   - 显示已分配项目的列表：  
     - 选择“是”删除，将显示受影响的标签、参数和报告数量，选择“确定”返回。  
     - 选择“否”取消删除；选择“关闭”返回设计视图。


### FactoryTalk Batch的参数与报告  
FactoryTalk Batch服务器使用**参数**将值发送至过程连接设备（PCD），而**报告**则将值从PCD返回至服务器。通过FactoryTalk Batch设备编辑器可为阶段配置参数和报告，阶段实例会继承其创建所基于的阶段类(Phase Class)的参数和报告。  


#### 配方中的参数与报告  
使用FactoryTalk Batch配方编辑器将阶段类(Phase Class)添加到操作级配方时，阶段类(Phase Class)参数为公式值，阶段类(Phase Class)报告为报告值。定义公式值时，配方设计者可选择：  
- 接受默认公式值（即对应阶段类(Phase Class)参数的默认值）。  
- 分配新值。  
- 将公式值分配延迟至操作员或配方公式参数（仅与配方关联的参数）。  

使用参数可减少所需的阶段类(Phase Class)或配方数量。  

**参数示例**：  
若工厂有一个混合多种产品的单元，可定义一个阶段类(Phase Class)来表示混合单元中搅拌器的速度。要么为每种所需速度定义不同的阶段类(Phase Class)，要么定义一个阶段类(Phase Class)并为搅拌器速度配置参数。在配方中使用该阶段类(Phase Class)时，可立即或延迟分配值。通过延迟值分配，可创建一个用于多个配方的操作。  


#### 参数、报告与阶段标签  
阶段是区域模型中阶段类(Phase Class)的实例，使用**标签**与过程连接设备（PCD）中的工程逻辑通信。阶段中的每个标签映射到PCD中的特定内存地址或标签，用于在配方执行期间存储与阶段相关的数据。FactoryTalk Batch服务器和PCD使用这些标签交换阶段信息。  

**提示**：FactoryTalk Linx FactoryTalk Live Data标签的配置与OPC标签相同。  
每个OPC阶段至少有十个标准标签。配置OPC阶段所基于的阶段类(Phase Class)时，需定义参数和报告通信所需的标签数量，以及额外的请求标签。  

**提示**：对于分配给Logix5000 CIP数据服务器的PhaseManager阶段，无需定义参数、报告和请求标签的数量。当区域模型与Logix Designer项目同步时，会自动配置正确数量的标签。  


#### 阶段标签概述  
**请求标签**是与每个OPC阶段关联的十个标准标签之一，PCD使用该标签向FactoryTalk Batch服务器请求服务。有时PCD需要传递更多信息，此时可在阶段类(Phase Class)上指定OPC阶段所需的额外请求标签数量。  

**提示**：对于分配给Logix5000 CIP数据服务器的PhaseManager阶段，无需配置请求标签。当区域模型与Logix Designer项目同步时，会自动为Logix5000 CIP阶段创建标签。  

OPC阶段的阶段类(Phase Class)参数和报告数量可与参数和报告标签数量不同。部分OPC阶段逻辑程序可能不希望参数数量与参数标签数量匹配，或报告数量与报告标签数量匹配。  

若要使阶段类(Phase Class)的参数和报告数量始终等于关联阶段的参数标签和报告标签数量，需在阶段类(Phase Class)上启用**参数/标签锁定**。若禁用参数/标签锁定，需在阶段类(Phase Class)上指定关联OPC阶段存在的参数和报告标签数量，该数量可与OPC阶段定义的阶段类(Phase Class)参数和报告数量不同。  

**提示**：对于Logix5000 CIP阶段，无论选择何种设置，参数/标签锁定始终启用。当区域模型与Logix Designer项目文件同步时，FactoryTalk Batch设备编辑器创建的参数标签数量与阶段类(Phase Class)的参数数量相同，报告标签数量与阶段类(Phase Class)的报告数量相同。  

总结：创建阶段时，需指定：  
- 与阶段类(Phase Class)关联的参数和报告数量。  
- 阶段中与这些参数、报告和额外请求关联的标签数量（启用参数/标签锁定或指定实际标签数量）。  

**提示**：FactoryTalk Linx FactoryTalk Live Data标签的配置与OPC标签相同。  
创建OPC阶段实例（分配OPC数据服务器的阶段）时，需指定：  
- PCD中与十个标准标签关联的内存地址或标签。  
- PCD中与任何已配置参数、报告和额外请求标签关联的内存地址或标签。  

**提示**：若阶段标签数量与指定阶段类(Phase Class)的参数数量不相等（阶段标签数量应等于最高参数ID号），上传/下载功能将无法正常工作。此外，为正确传递参数值，阶段逻辑必须使用请求数据参数指定FactoryTalk Batch上传参数的方式。  


#### 阶段标签  
检查过程连接设备（PCD）的配置，验证为OPC阶段配置的标签数量是否与PCD中的标签数量相等。FactoryTalk Batch设备编辑器中定义的参数和报告数据类型必须与PCD中对应的标签数据类型兼容。  

**提示**：FactoryTalk Linx FactoryTalk Live Data标签的配置与OPC标签相同。  


| **FactoryTalk Batch设备编辑器数据类型** | **兼容的PCD数据类型**       |
|--------------------------------------|---------------------------|
| Real（实数）                         | Real（实数）               |
| Integer（整数）                      | Real（实数）、Integer（整数）|
| Enumeration（枚举）                  | Real（实数）、Integer（整数）|
| String（字符串）                     | String（字符串）           |


#### Batch参数Parameters与报告reports  
参数将值从FactoryTalk Batch服务器传递至过程连接设备（PCD），PCD使用报告将值返回至服务器。  

**重要提示**：请勿将以下词语或短语用作参数名称或报告名称：  
- all  
- length  
- recipepath  
- outerhtml  
- finalinstructions  
- stepindex  
- submitstring  
- submit  
使用这些短语作为参数或报告名称可能导致手动阶段控制期间出现错误。  


#### 阶段类(Phase Class)参数  
阶段类(Phase Class)参数在配方阶段执行期间从FactoryTalk Batch服务器传递至阶段逻辑，通常对应阶段标签（映射到PCD中实际配置的参数地址）。  

配置阶段类(Phase Class)时需定义阶段类(Phase Class)参数；配置OPC阶段时需定义对应的参数标签，包括其在PCD中的地址或标签。  

**提示**：对于分配给Logix5000 CIP数据服务器的PhaseManager阶段，当区域模型与Logix Designer项目同步时，会自动创建参数标签，无需手动定义。  


#### 阶段类(Phase Class)报告Report  
阶段类(Phase Class)报告值从过程连接设备（PCD）传递至FactoryTalk Batch服务器，包含指示阶段功能的数据。这些数据存在于运行批次的事件日志文件（.evt）和FactoryTalk Batch报告中，通常对应映射到PCD中配置参数的阶段标签。  

**提示**：FactoryTalk Linx FactoryTalk Live Data报告标签的配置与OPC标签相同。  
配置阶段类(Phase Class)时需为阶段定义阶段类(Phase Class)报告；配置OPC阶段时需定义对应的报告标签，包括其在PCD中的地址或标签。  

**提示**：对于分配给Logix5000 CIP数据服务器的PhaseManager阶段，当区域模型与Logix Designer项目同步时，会自动创建报告标签，无需手动定义。  


#### 材料参数  
若将FactoryTalk Batch Material Manager与FactoryTalk Batch结合使用，需创建支持材料的阶段类(Phase Class)。支持材料的阶段类(Phase Class)使用系统参数指定配方中使用的材料和数量。  

支持材料的阶段类(Phase Class)关联的默认参数为**MATERIAL**和**AMOUNT**，默认报告参数为**ACTUAL_AMOUNT**和**FEED_COMPLETE**。每个支持材料的阶段类(Phase Class)可分配可选材料参数：**CONTAINER**、**LOT**、**LABEL**和**MATERIAL_CLASS**。MATERIAL、LOT和LABEL参数的值组合形成材料规格。  

材料规格决定批次运行时提取材料或分配材料的容器，始终包含材料名称，并可根据容器类型包含批次名称、标签或两者。  


#### 容器类型  
FactoryTalk Batch Material Manager使用三种容器类型：复合（Composite）、活塞流（Plug-Flow）和托盘（Pallet）。所有三种容器均要求材料规格至少包含材料名称：  
- 复合和活塞流容器支持包含批次名称的材料规格。  
- 托盘容器支持包含批次名称、标签或两者的材料规格。  

若材料规格仅包含材料名称，则三种容器类型均有效；若包含材料名称、批次和标签，则仅托盘容器类型有效。  


#### 默认材料参数  

| **参数**       | **用途**                                                                                                                                                                                                                                                                                                                                 |
|----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| MATERIAL       | 通常配置为默认值NULL_MATERIAL，实际材料在配方中分配。若为参数分配特定材料，则该阶段类(Phase Class)仅能用于输送该材料。MATERIAL参数、阶段运行所在单元，以及AMOUNT参数的高低值共同决定阶段类(Phase Class)是用于材料添加、分配或两者兼具。                                                                                                                                                                                                                                   |
| FEED_COMPLETE  | 报告材料添加或分配完成。ACTUAL_AMOUNT报告参数记录生产或消耗的实际材料数量。                                                                                                                                                                                                                                                         |
| CONTAINER      | 用于保存批次运行时步骤绑定的容器名称，默认值为NULL_CONTAINER。无法在区域模型或配方中为CONTAINER参数分配值（容器被视为区域模型外的设备）。FactoryTalk Batch服务器或操作员确定步骤绑定的合适容器时，会将绑定的容器名称值分配给该参数。除默认值外，该参数仅在运行时步骤绑定时包含值。                                                                                             |
| MATERIAL_CLASS | 表示材料数据库中配置的材料类集合，默认值为NULL_CLASS。根据是否启用控制策略，仅可修改MATERIAL_CLASS的“默认值”和“启动时下载”属性。                                                                                                                                                                                                                                                             |
| LOT            | 用于细化阶段类(Phase Class)可绑定的材料列表，指定给定材料的离散数量。运行时该参数为空时，FactoryTalk Batch服务器将绑定至容器而不考虑批次。                                                                                                                                                                                                                                                             |
| LABEL          | 表示材料的子批次（分配给特定容器的给定材料批次的离散数量）。在材料添加阶段类(Phase Class)中，标签用于细化阶段类(Phase Class)可绑定的材料列表；在材料分配阶段类(Phase Class)中，标签应用于分配至库存的材料子批次。                                                                                                                                                                                                                     |

**提示**：FactoryTalk Batch设备编辑器中，可选材料参数（除MATERIAL_CLASS外）的值不可编辑。  


#### 缩放参数  
选中**缩放（Scale）** 复选框可将参数设置为在运行时包含该阶段的批次缩放时自动按比例调整。  
**示例**：若包含该阶段类(Phase Class)的批次以200%缩放运行，ADD_AMOUNT值自动增加200%（默认值为50时调整为100）；若批次以50%缩放运行，ADD_AMOUNT调整为25。  


#### 参数偏差验证方法  
当参数或报告值超出区域模型设计者定义的可接受范围时，会发生参数偏差。验证策略为每个参数定义可接受限制集，以及参数或报告值超出限制时的对应操作。**验证方法**是策略中定义参数或报告可接受限制集的部分。向阶段类(Phase Class)添加参数或报告时，可接受默认验证方法（无限制）或选择不同的验证方法。  

**提示**：若验证策略需要电子签名，需在配置验证策略前设置签名模板。  


#### 控制策略概述  
在FactoryTalk Batch设备编辑器中创建适用于特定阶段类(Phase Class)的参数和报告，这些参数和报告直接与阶段类(Phase Class)关联，默认适用于包含该阶段类(Phase Class)的所有配方。但部分阶段类(Phase Class)可能在单个配方中承担不同角色，或在不同配方中承担不同角色，此时仅需阶段类(Phase Class)关联的参数和报告子集，避免配方执行时产生不必要的阶段I/O——**控制策略**可解决此问题。  

控制策略是用户定义的阶段类(Phase Class)参数和报告的分组，可与单个阶段类(Phase Class)关联。将参数和报告组织到不同控制策略中，可使阶段类(Phase Class)承担多种角色而不产生不必要的阶段I/O。  

为阶段类(Phase Class)创建多个控制策略，每个策略包含独立的参数和报告。在阶段类(Phase Class)中，参数和报告可与单个或多个控制策略关联。若参数或报告与多个控制策略关联，可针对每个关联的控制策略独立定义其值范围、工程单位和报告工程单位。  

**提示**：在FactoryTalk Batch配方编辑器中查看启用控制策略的配方阶段类(Phase Class)时，仅显示指定控制策略的参数值。将参数与特定控制策略关联后，配方设计者或操作员在创建、查看和执行特定配方时，无需自行判断哪些阶段类(Phase Class)参数和报告参数适用。  


#### 控制策略示例  
下表展示单个阶段类(Phase Class)的已配置参数、报告和控制策略，说明参数、报告与控制策略的关系。控制策略下方的“X”表示参数或报告与该策略关联。  

| **参数名称**   | **CONTROL_STRATEGY_1** | **CONTROL_STRATEGY_2** | **策略1值** | **策略2值** |
|----------------|------------------------|------------------------|-------------|-------------|
| PARAMETER_A    | X                      |                        | 150         |             |
| PARAMETER_B    | X                      | X                      | 200         | 275         |
| PARAMETER_C    | X                      |                        | 70          |             |
| REPORT_A       | X                      | X                      | 125         | 125         |

**示例**：阶段类(Phase Class)包含三个参数（PARAMETER_A、PARAMETER_B、PARAMETER_C）和一个报告参数（REPORT_A）。如上述表格所示：  
- PARAMETER_A和PARAMETER_C仅与一个控制策略关联。  
- PARAMETER_B和REPORT_A与多个控制策略关联，其中PARAMETER_B为每个策略定义了独立值。  


#### 实施控制策略  
在区域模型中配置阶段类(Phase Class)以启用或禁用控制策略功能。对于启用控制策略功能的阶段类(Phase Class)，需为其配置一个或多个策略，将阶段类(Phase Class)参数和报告分配给每个策略，并配置其范围、值和工程单位。  

使用FactoryTalk Batch配方编辑器创建主配方时，需为配方中每个阶段类(Phase Class)实例指定使用的控制策略。配方执行时，阶段类(Phase Class)仅使用配方创建时指定的控制策略关联的参数。  

同样，在FactoryTalk Batch View或其他客户端程序中查看执行的配方时，启用控制策略的阶段类(Phase Class)仅显示指定的控制策略及与其关联的参数。但与控制策略关联的参数默认值可修改。此外，若使用手动阶段控制执行阶段类(Phase Class)，需在运行前选择使用的控制策略。  

**提示**：配置阶段中的标签和PCD中的阶段逻辑以支持控制策略使用。当PCD请求下载阶段类(Phase Class)参数或上传阶段类(Phase Class)报告时，基于控制策略仅加载相应的阶段类(Phase Class)参数和报告。需将阶段类(Phase Class)和报告参数配置并映射到PCD中的标签。  


#### 参数和报告子集  
使用**下载参数子集**定义启动时下载（DL on Start）和控制转移时下载（DL on TOC）的阶段类(Phase Class)参数子集，提升批次执行效率；使用**上传报告子集**定义终端状态时上传（UL on Terminal State）和控制转移时上传（UL on TOC）的阶段类(Phase Class)报告子集，优化流程。  

**提示**：控制转移指配方中存在同一阶段的两个实例，且由非“<阶段名称>.State = Complete”的配方转移条件分隔。此时转移条件为真时，运行逻辑不会终止。  

可将参数分配给无、一个或两个上传/下载集合。将参数或报告分配给子集后，当发出相应的阶段逻辑请求时，该参数或报告将与子集其他成员一同下载（参数）或上传（报告）。  

**提示**：FactoryTalk Batch服务器处理阶段逻辑请求出错时，会发出145（请求失败）命令值。增强错误处理阶段逻辑协议支持请求值比当前标准请求大10,000的情况。例如，使用增强阶段逻辑请求上传报告参数时，在标准请求代码2200基础上加10,000，得到增强请求代码12200。  

**重要提示**：当FactoryTalk Batch服务器配置为暖启动（Warm）或全暖启动（Warm All）并使用自动上传时，阶段在上传期间转换为外部状态时，服务器可能会两次上传添加的材料信息。请检查日志文件，若发生两次上传，需手动调整材料数据库中的数量。每次暖启动时，数量参数的设定值也会重新计算，可能需要手动更新。  


#### 不同子集的阶段类(Phase Class)  
下表为阶段类(Phase Class)示例，展示其参数和报告如何分配给不同子集：  

| **参数**       | **启动时下载（DL on Start）** | **控制转移时下载（DL on TOC）** | **报告**         | **终端状态时上传（UL on Terminal State）** | **控制转移时上传（UL on TOC）** |
|----------------|------------------------------|--------------------------------|------------------|-------------------------------------------|--------------------------------|
| SPEED          | X                            | X                              | AGITATE_TIME     | X                                         | X                              |
| TIME           | X                            | X                              | AVG_TEMP         | X                                         |                               |
| LEVEL          | X                            |                                | AVG_SPEED        | X                                         | X                              |
| TEMP           | X                            |                                | AMT_DUMPED       | X                                         |                               |


#### 下载参数请求  
下载参数子集用于定义当相应阶段逻辑请求发送至FactoryTalk Batch服务器时，下载至PCD的参数子集：  
- 若选择**启动时下载（DL on Start）**，FactoryTalk Batch服务器会在向阶段发出START命令前将这些参数下载至PCD。下载验证通过后，服务器启动阶段。阶段逻辑可显式请求此操作，或配置阶段使服务器在发出START命令前自动下载这些参数。  
- 若选择**控制转移时下载（DL on TOC）**，控制转移情况发生时，参数将下载至PCD。控制转移指配方中存在同一阶段的两个实例，且由非“<阶段名称>.State = Complete”的转移条件分隔，此时转移条件为真时，阶段的运行逻辑不会终止，阶段逻辑必须显式请求服务器将控制转移参数子集下载至PCD。  

**仅下载分配给DL on Start子集的参数**，使用以下下载请求：  
| **（OPC或FTD）阶段**   | **Logix5000 CIP阶段**               |
|------------------------|-------------------------------------|
| 1501或11501请求        | PXRQ指令，外部请求：下载输入参数子集<br>DINT[0] - 1 |

**仅下载分配给DL on TOC子集的参数**，使用以下下载请求：  
| **（OPC或FTD）阶段**   | **Logix5000 CIP阶段**               |
|------------------------|-------------------------------------|
| 1502或11502请求        | PXRQ指令，外部请求：下载输入参数子集<br>DINT[0] - 2 |

发出上述请求时，每个参数将下载至PCD中与阶段参数标签对应的内存地址或标签。  


#### 上传报告请求  
- 若选择**终端状态时上传（UL on Terminal State）**，阶段逻辑转换为COMPLETE、STOPPED或ABORTED终端状态后，FactoryTalk Batch服务器将从PCD上传此报告子集。阶段逻辑可显式请求服务器上传这些报告，或配置阶段使服务器在阶段逻辑转换为终端状态后自动上传。  
- 若选择**控制转移时上传（UL on TOC）**，控制转移情况发生时，报告将上传至PCD，此时阶段逻辑必须显式请求服务器从PCD上传控制转移报告子集。  

**仅上传分配给UL on Terminal State子集的报告**，使用以下上传请求：  
| **（OPC或FTD）阶段**   | **Logix5000 CIP阶段**               |
|------------------------|-------------------------------------|
| 2501或12501请求        | PXRQ指令，外部请求：上传输出参数子集<br>DINT[0] - 1 |

**仅上传分配给UL on TOC子集的报告**，使用以下上传请求：  
| **（OPC或FTD）阶段**   | **Logix5000 CIP阶段**               |
|------------------------|-------------------------------------|
| 2501或12501请求        | PXRQ指令，外部请求：上传输出参数子集<br>DINT[0] - 2 |


#### 自动上传/下载  
自动上传/下载可缩短批次持续时间并减少阶段逻辑编程量，与下载参数子集和上传报告子集配合使用，使FactoryTalk Batch服务器自动下载启动时下载子集中的参数，或上传终端状态时上传子集中的报告。阶段逻辑可开发为发出这些请求，但非必需。  

使用自动上传/下载可将FactoryTalk Batch服务器配置为：  
- 当启动阶段的所有条件为真时，自动下载启动时下载子集中的参数。  
- 当阶段转换为COMPLETE、STOPPED或ABORTED终端状态时，自动上传终端状态时上传子集中的相应报告值。  

自动上传/下载无需阶段逻辑向FactoryTalk Batch服务器发送启动时下载或终端状态时上传请求。  

**提示**：控制转移时下载参数和控制转移时上传报告并非自动执行，仍需阶段逻辑请求。  

**启动时自动下载参数**和**终端状态时上传**需为每个阶段单独配置（前提是阶段所基于的阶段类(Phase Class)的参数和报告已分组到相应子集）。这两个功能可在阶段上独立配置。对于终端状态时上传，可指定自动功能适用的任何或所有终端状态（COMPLETE、STOPPED或ABORTED）。  

**提示**：FactoryTalk Batch服务器处理阶段逻辑请求出错时，会发出145（请求失败）命令值。增强错误处理阶段逻辑协议支持请求值比当前标准请求大10,000的情况。例如，使用增强阶段逻辑请求上传报告参数时，在标准请求代码2200基础上加10,000，得到增强请求代码12200。  


#### 带参数子集的控制策略  
若参数或报告分配给上传/下载参数子集且启用控制策略，仅上传或下载所有相关子集和所选控制策略的公共参数。  

**示例**：阶段类(Phase Class)包含多个报告和参数，启用控制策略且默认策略为CS1。当发出以下阶段逻辑请求时：  
- 启动时下载：仅包含SPEED、TIME、LEVEL和TEMP参数。  
- 控制转移时下载：仅包含SPEED和TIME参数。  
- 终端状态时上传：仅包含AVG_SPEED、AGITATE_TIME、AVG_TEMP和AMT_DUMPED报告。  
- 控制转移时上传：仅包含AVG_SPEED和AGITATE_TIME报告。  

| **参数**       | **DL on Start** | **DL on TOC** | **CS1** | **报告**         | **UL on Terminal State** | **UL on TOC** | **CS1** |
|----------------|-----------------|---------------|---------|------------------|---------------------------|--------------|---------|
| SPEED          | X               | X             | X       | AVG_SPEED        | X                         | X            | X       |
| TIME           | X               | X             | X       | AGITATE_TIME     | X                         | X            | X       |
| LEVEL          | X               |               | X       | AVG_TEMP         | X                         |              | X       |
| TEMP           | X               |               | X       | AMT_DUMPED       | X                         |              | X       |





### 电子签名  
电子签名是签名及其关联数据的电子表示，包括：  
- 签核含义（如审核、批准、责任或作者身份）  
- 签名者评论  
- 签名者安全要求  
- 签名日期和时间  

FactoryTalk Batch系统中的电子签名可由一、二或三个FactoryTalk用户或组完成签核。  


#### 电子签名类型  
可配置签名以验证以下运行时FactoryTalk Batch事件：  
- 自动和手动（eProcedure）阶段的报告参数。  
- 操作员通过FactoryTalk Batch View或FactoryTalk Batch View HMI控件对配方参数值的更改。  
- eProcedure步骤的完成。  
- 操作员通过FactoryTalk Batch View或FactoryTalk Batch View HMI控件发出的批次或阶段命令。  
- 可配置为在执行自动或手动阶段时随时显示的常规用途。  

电子签名与其对应的电子记录存储在FactoryTalk Batch事件日志中，这些签名包含符合21 CFR第11部分所需的所有组件。  


#### 电子签名工作原理  
配置和执行电子签名的步骤涉及FactoryTalk Batch产品套件：  
1. **FactoryTalk Batch系统管理员**设置电子签名和签核安全性。  
   **重要提示**：不支持在使用FactoryTalk Security配置电子签名后更改FactoryTalk目录服务器，否则可能导致签名签核失败。  
2. 在FactoryTalk Batch设备编辑器中，为签名事件设置FactoryTalk事件归档器的事件筛选器，以便在带Reporting Services的报告或其他报告中使用。  
3. 为区域模型创建签名模板：  
   - 若要获取特定阶段类的配方参数和报告参数的电子签名，需在创建或编辑阶段类时配置验证方法和签名模板。  
   - 若要将所有限制信息下载到阶段逻辑，需将参数标签和报告标签映射到阶段的相应限制标签。  
   - 若要对特定命令的执行要求签名验证，需使用创建的签名模板在FactoryTalk Batch设备编辑器中设置命令验证策略。  

构建主配方时，触发验证策略的配方参数限制默认来自设备阶段指定的参数限制，可在FactoryTalk Batch配方编辑器的配方级别更改这些值。若配置阶段类以获取报告限制偏差的签名，需在FactoryTalk Batch配方编辑器中为该阶段类的报告指定这些限制。  

当批次运行且发生需要签名验证的参数或报告偏差，或操作员发出需要签名验证的命令时，签名将添加到FactoryTalk Batch View、电子签名HMI控件或eProcedure客户端的签名列表中，提示相应用户输入签名。所有签名作为签名事件记录在FactoryTalk Batch View的事件日志查看器中。生成签名事件数据后，可创建FactoryTalk事件归档器报告或其他捕获电子签名数据的报告。  


#### 签名模板  
在设置需要电子签名的阶段类和配方之前，需先建立一组签名模板。每个模板定义所需的签核数、签核含义、签核是否包含评论，以及哪些用户或用户组具有完成签核的安全权限。根据业务流程需要创建多个模板以区分不同签名类型。  

创建签名模板的过程包括三个主要步骤：  
1. 添加签名模板  
2. 配置签名模板签核  
3. 分配签核的安全权限  


#### 编辑签名模板对话框  

| **名称**               | **用途**                                                                                                                                                                                                                                                                                                                                 |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **常规选项卡**         |                                                                                                                                                                                                          |
| Template Name          | 显示签名模板列表中所选模板的名称。若列表中无模板，此选项禁用。<br>- 模板名称必须唯一，长度1-50字符；<br>- 必须以字母开头，后续可包含字母、数字或下划线；<br>- 不区分大小写，不允许空格。                                                                                                                                                                                                                                                           |
| Template Index         | 模板列表中所选模板的唯一标识号，必须为1-2,147,483,647的正整数。                                                                                                                                                                                                                                                                         |
| Signoffs Required      | 此模板代表的验证策略所需的签名数。                                                                                                                                                                                                                                         |
| Last Signoff           | 指示哪个签核必须在其他签名输入后最后完成。若选“无”，签名可按任意顺序输入。                                                                                                                                                                                                                                                             |
| New Template           | 打开“创建签名模板”对话框以添加新模板到列表。                                                                                                                                                                                                                               |
| Delete Template        | 从列表中删除所选模板。若模板被任何命令、阶段类参数或报告的验证策略使用，则无法删除。                                                                                                                                                                                                                                                   |
| **签核选项卡**         |                                                                                                                                                                                                          |
| Template Name          | 列出在常规选项卡中添加的模板，选择模板以查看或配置签核信息。                                                                                                                                                                                                                                                                             |
| Signoff                | 列表中的每个数字代表所选模板的必需签名，数值由常规选项卡中“所需签核数”决定。选择签核编号时需考虑常规选项卡中“最后签核”的选择。                                                                                                                                                                                                         |
| Meaning（可选）        | 输入描述所选签核意义的短语（如“签名者授权命令”“签名者完成”），该内容作为签核事件的一部分记录在事件日志中，长度0-80字符，可包含任何可见可打印字符，不支持特殊控制字符。                                                                                                                                                                                                                         |
| Comment                | 选择签核时签名者是否可添加评论（可选、必需或不允许）。                                                                                                                                                                                                                     |
| Security Permissions   | 显示可完成所选签核的用户和用户组。若为空，说明尚未配置安全权限，关闭对话框前必须为所有签核配置权限。                                                                                                                                                                                                                                   |
| Add                    | 打开“选择用户或组”对话框，选择有权限完成签核的用户和组。                                                                                                                                                                                                                 |
| Delete                 | 从安全权限中删除所选用户或组，移除其完成签核的权限。                                                                                                                                                                                                                     |


#### 添加签名模板  
**操作步骤**：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“文件”>“打开”，选择区域模型文件。  
3. 选择“编辑”>“签名模板”，打开编辑对话框。  
4. 选择“新建模板”，打开创建对话框。  
5. 在“模板名称”中输入唯一名称（以字母开头，可包含字母、数字、下划线，不区分大小写，无空格）。  
   **提示**：名称应便于识别模板属性或用途，配置命令验证策略、阶段类和配方时用于标识模板。  
6. （可选）“模板索引”默认生成唯一编号，如需修改，输入正整数（若输入小数，自动取整；若与其他模板重复，显示错误）。  
7. 选择“确定”，新模板添加到列表。  
8. 在“所需签核数”中选择模板需要的签名数。  
9. 在“最后签核”中选择必须最后完成的签核编号（若无需顺序，选“无”）。  
10. 配置模板的签核（见下一步）。  


#### 配置签名模板签核  
**前提条件**：已添加签名模板。  
**操作步骤**：  
1. 打开设备编辑器，进入“编辑签名模板”对话框的“签核”选项卡。  
2. 从“模板名称”中选择要配置的模板。  
3. 从“签核”中选择要配置的编号（与常规选项卡的“所需签核数”对应，需考虑“最后签核”的选择）。  
4. （可选）在“含义”中输入描述签核意义的短语（显示在事件日志中）。  
5. 从“评论”中选择签名者是否可添加评论（可选、必需或不允许）。  
6. 在“安全权限”下为签核分配用户或组权限（完成后，用户和组名将显示在安全权限区域，具体步骤见“分配签核安全权限”）。  
7. 选择“应用”。  
8. 若模板需要多个签核，重复步骤3-7直至完成所有配置。  
   **提示**：多个签核时，每个签核必须使用唯一用户ID和密码。  
9. 完成配置后，可返回常规选项卡添加其他模板或选择“确定”关闭对话框。  


#### 分配签核安全权限  
**前提条件**：已添加签名模板，并在签核选项卡中输入模板名称、选择签核编号和评论选项，输入含义。  
**操作步骤**：  
1. 打开设备编辑器，进入签核选项卡的“安全权限”区域，选择“添加”，打开“选择用户或组”对话框。  
2. 选择“显示所有”查看所有用户和组（包括FactoryTalk安全用户/组和Windows链接用户/组）。  
   **提示**：添加用户/组后更改FactoryTalk目录服务器可能导致签核失败。  
3. 选择合适的用户或组，选择“确定”。  
   **重要提示**：使用FactoryTalk Security配置电子签名后更改目录服务器可能导致签核失败。  


#### 移除签核权限  
**操作步骤**：  
1. 打开设备编辑器，选择“编辑”>“签名模板”，选中模板并进入签核选项卡。  
2. 在“安全权限”中选择要移除的用户或组，选择“删除”，确认后选择“确定”。  


#### 删除签名模板  
**限制条件**：若模板用于以下场景，则无法删除：  
- 任何命令的验证策略；  
- 阶段类参数或报告的验证策略；  
- 配方的批准流程。  
**前置操作**：  
- 修改使用该模板的命令验证策略，更换模板或取消签名验证；  
- 修改阶段类参数或报告的验证策略，更换模板或删除参数/报告；  
- 修改配方批准步骤的签核模板。  
**操作步骤**：  
1. 打开设备编辑器和区域模型文件，选择“编辑”>“签名模板”。  
2. 选中要删除的模板，选择“删除模板”，从列表中移除后选择“确定”。  


#### 修改签名模板  
**限制条件**：若模板当前用于任何命令、阶段类参数或报告的验证策略，或分配给配方批准步骤，则无法修改模板名称或索引。  
**前置操作**：同删除模板的前置操作。  
**重要提示**：更改模板的“所需签核数”可能影响“最后签核”的值。若更改导致“最后签核”大于“所需签核数”，“最后签核”自动改为“无”。  
**操作步骤**：  
1. 打开设备编辑器和区域模型文件，选择“编辑”>“签名模板”，选中要修改的模板。  
2. 在常规选项卡中按需修改字段，选择“确定”。  


#### 命令验证策略  
设置命令验证策略以获取操作员通过FactoryTalk Batch View或HMI控件发出的批次/阶段命令的签名。配置前需先创建描述命令签核策略的签名模板。  
**重要提示**：若启用“移除”命令的签名验证，所有发送至服务器的AUTOREMOVE执行将失败并生成错误（AUTOREMOVE用于批次状态为COMPLETE时自动移除）。  


#### 为命令添加电子签名  
**操作步骤**：  
1. 打开设备编辑器，选择“编辑”>“命令策略”。  
   **提示**：当前FactoryTalk Security不支持保护eProcedure指令文件，需对“参数更改”设置电子签名以防止未授权用户执行指令。  
2. 选中需要电子签名的命令旁的复选框。  
3. 从“选择模板”中选择定义该命令签名策略的模板，选择“确定”，模板名称将显示在命令旁。  
4. 重复步骤2-3配置其他命令，完成后选择“确定”。  


#### 编辑命令验证策略  
**对话框组件说明**：  
- **Command**：显示可配置电子签名的命令（只读）。  
- **Requires Signature**：打开选择模板对话框，选中后命令执行时需要电子签名。  
- **Signature Template**：显示命令的验证策略模板，若无需签名则禁用。点击浏览可更换模板。  


#### 更改命令验证策略  
**前提条件**：已存在描述新签核策略的签名模板（若无则先创建）。  
**操作步骤**：  
1. 打开设备编辑器，选择“编辑”>“命令策略”。  
2. 点击要更改的签名模板旁的浏览按钮。  
3. 在选择模板对话框中选中新模板，选择“确定”，新模板名称将显示在命令旁。  
4. 重复步骤2-3更改其他策略，完成后选择“确定”。  


#### 移除命令的签名要求  
**操作步骤**：  
1. 打开设备编辑器，选择“编辑”>“命令策略”。  
2. 清除对应命令旁的“需要签名”复选框，模板框变为灰色，表示不再使用该模板。  
   **提示**：若重新启用签名，选中复选框即可恢复之前的模板。  
3. 选择“确定”。


### 配方审批流程概述  
配方审批流程用于验证批次配方的开发和维护。通过签名认证，该流程以正式方式保护设计工作流，确保每个配方在发布至生产环境或作为更大配方的组件发布前，均由授权人员完成验证。  

配方审批流程在FactoryTalk Batch设备编辑器中配置和启用，然后在FactoryTalk Batch配方编辑器中执行。审批流程完成后，配方将添加到FactoryTalk Batch视图的配方列表中，此时可基于该配方生成生产批次。  

除了最多包含六个审批步骤（三个可选）的主审批流程外，还提供两步快速审批流程。主流程和快速流程均支持回退选项，允许在配方审批流程中前进或回退。  


### 配方审批任务  
作为必要的第一步，FactoryTalk Batch系统管理员需设置电子签名以确保签核安全性。  
通常，管理员或拥有完整管理权限的工艺工程师会在FactoryTalk Batch设备编辑器中定义签名模板。签名模板规定哪些用户可对配方审批步骤进行签核（批准或回退该步骤）。  

工艺工程师还需在FactoryTalk Batch设备编辑器中根据定义的审批流程配置配方审批步骤。主审批流程最多包含六个步骤（三个可选），而快速审批流程仅涉及两个审批步骤。  
最后，主审批流程（或快速审批流程）在FactoryTalk Batch配方编辑器中执行。  


### 流程图  
此流程图展示了配方审批签名的设置、配置和执行任务的顺序。  


### 配置配方审批步骤  
使用“配方审批配置”对话框配置主审批流程和快速审批流程的步骤，包括为所选审批步骤分配步骤名称、顺序、并发规则和签名模板。保存区域模型后，FactoryTalk Batch设备编辑器将存储当前的配方审批流程配置。  

**提示**：配方审批流程通过签核在主审批流程、快速审批流程中推进，或从先前审批回退。请确认现有签名模板是否满足配方审批签核需求，或是否需要创建额外模板。  

#### 配置配方审批步骤的操作步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“配方审批配置 Recipe Approvals Configuration”，打开“配方审批配置”对话框。  
   **提示**：若在FactoryTalk策略下配置为“仅查看”访问权限，则“确定”按钮禁用，更改不会保存。  
3. 配置审批流程的步骤。三个步骤为必选：第一个列出的步骤（默认标签为“开始审批”）、“将配方作为步骤发布”和“将配方发布至生产”，在启用配方审批前必须配置“批准”和“回退”签核。  
   - 对每个步骤，选择“批准Approval签名模板”。点击浏览...，从“选择签名模板”对话框的模板列表中选择模板，然后选择“确定”。  
   - 对每个步骤，选择“回退Revert签名模板”。点击浏览...，从“选择签名模板”对话框的模板列表中选择模板，然后选择“确定”。  
   **提示**：配置期间或配置后，可通过从“步骤顺序”列表中选择所需编号并点击“刷新顺序”来更改可选步骤的顺序。  
4. （可选）若要在主审批流程中启用三个可选步骤中的一个或多个，勾选所需步骤旁的复选框。启用后，可根据需要自定义这些步骤的名称和描述。可选步骤可按方法论要求的任何审批里程碑命名。  
5. 为所有已启用步骤配置“批准”和“回退”签名模板后，勾选“启用配方审批”复选框，当前项目中的所有配方将启用配方审批流程。  
   **重要**：受配方审批保护的配方禁止创建、修改或删除配方配方。修改操作包括更改配方名称、配方描述或配方参数值。  
   可通过回退已批准的配方来创建、修改或删除配方。  
   若受配方审批保护的配方中的配方无效，需解决问题后才能对配方进行签名。  
6. 选择“确定”关闭对话框。  
7. 保存区域模型并退出FactoryTalk Batch设备编辑器。在FactoryTalk Batch配方编辑器中打开并根据更新的区域模型验证所有配方，以激活审批流程。  


### 配方审批步骤的实际审批  
配方步骤的实际审批在FactoryTalk Batch配方编辑器中完成，可使用主审批流程或快速审批流程。  


### 配方审批配置设置  
“配方审批配置”对话框包含以下内容：  

| 名称         | 用途                                                                 |  
|--------------|----------------------------------------------------------------------|  
| 步骤顺序     | 步骤的审批顺序。可存在多个相同编号的步骤，此时必须批准该编号的所有步骤后，配方才能进入下一步。 |  
| 步骤名称     | 每个审批步骤的名称，提供默认名称。如需可编辑第一个步骤和可选步骤的名称，名称必须唯一，以0-9或A-Z开头，最多32个字符。 |  
| 批准         | 批准签核模板。                                                       |  
| 回退         | 回退签核模板。                                                       |  
| 描述         | 每个审批步骤的可编辑描述，最多128个字符。                             |  


### 编辑配方审批  
#### 编辑配方审批的操作步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“配方审批配置”，打开“配方审批配置”对话框。  
3. 进行必要修改。例如，启用一个可选审批步骤并分配批准和回退签核。  
4. 选择“确定”。  
5. 保存区域模型，点击“调用配方编辑器”（ ）打开FactoryTalk Batch配方编辑器。  
   **提示**：需重启FactoryTalk Batch配方编辑器才能查看更新的区域模型和配方审批更改。  


### 禁用配方审批  
#### 禁用配方审批的操作步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“配方审批配置”，打开“配方审批配置”对话框。  
3. 取消勾选“启用配方审批”。  
4. 选择“确定”，系统将显示警告对话框：下次打开FactoryTalk Batch配方编辑器时，当前工作集中所有配方的现有审批签核将被移除。  
5. 选择“确定”。  
6. 保存区域模型。  
7. （可选）点击“调用配方编辑器”（ ）打开FactoryTalk Batch配方编辑器。  
   **提示**：需重启FactoryTalk Batch配方编辑器才能查看更新的区域模型和配方审批更改。  



### 安全权限配置  
此流程图展示了安全权限配置和使用的任务顺序。  

保护区域模型和配方的权限在FactoryTalk管理控制台中分配。安全权限默认处于禁用状态。  

区域模型在FactoryTalk Batch设备编辑器中通过“安全权限”命令进行保护。FactoryTalk网络目录安全权限标识符(SAI)会写入区域模型架构。后续打开和编辑区域模型时，区域模型中的SAI必须与当前FactoryTalk网络目录的SAI匹配。若不匹配，则无法打开和编辑区域模型及其关联的配方。  

配方在FactoryTalk Batch配方编辑器中通过“安全权限”命令进行保护。FactoryTalk网络目录SAI会写入配方头部数据。后续在FactoryTalk Batch配方编辑器中打开和编辑配方时，配方中的SAI必须与当前FactoryTalk网络目录的SAI匹配。受保护配方的导入和导出操作将受到限制。  


### 保护区域模型  
区域模型通过“安全权限”命令进行保护。  

#### 保护区域模型的操作步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 打开要保护的区域模型。  
   **重要**：在将区域模型保护到特定的FactoryTalk网络目录之前，Rockwell Automation建议备份FactoryTalk网络目录，并将区域模型文件的未保护版本以配置(.cfg)、XML(.axml)或文本(.txt)格式存储在安全位置。  
   有关备份详情，请参阅FactoryTalk帮助：选择“开始”>“Rockwell Software”>“FactoryTalk工具”>“FactoryTalk帮助”。  
   一旦区域模型被特定的FactoryTalk网络目录保护，若与该目录关联的安全权限标识符不再存在，则无法打开该区域模型。  
3. 选择“编辑”>“安全权限”，打开“安全权限”对话框。  
4. 勾选复选框以保护区域模型。若复选框未启用，说明登录的用户账户无权使用此功能。  
5. 选择“确定”。  


## 数据服务器概述  
FactoryTalk Batch数据服务器是一种系统对象，用于引用OPC、FactoryTalk Linx FactoryTalk LiveData或通用工业协议(CIP)数据服务器程序及其关联数据源之一。这些数据服务器引用为FactoryTalk Batch View或HMI软件提供来自过程连接设备(PCD)的运行时信息。数据服务器用于在FactoryTalk Batch服务器与PCD之间传递数据。  

需为每个与FactoryTalk Batch服务器通信的数据源及其关联的数据服务器程序配置独立的FactoryTalk Batch数据服务器。  

在FactoryTalk Batch设备编辑器中，为每个与FactoryTalk Batch服务器通信的数据服务器程序（及其关联数据源）添加数据服务器定义。这使FactoryTalk Batch能够访问PCD内的当前标签数据，这是成功运行配方、仲裁设备以及控制单个阶段或操作序列的必要条件。  

**提示**：FactoryTalk Linx FactoryTalk LiveData协议基于OPC数据访问协议。FactoryTalk Batch模拟器模拟数据服务器的功能，并可使用OPC通信与FactoryTalk Batch服务器通信。FactoryTalk Batch阶段模拟器包含示例程序，可在不连接PCD的情况下运行以模拟批次过程。  


### 区域模型数据服务器  
区域模型中至少需要定义一个数据服务器。在向区域模型添加阶段或操作序列之前，需先定义数据服务器。  

**重要**：基于指令的服务器仅用于FactoryTalk eProcedure。打开区域模型时会自动创建该数据服务器。无法创建使用“InstructionBasedServer”数据服务器类型的新数据服务器。如果删除此数据服务器，所有阶段或操作序列及关联标签也将被删除。下次打开区域模型时，该数据服务器将自动重新创建。  

FactoryTalk Batch支持以下数据服务器协议：  
• OPC数据访问协议  
• FactoryTalk Live Data协议  
• 通用工业协议(CIP)  


### 数据服务器对话框  
“数据服务器”对话框提供为活动区域模型定义的数据服务器列表。当创建阶段或操作且列表中显示多个数据服务器时，列表中的第一个数据服务器为默认服务器。选择“名称”标题可按字母升序或降序对列表进行排序。  


#### 数据服务器对话框包含：  

| 名称       | 用途                                                                 |  
|------------|----------------------------------------------------------------------|  
| 名称       | 数据服务器的用户定义名称。选择“名称”标题可按字母升序或降序对数据服务器排序。 |  
| 类型       | 数据服务器的类型，由DSDF文件定义。选择“类型”标题可按字母升序或降序对数据服务器类型排序。 |  
| 添加       | 打开“添加数据服务器”对话框，用于向区域模型添加新数据服务器。               |  
| 编辑       | 打开“编辑数据服务器”对话框，用于编辑现有数据服务器。                       |  
| 删除       | 打开“删除数据服务器”对话框，用于删除现有数据服务器。对话框将显示所有关联的阶段或操作序列、阶段标签或操作序列标签以及将被删除的单元属性标签列表。 |  
| 关闭       | 关闭对话框且不应用数据服务器选择。                                       |  


### 编辑数据服务器  
编辑与单元属性标签、阶段或阶段内任何标签关联的OPC或FactoryTalk® Linx FactoryTalkLive Data服务器时，“类型”列表中不会显示Logix5000 CIP。可将一种OPC类型更改为另一种，或从OPC类型更改为FactoryTalk Linx FactoryTalkLive Data类型（例如，将模拟器OPC数据服务器的“类型”更改为Rockwell FactoryTalk Linx OPC），但无法将OPC或FactoryTalk Linx FactoryTalkLive Data类型服务器更改为Logix5000 CIP类型数据服务器。  

若要将“类型”更改为Logix5000 CIP，需删除数据服务器并添加新服务器。  

**重要**：使用FactoryTalk Linx与Live Data/OPC数据服务器时，必须在\Batch\DataServers文件夹中的FTLX.dsdf文件中添加以下条目：  
ForceBoolTrueToOne=YES  
从RSLinx Classic更新到FactoryTalk Linx时也需要此设置。  

#### 编辑数据服务器的操作步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“数据服务器”以打开“数据服务器”对话框。  
3. 选择要编辑的数据服务器定义，然后选择“编辑”，打开“编辑数据服务器”对话框。  
4. 进行所需更改，然后选择“确定”返回“数据服务器”对话框。  
   分配给已修改数据服务器定义的所有阶段标签将更新以反映更改。  
5. 关闭“数据服务器”对话框。  


### 删除数据服务器  
#### 删除数据服务器的操作步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 打开“数据服务器”对话框。  
3. 选择要删除的数据服务器，然后选择“删除”。  
   - 如果数据服务器未分配给任何阶段或操作序列，将显示以下消息：  
   - 如果数据服务器分配给任何阶段、操作序列或单元属性标签，将打开“删除服务器”对话框，其中列出与该数据服务器关联的所有阶段、操作序列和单元属性标签。  
   **提示**：删除数据服务器时，显示的阶段或操作序列及其所有标签，以及显示的单元属性标签将被删除。  
4. 执行以下操作之一：  
   - 若要删除数据服务器并移除所有关联的阶段或操作序列及标签，选择“是”。  
   - 若要取消删除并返回“数据服务器”对话框，选择“否”。  
5. 关闭“数据服务器”对话框。  


### 分配数据服务器  
添加数据服务器后，将其分配给阶段、操作序列或单元。  

| 阶段或操作序列                | 单元                                                                 |  
|-------------------------------|----------------------------------------------------------------------|  
| 将数据服务器分配给阶段或操作序列，以将设备部件链接到指定控制器。 | 将相同数据服务器分配给单元中后续创建的所有阶段或操作序列。在“编辑单元”对话框中选择数据服务器。 |  


### OPC数据服务器  
添加数据服务器到区域模型时，必须在“添加数据服务器”对话框中配置以下项目：  

| 名称                     | 用途                                                                 |  
|--------------------------|----------------------------------------------------------------------|  
| 名称                     | 数据服务器定义的唯一用户定义名称。                                       |  
| 类型                     | 数据服务器类型的各种选项在单独的DSDF文件中定义。                           |  
| 默认项访问路径           | OPC项访问路径，作为分配给该数据服务器的所有后续创建阶段中标签的默认路径。<br>若要将所有阶段标签的访问路径重置为此值，在“编辑阶段”对话框的“标签”选项卡中选择“默认值”。标签项名称也将重置为包含阶段名称。 |  
| Watchdog项访问路径         | 适用于不需要单独读写项的数据服务器的OPC Watchdog项访问路径。对于需要单独读写项的数据服务器，此标签更改为“Watchdog读取项访问路径”，仅用于读取项访问路径。根据数据服务器类型，此设置为可选。 |  
| Watchdog项名称             | 适用于不需要单独读写项的数据服务器的OPC Watchdog项名称。对于需要单独读写项的数据服务器，此标签更改为“Watchdog读取项名称”，仅用于读取项名称。 |  
| 位置                     | 仅用于OPC数据服务器。OPC数据服务器的位置。如果数据服务器位于本地计算机，必须选择“本地”。如果数据服务器位于远程网络计算机，必须选择“远程”并提供数据服务器所在计算机的名称。使用网络传输的命名方案输入远程计算机的名称。默认支持通用命名约定(UNC)名称和域名系统(DNS)名称。 |  
| FactoryTalk Linx服务器路径 | 仅用于FactoryTalk Linx FactoryTalkLive Data服务器。定义FactoryTalk目录中数据服务器路径的字符串。（有关详细信息，请参阅FactoryTalk LinxLive Data服务器。） |  
| Watchdog协议               | 数据服务器使用的Watchdog协议类型，可为“标准”或“增强”协议。                     |  
| Watchdog写入项访问路径     | Watchdog写入项的OPC访问路径。如果数据服务器不需要单独读写项或不需要访问路径，则此选项禁用。 |  
| Watchdog写入项名称         | Watchdog写入项的OPC项名称。如果数据服务器不需要单独读写项，则此选项禁用。       |  
| 扫描速率                 | 数据服务器的默认“控制中”和“非控制中”扫描速率（以毫秒为单位）。“控制中”扫描速率的有效范围为250到30,000毫秒，“非控制中”扫描速率的有效范围为250到60,000毫秒。这些速率的使用取决于所选数据服务器的类型。通常无需修改这些值。 |  


#### 添加OPC数据服务器  
**提示**：使用FactoryTalk Linx与LiveData/OPC数据服务器时，必须在\Batch\DataServers文件夹中的RSLinxEnterprise.dsdf文件中添加以下条目：  
ForceBoolTrueToOne=YES  
从RSLinx Classic更新到FactoryTalk Linx时也需要此设置。  

操作步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“数据服务器”，打开“数据服务器”对话框。  
3. 选择“添加”。  
4. 在“名称”中，为数据服务器输入名称。  
5. 从“类型”中，选择与所定义的物理OPC数据服务器对应的数据服务器定义。  
6. 如有必要，为“默认项访问路径”、“Watchdog项访问路径”和“Watchdog项名称”输入适当值。  
7. 在“位置”下，选择适当选项。如果选择“远程”，输入远程数据服务器的名称。  
8. 选择“更多”，显示其他选项。  
9. 在“Watchdog协议”下，选择“标准”或“增强”协议。  
10. 如有必要，为“Watchdog写入项访问路径”和“Watchdog写入项名称”输入适当值。  
11. 在“扫描速率”下，输入数据服务器的“控制中”和“非控制中”扫描速率。  
12. 选择“确定”保存数据服务器配置并返回“数据服务器”对话框。  


### 在区域模型中配置FactoryTalk Linx OPC UA连接器数据服务器  
1. 确定FactoryTalk Linx OPC UA连接器访问路径（请参阅第87页“确定FactoryTalk Linx OPC UA连接器访问路径”）。  
2. 在设备编辑器的编辑菜单中，选择“编辑数据服务器”。  
3. 在“数据服务器”对话框列表中，选择“添加”。  
4. 在“添加数据服务器”对话框中，输入新数据服务器的名称。  
5. 从“类型”下拉菜单中选择“Live Data”。  
6. 输入第87页“确定FactoryTalk Linx OPC UA连接器访问路径”步骤11a中的默认项访问路径。  
7. 输入步骤11b中的Watchdog项访问路径。  
8. 输入Watchdog项名称。  
9. 选择“浏览”以浏览FactoryTalk Linx服务器路径并选择OPC UA路径。  
10. 选择“确定”。  

使用Live DataOPC UA数据服务器的阶段和单元标签必须使用正确的标签项格式，这与Live Data格式不同。OPC UA格式使用反斜杠(\)分隔符而非句点(.)。  
例如：  
- Live Data OPC UA：PC01U01_P01\PRM_USER\PRM_S\DATA[0]  
- Live Data：PC01U01_P01.PRM_USER.PRM_S.DATA[0]  
**注意**：使用句点将使用户只能读取而无法执行任何写入操作。  


#### 确定FactoryTalk Linx OPC UA连接器访问路径  
1. 从“开始”菜单启动FactoryTalkLive Data测试客户端。  
2. 等待“初始连接”窗口并选择“FactoryTalk”。  
3. 展开路径以打开为OPC UA服务器配置的区域，然后选择“确定”。  
4. 为创建组窗口的默认值选择“确定”。  
5. 在空白处右键单击并选择“添加项”。  
6. 展开树控件至OPC UA服务器实例。  
   a. 选择第一个项（此项显示插槽号、控制器类型和控制器文件）。  
   b. 从右侧项中选择“Watchdog项”，然后选择“确定”。  
7. Watchdog项已添加并显示质量良好。  
8. 右键单击Watchdog项并选择“复制项ID”。  
9. 将所选行粘贴到记事本中，该行可能如下所示：  
   Connector1::[UAServer 01]\05, 1756-L85EP/B_4467_BuildVerificat, OPCUA_QA67231\WatchDog  
10. 复制反斜杠之间的数据（包括反斜杠字符）：  
    \05, 1756-L85EP/B_4467_BuildVerificat, OPCUA_QA67231\  
11. 这是FactoryTalk Batch数据服务器配置中所需的默认项访问路径和Watchdog项访问路径。  
    a. 默认项访问路径 = Connector1::[UAServer 01]\05, 1756-L85EP/B_4467_BuildVerificat, OPCUA_QA67231\  
    b. Watchdog项访问路径 = Connector1::[UAServer 01]\05, 1756-L85EP/B_4467_BuildVerificat, OPCUA_QA67231\  


### FactoryTalk Linx FactoryTalk Live Data服务器  
FactoryTalk Linx FactoryTalk Live Data协议提供从OPC服务器和控制器读写实时制造数据的服务，适用于FactoryTalk目录中所有支持FactoryTalk的产品。FactoryTalkLive Data通过简化与多个服务器的通信，对OPC数据访问(DA)进行了改进。  

为支持FactoryTalk Batch作为FactoryTalkLive Data客户端，FactoryTalk Linx必须是FactoryTalk系统的一部分。FactoryTalk Linx是一种通信服务器，为罗克韦尔自动化应用程序和Logix处理器提供工厂底层设备连接。  


#### 添加数据服务器  
在FactoryTalk Batch设备编辑器中配置FactoryTalk®Live Data服务器所需的项目与OPC服务器相同，除了FactoryTalk Linx服务器路径。  

**前提条件**：  
• 安装并配置FactoryTalk Linx。（有关详细信息，请参阅FactoryTalk Linx帮助。）  
• 在FactoryTalk目录中创建应用程序。（有关详细信息，请参阅FactoryTalk管理控制台中的FactoryTalk帮助。）  
• 向FactoryTalk应用程序添加FactoryTalk Linx数据服务器。向应用程序添加数据服务器可在包含标签的硬件设备与FactoryTalk目录之间建立链接。（有关详细信息，请参阅FactoryTalk管理控制台中的FactoryTalk帮助。）  

操作步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“数据服务器”以打开“数据服务器”对话框。  
3. 选择“添加”以打开“添加数据服务器”对话框。  
4. 在“名称”中，为数据服务器输入名称。  
   **提示**：名称应便于识别此数据服务器所代表的Logix 5000控制器。使用Logix 5000控制器的类型及其在机架中的位置作为名称，或使用该控制器在工厂中连接的单元作为名称，有助于轻松识别控制器。  
5. 为“类型”选择“Live Data”。  
6. （可选）若要在完成此对话框中的其余信息前在区域模型中创建阶段或操作序列，选择“确定”关闭此对话框，稍后完成数据服务器信息的添加。  
7. 在“FactoryTalk Linx服务器路径”框中，选择“浏览”以定位与指定控制器通信的设备快捷方式。或者，使用以下格式输入快捷方式路径：RNA://Global/UsersApplicationName/FTLinxAreaName。  
8. 选择“更多”以查看Watchdog写入项访问路径和名称，以及数据服务器的控制中和非控制中扫描速率。  
9. 选择“确定”保存数据服务器配置并返回“数据服务器”对话框。  


#### FactoryTalk Linx服务器路径  
将FactoryTalk Linx数据服务器添加到FactoryTalk目录中的应用程序后，若要查看在FactoryTalk Batch设备编辑器中配置FactoryTalk Linx服务器类型所需的FactoryTalk Linx服务器路径连接字符串，请参阅“通信设置”对话框中的“通信设置”标题。  

在此示例中，FactoryTalk Linx服务器路径连接字符串为：  
RNA://$Global/MyApplication/  
（注意：路径中的最后一个名称（FactoryTalk Linx）未如图片所示显示在末尾。）  


#### 配置FactoryTalk Linx服务器路径  
操作步骤：  
1. 打开FactoryTalk管理控制台并登录到相应的FactoryTalk目录。  
2. 指向MyApplication > FactoryTalk Linx > 通信设置。  
3. 右键单击“通信设置”并选择“打开”，打开“通信设置”对话框。FactoryTalk Linx服务器路径连接字符串将作为标题的一部分显示。  


### Logix5000 CIP数据服务器  
在FactoryTalk Batch设备编辑器中配置Logix5000 CIP数据服务器以使用阶段管理器功能。  

若要使用阶段管理器配置FactoryTalk Batch系统，需添加Logix5000 CIP数据服务器并将其分配给阶段管理器阶段。完成这些配置任务后，通过将区域模型与项目文件同步，在Logix Designer项目文件中自动创建FactoryTalk Batch阶段。  


#### 添加Logix5000 CIP数据服务器  
可在创建区域模型中的其余元素之前或之后添加数据服务器，也可在区域模型中定义过程单元、单元类、阶段类、操作序列类和资源之后添加。在从阶段类创建特定阶段或从操作序列类创建特定操作序列之前，至少定义一个数据服务器。  

如果可能，在添加Logix5000 CIP数据服务器之前，先在Logix Designer中创建项目文件。添加Logix5000 CIP数据服务器时指定项目文件，以便在设计系统时更轻松地检测错误。  

**前提条件**：  
• 在FactoryTalk管理控制台中为所有与FactoryTalk Batch通信的阶段管理器或序列管理器对象的控制器配置设备快捷方式。  
• 安装并配置FactoryTalk Linx。（有关详细信息，请参阅FactoryTalk Linx帮助。）  
• 在FactoryTalk目录中创建应用程序。（有关详细信息，请参阅FactoryTalk管理控制台中的FactoryTalk帮助。）  
• 向FactoryTalk应用程序添加FactoryTalk Linx数据服务器。向应用程序添加数据服务器可在包含标签的硬件设备与FactoryTalk目录之间建立链接。（有关详细信息，请参阅FactoryTalk管理控制台中的FactoryTalk帮助。）  

操作步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“数据服务器”以打开“数据服务器”对话框。  
3. 选择“添加”以打开“添加数据服务器”对话框。  
4. 在“名称”框中，为数据服务器输入名称。  
   **提示**：名称应便于识别此数据服务器所代表的Logix 5000控制器。使用Logix 5000控制器的类型及其在机架中的位置作为名称，或使用该控制器在工厂中连接的单元作为名称，有助于轻松识别控制器。将区域模型与Logix Designer项目同步时，此名称将显示在“同步Logix5000数据服务器”对话框中。通过选择名称来选择要同步的数据服务器。  
5. 为“类型”选择“Logix5000 CIP”。  
6. （可选）若要在完成此对话框中的其余信息前在区域模型中创建阶段或操作序列，选择“确定”关闭此对话框，稍后完成数据服务器信息的添加。  
7. 若要启用.acd文件与区域模型之间的同步，选择“浏览”，导航到包含此数据服务器所代表控制器阶段的项目.acd文件。文件的修订版和控制器类型将显示在框中。  
   **提示**：Logix Designer项目文件必须为16.0或更高版本。  
   若选择项目文件时出现错误消息，请参阅“选择项目文件 - 错误消息”。  
8. 在“FactoryTalk Linx控制器快捷方式”框中，选择“浏览”以定位与指定控制器通信的设备快捷方式。或者，使用以下格式输入快捷方式路径：  
   RNA://Global/UsersApplicationName/FTLinxAreaName/FactoryTalkLinx/ShortcutName  
9. （可选）选择“更多”以显示“超时”和“重试”框。  
10. 这些框的默认值为推荐设置。可根据网络速度调整这些值。  

| 名称     | 值                                                                 |  
|----------|--------------------------------------------------------------------|  
| 超时     | FactoryTalk Batch服务器尝试联系控制器的间隔时间。有效值范围为500毫秒到100000毫秒，默认值为8000毫秒。 |  
| 重试     | FactoryTalk Batch服务器在断开连接前尝试联系控制器的次数。有效值显示在列表中，默认值为4。 |  

超时 * 重试 = FactoryTalk Batch服务器在丢失连接前尝试联系控制器的时间长度。  
11. 选择“确定”关闭“添加数据服务器”对话框。  
12. 选择“确定”关闭“数据服务器”对话框。  


#### 编辑Logix5000 CIP数据服务器  
操作步骤：  
1. 选择“编辑”>“数据服务器”，打开“数据服务器”对话框。  
2. 选择要编辑的数据服务器定义，然后选择“编辑”，打开“编辑数据服务器”对话框。  
3. 进行所需更改，然后选择“确定”返回“数据服务器”对话框。  
   **提示**：将数据服务器添加为Logix5000 CIP类型后，无法更改类型。编辑时，“类型”选择列表中不会显示其他数据服务器类型。若要更改类型，需删除数据服务器并添加新服务器。  
4. （可选）若要删除数据服务器，选择要删除的数据服务器并选择“删除”。  
   - 如果数据服务器未分配给任何阶段，将显示以下消息：  
   - 如果数据服务器分配给阶段，将打开“删除服务器”对话框，显示与该数据服务器关联的阶段和单元标签。  
   删除数据服务器时，显示的单元标签和阶段及其参数、报告和限制标签将被删除。  
   - 选择“是”删除数据服务器并移除所有关联的阶段和标签。  


#### 将Logix5000 CIP数据服务器分配给阶段或序列  
添加Logix5000 CIP数据服务器后，将其分配给每个代表与Logix5000 CIP数据服务器控制器网络路径中指定控制器连接的设备部件的阶段或序列。  

操作步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中选择阶段或序列图标，然后选择“编辑”>“属性”，显示“编辑阶段”对话框的“常规”选项卡。  
3. 从“数据服务器”列表中，选择代表与该阶段或序列定义的设备部件连接的控制器的Logix5000 CIP数据服务器。  
4. 选择“确定”。


### 资源概述  
资源是设备的通用术语，包括工艺单元、设备、阶段和共享控制模块。在将资源分配为共享设备之前，需在区域模型中定义资源。创建资源类（如PUMPS）和资源实例（如PMP102）。在区域模型中定义资源实例后，可将其分配给工艺单元、设备、阶段和其他资源，作为由FactoryTalk Batch服务器分配的必要设备。配置资源实例时，需分配名称、设备ID、最大所有者数量以及该资源的任何其他设备要求。定义最大所有者数量后，同时使用该资源的区域模型组件数量也随之确定。  

根据程序需求，资源可同时由一个或多个区域模型组件拥有。例如，若某台泵在物理配置上可向三个不同容器输送原料，但同时只能为其中两个容器供料，则将该泵定义为共享资源，并将最大所有者数量指定为2。  


#### 管理诊断页面系统元素  
当需要全面查看或管理某区域的系统元素时，使用“诊断”>“仲裁”。“诊断”>“仲裁”提供了从不同角度显示仲裁信息的方法。  

系统元素的所有者数量受其在区域模型中定义的限制。当系统元素当前未被拥有或当前所有者数量少于定义的最大所有者数量时，可获取该元素。只有当前所有者可以释放系统元素。  


#### 定义共享资源  
**操作步骤：**  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“资源”。  
3. 若要创建新资源类，选择“添加类”，显示“编辑资源类”对话框。  
   a. 在“名称”中输入新资源类的名称。  
   b. 选择“确定”返回“编辑资源”对话框，新资源类将显示在“资源类”列中。  
4. 若要向资源类添加资源实例，选择新资源类，然后选择“添加”，显示“编辑资源：[资源名称]”对话框。该对话框包含四个选项卡：  
   • 常规  
   • 仲裁  
   • 跨调用Cross Invocation  
   • 超链接  


##### 为资源设置常规信息  
**操作步骤：**  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“资源”。  
3. 在“资源”下选择资源，然后选择“编辑”。  
4. 在“编辑资源：[资源名称]”对话框中，选择“常规”选项卡。  
5. 在“名称”中输入资源名称（例如Pump101、PV203）。  
6. 输入适当的设备ID，或接受默认ID。  
7. 选择“应用”保存更改并继续，或选择“确定”返回“编辑资源”对话框。  


##### 配置仲裁信息  
在“编辑资源”对话框的“仲裁”选项卡中，“按资源分配设备”区域的左窗格包含分层视图，显示区域模型的当前设备配置。该分层结构有两个根节点：“工艺单元”和“资源”。右窗格是此资源依赖的设备列表。右窗格中的任何设备必须由FactoryTalk Batch服务器获取后，需要此资源的任何程序元素才能开始执行。  

展开“工艺单元”根节点可查看区域模型内的所有工艺单元。在此分层结构中，工艺单元包含设备，设备包含阶段。  
展开“资源”根节点可查看区域模型内所有已配置的资源实例列表。  

**操作步骤：**  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“资源”。  
3. 在“资源”下选择资源，然后选择“编辑”。  
4. 在“编辑资源：[资源名称]”对话框中，选择“仲裁”选项卡。  
5. 在“最大所有者”中输入数值，表示可同时拥有此资源的工艺单元、设备、阶段或其他资源的数量。  
6. 在“按资源分配设备”下，浏览区域模型的设备分层结构以指定此资源所需的设备。设备类型左侧的加号(+)表示已定义该类型的设备。  
   • 若要将设备添加到右窗格，在左窗格中选择资源所需的设备，然后选择“添加”，该资源需要获取的设备将显示在右窗格中。  
   • 若要移除设备，在右窗格中选择要删除的设备，然后选择“移除”，所选设备将从列表中移除。  
7. 选择“应用”保存更改并继续，或选择“确定”返回“编辑资源”对话框。  


##### 设置跨调用信息  
使用“跨调用”选项卡为不同资源类型指定跨调用标签。  

**操作步骤：**  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“资源”。  
3. 在“资源”下选择资源，然后选择“编辑”。  
4. 在“编辑资源：[资源名称]”对话框中，选择“跨调用”选项卡。  
5. 在“跨调用标签”中输入跨调用字符串内容信息。  
6. 选择“应用”保存更改并继续，或选择“确定”保存更改并返回“编辑资源：[资源名称]”对话框。  


##### 配置超链接信息  
此功能允许将超链接与任何设备资源关联。  

**操作步骤：**  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“资源”。  
3. 在“资源”下选择资源，然后选择“编辑”。  
4. 若使用超链接，在“编辑资源：[资源名称]”对话框中选择“超链接”选项卡。  
5. 在“超链接标签 # 英文”中输入有效URL字符串。  
6. 选择“应用”保存更改并继续，或选择“确定”返回“编辑资源：[资源名称]”对话框。  
7. 完成共享资源创建后，选择“确定”返回设计视图区域。  


## 全局绑定要求  
全局设备绑定要求是一组表达式，用于告知FactoryTalk Batch服务器哪些设备是配方的有效绑定候选。可针对设备类的实例计算绑定要求，以确定该类的哪些实例是设备需求的合法绑定候选。当FactoryTalk Batch服务器在配方执行期间尝试绑定设备需求时，将针对每个潜在绑定候选计算为该设备需求定义的所有绑定要求。无法满足为设备需求定义的所有绑定要求的设备将被排除在潜在绑定候选之外。  

全局绑定要求会自动应用于配方内的每个设备需求。在区域模型中预配置全局绑定要求，然后在FactoryTalk Batch配方编辑器中加载该区域模型，无需手动将绑定要求添加到每个配方的每个设备需求中。  

例如，全局绑定要求可能是“Days_since_CleanInPlace < 3”，这可能由企业质量标准强制规定，意味着除非设备在过去三天内进行过清洁，否则不视为可接受。作为全局设备要求，此要求需应用于工厂中的每个设备需求。  


#### 设备绑定表达式生成器  
在“设备绑定表达式生成器Unit Binding Expression Builder”中创建表达式。该生成器的左窗格包含类型列表，显示可用于构建表达式的配方头部和设备属性数据。  

选择“配方头部”时，列表视图（中间）将显示配方头部参数列表，这些参数名称与FactoryTalk Batch配方编辑器中配方头部定义的框对应。  
选择“设备属性”时，列表视图将按字母顺序显示区域模型内所有全局设备属性的列表。  

通过直接在“表达式生成器”文本框中输入、在列表视图和枚举视图中选择项目、选择各种操作符，或组合选择项目和操作符来创建或编辑表达式。“表达式生成器”的操作符按钮始终启用。选择操作符按钮时，相应操作符将插入到表达式的当前光标位置，并显示在“表达式生成器”文本框中。  


##### 表达式操作符  
绑定表达式支持以下操作符，执行优先级从高到低排列。优先级高的操作符先于优先级低的操作符执行。  

| 表达式操作符 | 用途                                                                 |  
|--------------|----------------------------------------------------------------------|  
| ( )          | 括号内的表达式先于括号外的表达式计算。                                 |  
| NOT, -       | 逻辑非、减法。                                                       |  
| *, /, AND    | 乘法、除法、逻辑与。                                                 |  
| +, -, OR     | 加法、减法、逻辑或。                                                 |  
| <, <=, >, >= | 小于、小于等于、大于、大于等于。                                     |  
| =, <>        | 等于、不等于。                                                       |  


##### 支持的数据类型  
支持的数据类型包括整数、实数、字符串和枚举。  
**注意**：FactoryTalk Batch不支持Logix5000版本32.00中引入的无符号数据类型。将FactoryTalk Batch标签配置为引用任何无符号数据类型（USINT、UINT、UDINT、ULINT）的控制器标签将导致通信错误。若尝试运行引用包含这些数据类型之一的标签的批次，在使用该标签时将发生通信失败。  
使用FactoryTalk Batch标签验证功能生成报告，以识别标签的任何问题。  

**数据类型示例：**  
- 整数：423  
- 实数：423.123456789012  
- 字符串：字符串常量必须用引号括起，如"READY"。  
- 枚举：作为字符串，枚举常量必须用引号括起，如"BUTTER_PECAN"；作为整数，枚举的序号可为4。  


##### 操作数  
全局设备绑定表达式中使用的操作数可引用配方头部数据、全局设备属性和常量。  

**允许的表达式实体及所需语法示例：**  

| 表达式实体       | 表达式语法      | 示例          |  
|------------------|-----------------|---------------|  
| 配方头部数据     | [配方头部项]    | [VERSION_NUMBER] |  
| 全局设备属性     | 设备属性名称    | CAPACITY      |  
| 常量             | 100             | 100           |  


##### 表达式验证  
尽管无法创建无效表达式，但先前有效的表达式可能因区域模型其他位置的后续更改而变得无效。调用“编辑全局设备绑定要求”对话框时，将重新验证所有绑定表达式。如果任何当前表达式因后续更改而变得无效，将打开错误消息，对话框会在每个无效表达式旁显示星号。  

表达式会验证一致性和语法正确性。如果定义的表达式验证成功，对话框将关闭。如果表达式无效，将突出显示遇到的第一个错误位置，在消息框中显示错误说明，且对话框不关闭。  

**验证规则：**  
• 表达式必须解析为TRUE或FALSE，并满足以下条件：  
  - 表达式必须至少包含一个操作符（+、-、*、/、=、>、<、<=、>=、<>、Not、And、Or）。  
  **提示**：如果表达式至少有一侧为TRUE，OR转换将触发。  
  - 用操作符分隔每个实体（配方头部、全局设备属性或常量）。  
  - 操作的实体必须解析为可接受的数据类型（字符串与字符串；整数与整数或实数；实数与整数或实数）。  
• 表达式最大长度不得超过1023个字符。  
• 允许重复表达式。  


#### 创建全局绑定要求  
**操作步骤：**  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“全局绑定要求”。  
3. 选择“添加要求”。  
4. 在“设备绑定表达式生成器”对话框中，从三个不同部分选择选项或输入以构建表达式。  
   **提示**：绑定要求表达式解析为TRUE或FALSE值，例如TEMPERATURE < 20.3。  
5. 选择“确定”保存表达式并返回“编辑全局设备绑定要求”对话框。  
6. 继续构建更多绑定要求，或选择“确定”退出对话框。  


#### 编辑绑定要求  
**操作步骤：**  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“全局绑定要求”。  
3. 选择要编辑的要求旁的浏览( )。  
4. 进行所需更改，然后选择“确定”。  
5. 选择“确定”关闭“编辑全局设备绑定要求”对话框。  


#### 删除绑定要求  
**操作步骤：**  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“全局绑定要求”。  
3. 选择“删除要求”，然后选择“确定”确认删除或选择“取消”保留要求。  
4. 选择“确定”关闭“编辑全局设备绑定要求”对话框。


## 工艺单元概述  
工艺单元是设备的逻辑分组，包括生产一个或多个批次所需的单元。如果生产一个批次需要多个设备分组，则工艺单元可包含多个设备分组。工艺单元按类分组。对于所选区域中的每种工艺单元类型，必须首先创建一个工艺单元类。创建工艺单元类后，可在设计视图区域中创建该类的实例。  

### 创建工艺单元类  
使用以下说明创建工艺单元类。  
提示：如果图标列为空，请参见“验证图标路径”。  
创建工艺单元类的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在“类视图”区域中，确认列标题为“单元类”。如果不是，选择“向上”( ) 直到显示区域模型的顶层。  
3. 选择“类”>“新建工艺单元类”。  
4. 在“名称”中，输入工艺单元类的名称。  
5. 在“图标”下，选择一个图标。  
6. 选择“确定”。  

### 编辑工艺单元类  
使用以下说明编辑工艺单元类。  
编辑工艺单元类的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择要编辑的工艺单元类。  
3. 选择“编辑”>“属性”。将打开“编辑工艺单元类”对话框。  
4. 进行所需更改，然后选择“确定”返回“类视图”区域。  

### 创建工艺单元实例  
使用以下说明创建和配置工艺单元实例。  
创建和配置工艺单元实例的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择所需的工艺单元类。  
光标变为 c 形状。  
3. 将光标放在设计视图区域中的所需位置并选择。  
工艺单元图标将显示在设计视图区域中，默认名称为 PROCESS_CELL#（其中 # 是从 1 开始的连续编号）。  


### 配置工艺单元实例  
使用以下说明配置工艺单元实例。  
配置工艺单元实例的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中选择一个工艺单元图标。  
3. 选择“编辑”>“属性”。  
“编辑工艺单元”对话框将显示分配的默认值。该对话框包含四个选项卡：  
◦ 常规  
◦ 仲裁  
◦ 交叉调用  
◦ 超链接  

#### 设置工艺单元的常规数据  
使用以下说明配置常规数据。  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中选择一个工艺单元图标。  
3. 选择“编辑”>“属性”。  
4. 在“编辑工艺单元”对话框中，选择“常规”选项卡。  
5. 在“名称”中，输入工艺单元名称。  
6. 在“ERP 别名”中，输入 SAP R/3 工艺单元名称。  
ERP 别名是 SAP 中的工艺单元名称，用于将 FactoryTalk Batch 中的工艺单元映射到 SAP。  
7. 在“设备 ID”中，输入设备 ID，或接受默认值。  
8. 选择“应用”保存更改。  

#### “编辑工艺单元”的“常规”选项卡  
“编辑工艺单元”对话框的“常规”选项卡包含以下内容：  

| 名称       | 用途                                                                 |  
|------------|----------------------------------------------------------------------|  
| 名称       | 工艺单元的名称。（默认名称为 PROCESS_CELL#，# 是从 1 开始的连续编号，添加到区域时分配给每个工艺单元。） |  
| 图标       | 为工艺单元类选择的图标（仅查看）。                                     |  
| 类         | 工艺单元类的名称（仅查看）。                                           |  
| ERP 别名   | 阶段的 SAP 名称。ERP 别名将 FactoryTalk Batch 中的设备模块映射到 SAP。 |  
| 设备 ID    | 标识此工艺单元的设备编号。（默认 ID 基于下一个可用的连续编号自动分配给工艺单元，添加到区域的第一个项目分配 ID #1。）要请求此工艺单元，设备 ID 必须与阶段逻辑使用的设备 ID 相同。 |  


### 设置工艺单元的仲裁数据  
在“按资源分配设备”区域中，左窗格以层次结构显示区域模型的当前设备配置。层次结构有两个根：“工艺单元”和“资源”。右窗格是此工艺单元依赖的设备列表。此列表中的任何设备必须由工艺单元获取，之后链接到该工艺单元的任何程序元素才能开始执行。  
展开“工艺单元”可查看区域模型中定义的所有工艺单元。此处按层次结构组织：工艺单元包含单元，单元包含阶段。  
展开“资源”可查看区域模型中所有已配置资源的列表。  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中选择一个工艺单元图标。  
3. 选择“编辑”>“属性”。  
4. 在“编辑工艺单元”对话框中，选择“仲裁”选项卡。  
5. 在“最大所有者数”中，输入最大所有者数量。  
6. 浏览区域模型的设备层次结构，指定工艺单元必须获取的设备。设备类型左侧缺少加号或减号表示未定义该类型的设备，或该设备类型在此级别不能用作所需设备项。  
◦ 要添加设备，在“按资源分配设备”区域下，选择工艺单元所需的设备并选择“添加”。所选设备将显示在右窗格中。  
◦ 要删除设备，在右窗格中选择要删除的设备并选择“删除”。所选设备将从列表中移除。  
7. 选择“应用”保存更改。  

#### “编辑工艺单元”的“仲裁”选项卡  
“编辑工艺单元”对话框的“仲裁”选项卡包含以下内容：  

| 名称                 | 用途                                                                 |  
|----------------------|----------------------------------------------------------------------|  
| 名称                 | 工艺单元的名称（仅查看）。默认名称为 PROCESS_CELL#，# 是从 1 开始的连续编号，添加到区域时分配给每个工艺单元。 |  
| 图标                 | 为工艺单元类选择的图标（仅查看）。                                     |  
| 类                   | 工艺单元类的名称（仅查看）。                                           |  
| 最大所有者数         | 可同时使用此工艺单元的所有者（其他工艺单元、单元、阶段或其他资源）的最大数量。默认值为 1。 |  
| 按资源分配设备       | 此工艺单元所需的设备列表，以便任何链接到该工艺单元的程序元素开始执行。默认值为空。通常，将所需资源分配到尽可能低的级别，以在运行多个流程时实现最高效率。 |  


左窗格以层次结构显示区域模型的当前设备配置，层次结构有两个根：  
• 工艺单元：显示区域模型内的所有工艺单元。按层次结构组织：工艺单元包含单元，单元包含阶段和操作序列。  
• 资源：显示区域模型内所有已配置资源的列表。  
右窗格是此工艺单元依赖的设备列表。此列表中的任何设备必须由工艺单元获取，之后工艺单元本身才能被获取。  


### 设置工艺单元的交叉调用数据  
使用以下说明配置交叉调用数据。  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中选择一个工艺单元图标。  
3. 选择“编辑”>“属性”。  
4. 在“编辑工艺单元”对话框中，选择“交叉调用”选项卡。  
5. 在“交叉调用标签”框中输入交叉调用字符串信息。  
6. 选择“应用”保存更改。  

#### “交叉调用”选项卡属性  
“编辑工艺单元”对话框的“交叉调用”选项卡包含以下内容：  

| 名称                 | 用途                                                                 |  
|----------------------|----------------------------------------------------------------------|  
| 名称                 | 工艺单元的名称（仅查看）。默认名称为 PROCESS_CELL#，# 是从 1 开始的连续编号，添加到区域时分配给每个工艺单元。 |  
| 类                   | 工艺单元类的名称（仅查看）。                                           |  
| 图标                 | 为工艺单元类选择的图标（仅查看）。                                     |  
| 交叉调用配置         | 交叉调用字符串用于向 FactoryTalk Batch 视图和 HMI 控制快捷菜单添加项目，包括菜单项的标题和选择菜单项时传递给指定自动化服务器的数据。五个字段的默认标签为“交叉调用标签 #”（# 为 1 到 5）。这些标签可在“服务器选项”对话框中修改，并在“编辑工艺单元”对话框中显示。 |  


### 配置工艺单元的超链接数据  
此功能仅与 FactoryTalk eProcedure 结合使用。  
配置工艺单元超链接数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中选择一个工艺单元图标。  
3. 选择“编辑”>“属性”。  
4. 在“编辑工艺单元”对话框中，若使用超链接，选择“超链接”选项卡。  
5. 在“超链接配置”框中，输入有效的 URL 字符串。  
6. 选择“应用”保存更改。  
7. 选择“确定”返回设计视图区域。  

#### “编辑工艺单元”对话框 - 超链接选项卡  
“编辑工艺单元”对话框的“超链接”选项卡包含以下内容：  

| 名称                 | 用途                                                                 |  
|----------------------|----------------------------------------------------------------------|  
| 名称                 | 工艺单元的名称（仅查看）。默认名称为 PROCESS_CELL#，# 是从 1 开始的连续编号，添加到区域时分配给每个工艺单元。 |  
| 图标                 | 为工艺单元类选择的图标（仅查看）。                                     |  
| 类                   | 工艺单元类的名称（仅查看）。                                           |  
| 超链接配置           | 与每个超链接标签关联的 URL。五个字段的默认标签为“超链接标签 # English”（# 为 1 到 5），可在“服务器选项”对话框中修改，用于标识超链接用途。 |  


### 删除工艺单元实例  
使用以下说明删除工艺单元实例。  
删除工艺单元实例的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中选择一个工艺单元图标。  
3. 按 Delete 键。  
将显示“删除工艺单元”警告，列出删除工艺单元时将移除的关联单元和阶段。  
4. 选择“是”删除工艺单元，或选择“否”取消删除并返回 FactoryTalk Batch 设备编辑器。  


### 验证图标路径  
每种图标的目录路径由安装程序设置，仅当位图已移动到其他目录时才修改路径。  
验证图标路径的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“选项”>“目录”。  
3. 验证每种图标的目录路径。  
4. 选择“确定”返回设计视图区域。  


### 自定义图标  
使用图形绘制程序创建工艺单元类、单元类、单元类背景或阶段类的图形表示。创建特定于工厂或工艺的图标。设计自定义图标时请遵循以下规则：  
• 图标必须以 .bmp 文件格式存储在相应目录中。  
• 图标必须为正方形或矩形，宽度为偶数像素。宽度为奇数像素的图标将不显示。  
• 文件大小不得超过 7K（116 x 116 像素）。超过大小限制的图标将显示为带红色问号的空白图标。  
• 图标存储在以下目录之一中：  
◦ 工艺单元类  
C:\Program Files\Rockwell Software\Batch\BMP\PROCCEL  
◦ 单元类  
C:\Program Files\Rockwell Software\Batch\BMP\UNIT  
◦ 单元类背景  
C:\Program Files\Rockwell Software\Batch\BMP\UNIT\VESSELS  
◦ 阶段类  
C:\Program Files\Rockwell Software\Batch\BMP\PHASE  
提示：符合这些条件的新图标将显示在工艺单元类、单元类和阶段类的“图标”列中。



## 单元概述  
单元由阶段、控制模块或围绕含物料容器的两类模块组成，用于执行一项或多项主要处理活动。中央容器中的物料通常会发生物理、化学或生物转化。单元一次运行一个操作或单元程序级配方。工艺仪表流程图 (P&IDs) 是确定单元边界的重要信息来源。  
通常，工艺设施包含多个相似设备实例（如单元容器），这些设备由相同或相似的组件和功能组成。此类相似设备的分组可称为单元类。在区域模型数据库中，需创建单元类（如 MIXER_CLS）和特定单元类的一个或多个单元实例（如 MIXER_A 和 MIXER_B）。  

配方可配置为在特定单元实例或单元类中运行。指定配方运行的特定单元的操作称为单元绑定。若配方配置为在单元实例中运行，则在创建配方时指定运行单元；若配置为在单元类中运行，配方可在该单元类的任意实例中运行。具体单元实例的确定方式如下：  
• 由操作员在创建批次时、启动批次前指定。  
• 由操作员在批次启动后、单元程序级配方准备运行时（操作员响应提示）指定。  
• 由 FactoryTalk Batch 服务器在批次启动后、单元程序级配方准备运行时指定。  

基于类的配方具有以下优势：  
• 减少需要维护的配方数量。  
• 允许在批次运行时自由选择最适合绑定配方的单元。  
提示：要导航到单元层级，双击工艺单元图标或选择工艺单元图标并选择“向下”( )。  


### 创建单元类  
使用以下说明创建单元类。  
创建单元类的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在“类视图”区域中，确认列标题为“单元类”。  
“类视图”区域将显示所选工艺单元的当前单元类。  
3. 选择“类”>“新建单元类”。“创建单元类”对话框将打开并显示默认设置：  
◦ “单元属性”区域列出非全局单元属性。  
◦ “全局单元属性”区域为仅查看，列出与区域模型中每个单元类关联的单元属性。  
4. 在“名称”中，输入单元类名称。  
5. 在“图标”下，选择一个图标。  
提示：如果图标列为空，请参见“验证图标路径”。  
6. 如果已定义单元属性并将其与该单元类配合使用，请从“单元属性”列表中选中要分配给单元的标签复选框。  
提示：全局单元属性会自动与正在创建的单元类关联。  
7. 选择“确定”。  


### 编辑单元类  
使用以下说明编辑单元类。  
编辑单元类的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在“类视图”区域中，确认列标题为“单元类”。  
“类视图”区域将显示所选工艺单元的当前单元类。  
3. 选择要编辑的单元类，然后选择“编辑”>“属性”。  
4. 在“编辑单元类”对话框的“名称”中，输入新的单元类名称。  
5. 从“图标”中选择新的单元类图标，或修改现有的单元属性标签选择。如果存在全局单元属性，它们将列在“全局单元属性”列表中（仅查看）。  
6. 选择“确定”。  


### 创建单元实例  
使用以下说明创建单元实例。  
创建单元实例的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择要放置在设计视图区域中的单元类。  
3. 将光标放在设计视图区域中要放置单元的位置并选择。  
4. 配置单元实例。  


#### 单元实例配置  
单元配置包括：  
• 指定单元名称。  
• 创建单元属性标签。  
• 分配数据服务器。  
• 指定单元运行期间所需的任何设备资源。  


#### 打开“编辑单元”对话框  
使用“编辑单元”对话框执行单元配置。  
打开“编辑单元”对话框的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中，选择单元图标，然后选择“编辑属性”( )。“编辑单元”对话框将显示单元默认值，并包含以下五个选项卡：  
◦ 常规  
◦ 属性标签  
◦ 仲裁  
◦ 交叉调用  
◦ 超链接  


#### 配置单元的常规数据  
使用以下说明配置单元的常规数据。  
配置单元常规数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中，选择单元图标，然后选择“编辑”>“属性”。  
3. 在“编辑单元”对话框中，选择“常规”选项卡。  
4. 在“名称”中，输入资源名称。  
5. 在“类”中，输入类名。  
6. 在“ERP 别名”中，输入 SAP R/3 单元名称。  
7. 在“设备 ID”中，输入或接受默认 ID。  
8. 选择数据服务器。  
9. 选择“应用”保存更改并继续，或选择“确定”返回“编辑单元”对话框。  


#### “编辑单元”对话框 - 常规选项卡  
“编辑单元”对话框的“常规”选项卡包含以下内容：  

| 名称       | 用途                                                                 |  
|------------|----------------------------------------------------------------------|  
| 名称       | 工艺单元的名称。（默认名称为 PROCESS_CELL#，# 是从 1 开始的连续编号，添加到区域时分配给每个工艺单元。） |  
| 类         | 单元类的名称。                                                       |  
| ERP 别名   | 阶段的 SAP 名称。ERP 别名将 FactoryTalk Batch 中的设备模块映射到 SAP。 |  
| 设备 ID    | 标识此单元的设备编号。（默认 ID 基于下一个可用的连续编号自动分配给工艺单元，添加到区域的第一个项目分配 ID #1。）要请求此单元，设备 ID 必须与阶段逻辑使用的设备 ID 相同。 |  


#### 配置单元属性标签数据  
使用以下说明配置单元属性标签数据。  
配置单元属性标签数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中，选择单元图标，然后选择“编辑”>“属性”。  
3. 在“编辑单元”对话框中，选择“属性标签”选项卡。  
4. 在“单元属性标签”下，选择“添加”并创建所需的单元属性标签。  
提示：如果为区域模型创建了任何全局单元属性，其关联的标签也将列出。  
5. 要编辑现有标签，在“单元属性标签”区域中选择标签并选择“编辑”。将打开“编辑单元属性标签”对话框。  
提示：单元属性标签只能分配给 OPC 或 FactoryTalk Linx FactoryTalk Live Data 服务器，不能分配给 Logix5000 CIP 数据服务器。  
6. 要删除现有标签，在“单元属性标签”区域中选择标签并选择“删除”。  
提示：无法取消删除单元属性标签，但选择“取消”可撤销对单元定义所做的任何更改。  
7. 选择“应用”保存更改。  


#### “编辑单元”对话框 - 属性标签选项卡  
“编辑单元”对话框的“属性标签”选项卡包含以下内容：  

| 名称             | 用途                                                                 |  
|------------------|----------------------------------------------------------------------|  
| 名称             | 分配给此单元的唯一名称（仅查看）。                                     |  
| 类               | 单元类名称（仅查看）。单元类关联的图标显示在“名称”和“类”旁边。         |  
| 单元属性标签     | 与单元关联的过程连接设备数据，用于配方。单元属性标签按单元属性组织，单元属性标签实例在配置单元时创建。 |  


#### 配置单元的仲裁数据  
在“按资源分配设备”区域中，左窗格以层次结构显示区域模型的当前设备配置。树状结构有两个根：“工艺单元”和“资源”。右窗格是此单元依赖的设备列表。此列表中的任何设备必须由单元获取，之后链接到该单元的任何程序元素才能开始执行。  
展开“工艺单元”可查看区域模型内的所有工艺单元。此处按层次结构组织：工艺单元包含单元，单元包含阶段。  
展开“资源”可查看区域模型内所有已配置资源的列表。  
提示：单元没有用于定义的“最大所有者数”框，因为单元一次只能执行一个程序元素（操作或单元程序级配方），因此所有单元只能有一个所有者。  

配置单元仲裁数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中，选择单元图标，然后选择“编辑”>“属性”。  
3. 在“编辑单元”对话框中，选择“仲裁”选项卡。  
4. 浏览区域模型的设备层次结构，指定单元必须获取的设备。设备类型左侧缺少加号或减号表示未定义该类型的设备，或该设备类型在此级别不能用作所需设备项。  
◦ 要添加设备，在“按资源分配设备”区域下，选择单元所需的设备并选择“添加”。所选设备将显示在右窗格中。  
◦ 要删除设备，在右窗格中选择要删除的设备并选择“删除”。所选设备将从列表中移除。  
5. 选择“应用”保存更改。  


#### “编辑单元”对话框 - 仲裁选项卡  
“编辑单元”对话框的“仲裁”选项卡包含以下内容：  

| 名称                 | 用途                                                                 |  
|----------------------|----------------------------------------------------------------------|  
| 名称                 | 分配给此单元的唯一名称（仅查看）。                                     |  
| 类                   | 单元的类名称（仅查看）。                                               |  
| 类图标               | 单元类图标（仅查看）。                                                 |  
| 最大所有者数         | 此单元需要拥有的设备列表，以便任何链接到该单元的程序元素开始执行。       |  
| 按资源分配设备       | 此单元开始执行所需拥有的设备列表。                                     |  


左窗格以层次结构显示区域模型的当前设备配置，层次结构有两个根：  
• 工艺单元：显示区域模型内的所有工艺单元。按层次结构组织：工艺单元包含单元，单元包含阶段和操作序列。  
• 资源：显示区域模型内所有已配置资源的列表。  
右窗格是此单元依赖的设备列表。此列表中的任何设备必须由单元获取，之后单元本身才能被获取。  


#### 配置单元的交叉调用数据  
使用以下说明配置交叉调用数据。  
配置单元交叉调用数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中，选择单元图标，然后选择“编辑”>“属性”。  
3. 在“编辑单元”对话框中，选择“交叉调用”选项卡。  
4. 在“交叉调用标签”框中输入交叉调用字符串信息。  
5. 选择“应用”保存更改。  


#### “编辑单元”对话框 - 交叉调用选项卡  
“编辑单元”对话框的“交叉调用”选项卡包含以下内容：  

| 名称                 | 用途                                                                 |  
|----------------------|----------------------------------------------------------------------|  
| 名称                 | 分配给此单元的唯一名称（仅查看）。                                     |  
| 类                   | 单元的类名称（仅查看）。                                               |  
| 类图标               | 单元类图标（仅查看）。                                                 |  
| 交叉调用配置         | 交叉调用字符串用于向 FactoryTalk Batch 视图和 HMI 控制快捷菜单添加项目，包括菜单项的标题和选择菜单项时传递给指定自动化服务器的数据。五个字段的默认标签为“交叉调用标签 #”（# 为 1 到 5）。这些标签可在“服务器选项”对话框中修改，并在“编辑工艺单元”对话框中显示。 |  


#### 配置单元的超链接数据  
使用以下说明配置超链接数据。  
配置单元超链接数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中，选择单元图标，然后选择“编辑”>“属性”。  
3. 若使用超链接，在“编辑单元”对话框中选择“超链接”选项卡。  
4. 在“超链接配置”框中输入有效的 URL 字符串。  
5. 选择“应用”保存更改。  
6. 选择“确定”返回设计视图区域。  


#### “编辑单元”对话框 - 超链接选项卡  
“编辑单元”对话框的“超链接”选项卡包含以下内容：  

| 名称                 | 用途                                                                 |  
|----------------------|----------------------------------------------------------------------|  
| 名称                 | 分配给此单元的唯一名称（仅查看）。                                     |  
| 类                   | 单元类的名称（仅查看）。                                               |  
| 类图标               | 单元类图标（仅查看）。                                                 |  
| 超链接配置           | 与每个超链接标签关联的 URL。五个字段的默认标签为“超链接标签 # English”（# 为 1 到 5），可在“服务器选项”对话框中修改，用于 eProcedure 客户端设备视图。 |  


#### 删除单元实例  
使用以下说明删除单元实例。  
删除单元实例的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择要删除的单元并按 Delete 键。  
将显示警告：删除单元时，其包含的阶段实例也将被删除。  
3. 选择“是”删除单元，或选择“否”取消删除并返回 FactoryTalk Batch 设备编辑器。  


#### 链接单元实例  
链接定义了工艺单元内单元之间的上下游关系。FactoryTalk Batch 服务器使用链接来确定定义程序的设备需求时哪些单元可供选择。  
链接单元实例的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“链接单元”( )。光标变为 + 形状。  
3. 在源单元图标上按住鼠标按钮，将光标拖动到目标单元图标，然后释放鼠标按钮。  
4. 重复步骤 2，直到按需要链接所有单元。  


#### 共享单元  
当多个工艺单元需要单个单元实例时，该实例必须由所有需要它的工艺单元共享。在一个工艺单元中创建单元实例，其他工艺单元可共享此实例。请勿在其他工艺单元中创建同一单元的新实例。共享单元实例前，请验证该单元是否可实际共享。  
单元一次只能有一个所有者。共享单个单元可使任何共享的工艺单元在批次执行期间获得其所有权，但同一时间不能被多个工艺单元拥有。  
共享单元实例时，对其进行的任何更改将反映在包含该共享实例的每个工艺单元中，包括其在设计视图区域中的物理位置。从一个工艺单元中删除共享单元的实例时，该实例将从所选工艺单元中移除，但仍存在于其所属的其他工艺单元中。  

共享单元的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 创建要共享的单元。  
3. 切换到不包含此单元的工艺单元。  
4. 选择“共享”。“在工艺单元之间共享单元”对话框将显示现有工艺单元列表：  
◦ 工艺单元左侧的加号 (+) 表示该工艺单元内已定义单元；工艺单元左侧缺少加号或减号表示该工艺单元内未定义单元。  
◦ 选择相应工艺单元文件夹的加号 (+) 以显示每个工艺单元中的单元。  
5. 选择要共享的单元，然后选择“确定”。  
“在工艺单元之间共享单元”对话框关闭。所选单元的图标（左下角带小手图标）将显示在两个工艺单元中。  
提示：删除共享单元的实例仅删除与该单元的链接，直到删除该单元的最后一个实例时才会删除单元本身。



## 标签Tags概述  
FactoryTalk Batch 使用标签tags与过程连接设备 (PCD) 通信。对于 OPC 和 FactoryTalk® Linx FactoryTalk Live Data 阶段，需在区域模型设备数据库中定义标签。区域模型标签指向 PCD 中的特定内存地址或标签。FactoryTalk Batch 服务器与 PCD 通过这些标签交换信息并通信。  
提示：对于分配给 Logix5000 CIP 数据服务器的 PhaseManager 阶段，无需定义标签。当区域模型与 Logix Designer 项目同步时，标签将自动创建。  

区域模型包含两类标签：  
• 与单元关联的标签  
• 与阶段关联的标签  

单元属性标签是区域模型数据库中的项，表示单个 PCD 信息。单元属性标签链接到过程标签（如液位、温度或流量过程变量），允许配方转换条件中使用实际过程值。  
阶段使用阶段标签与 PCD 中的工程逻辑通信。每个阶段至少关联十个标准标签。定义用于创建 OPC 或 FactoryTalk Linx FactoryTalk Live Data 阶段的阶段类时，需指定参数和报告通信所需的标签数量，以及 PCD 向 FactoryTalk Batch 服务器发送请求的附加标签。  


#### 单元属性标签  
单元属性标签Unit attribute tag实例在单元实例配置时创建。单元属性（如 LEVEL_PV）组织单元属性标签实例（如 LI101_PV），每个实例链接到 PCD 中的特定标签。  
**重要**：每个单元的每个单元属性只能有一个单元属性标签实例。  
已定义的单元属性标签实例是区域模型数据库的一部分，可用于任何配方的配方转换条件。即，该实例可用于绑定到区域模型中任意单元的配方（不仅限于为其定义标签的单元）。  
提示：创建单元属性标签前，先整理 FactoryTalk Batch 连接的数据服务器和标签地址列表。创建以 OPC 或 FactoryTalk Linx FactoryTalk Live Data 服务器为数据源的单元属性标签，或表示 Logix5000 CIP 数据服务器标签信息的标签。  


##### 添加单元属性  
使用以下说明添加单元属性。  
添加单元属性的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“单元属性Unit Attributes”。  
3. 选择“添加”。  
4. 在“名称”中，输入新属性的名称。  
5. 从“类型”列表中选择适当的标签类型。  
6. 若标签类型为“枚举”，从“枚举”列表中选择适当的枚举名称。  
7. 输入标签使用的工程单位。  
8. （可选）输入属性的描述。  
9. 选择“确定”返回“编辑单元属性”对话框。  
10. 继续添加单元属性，或选择“确定”退出，所有更改将保存。  


##### 编辑单元属性  
使用以下说明编辑单元属性。  
**重要**：删除或修改全局单元属性可能导致现有全局单元绑定表达式失效。因此，选择“确定”时，区域模型中配置的所有全局单元绑定表达式将重新验证。若发现任何表达式无效，请打开“全局单元绑定要求”对话框进行更正。  
编辑单元属性的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“单元属性”。  
3. 在“属性”下，选择属性并选择“编辑”。  
4. 在“编辑单元属性”对话框中按需修改，然后选择“确定”返回“编辑单元属性”对话框。  


##### 删除单元属性  
使用以下说明删除单元属性。  
删除单元属性的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“单元属性”。  
3. 在“属性”下，选择属性并选择“删除”。  
4. 若要删除所有标签和所选属性，选择“是”。  
5. 若要取消删除，选择“否”。  


##### 创建单元属性标签  
使用以下说明创建单元属性标签。  
创建单元属性标签的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在设计视图区域中，右键单击相应单元。  
3. 选择“属性标签”选项卡。  
4. 在“单元属性标签”下，选择“添加”：  
◦ 若存在单元属性，将打开“创建单元属性标签”对话框；否则显示创建单元属性的提示。若显示提示，选择“是”，并按“添加单元属性”中的说明操作。  
5. 在“名称”中，输入单元属性标签的名称。  
6. 从“属性”中选择适当的单元属性。  
7. 从“类型”中选择适当的标签类型：  
若标签类型为“枚举”，从“枚举”中选择适当的枚举名称。  
8. 在“工程单位”中，输入标签使用的工程单位。  
9. 若选择“静态”，在“值”中输入单元属性标签的值。  
提示：动态单元属性标签的值存储在 PCD 中，静态单元属性标签的值存储在 FactoryTalk Batch 服务器中。  
10. 若选择“动态”：  
a. 从“数据服务器”中选择适当的数据服务器，“服务器类型”将自动显示对应的数据服务器类型。  
提示：选择列表中仅显示 OPC 和 FactoryTalk Linx FactoryTalk Live Data 服务器，不显示 Logix5000 CIP 数据服务器。  
b. 在“访问路径”中输入适当的访问路径。  
c. 在“项名称”中输入适当的项名称。  
d. 若数据服务器需要单独的读写项，在“写入访问路径”中输入写入访问路径。  
e. 若数据服务器需要单独的读写项，在“写入项名称”中输入写入项名称。  
11. 选择“确定”返回“属性标签”选项卡。  


#### “单元属性标签”对话框  
单元属性标签表示特定单元的单元属性值。在早期版本的 FactoryTalk Batch 中，单元属性标签称为单元标签。  
创建单元属性标签时，在“创建单元属性标签”对话框中配置以下项：  

| 名称           | 用途                                                                 |  
|----------------|----------------------------------------------------------------------|  
| 名称           | 单元属性的标签名称，请遵循命名约定。                                   |  
| 属性           | 列出单元属性标签的单元属性名称选项。                                   |  
| 类型           | 列出单元属性标签的数据类型选项，有效类型包括：<br>• 实数<br>• 整数<br>• 字符串<br>• 枚举 |  
| 枚举           | 列出适当的枚举选项，仅当标签类型为“枚举”时启用此列表。                 |  
| 工程单位       | 与此标签关联的工程单位。                                               |  
| 数据源         | 定义数据源类型为“静态”或“动态”：<br>• 若为“静态”，数据为常数值，此处输入的值取决于分配的工程单位并与特定单元关联；<br>• 若为“动态”，值来自 PCD，必须定义数据服务器信息。 |  
| 数据服务器     | 显示标签获取数据的数据服务器，列表包含活动区域的所有已配置数据服务器，仅显示 OPC 和 FactoryTalk Linx FactoryTalk Live Data 服务器，不显示 Logix5000 CIP 数据服务器。 |  
| 服务器类型     | 显示与数据服务器定义 (DSDF) 文件中定义的所选数据服务器对应的服务器类型（仅查看）。 |  
| 访问路径       | 尝试订阅标签值或执行读取操作时与读取项一起使用的访问路径。当关联的数据服务器需要单独的读写项时，此框变为“读取项访问路径”。若数据服务器不需要访问路径，此框禁用。 |  
| 项名称         | 订阅标签值或执行读取操作时使用的项名称。当关联的数据服务器需要单独的读写项时，此框变为“读取项名称”。 |  
| 写入访问路径   | 写入项的 OPC 访问路径。若数据服务器不需要单独的读写项，此框禁用。       |  
| 写入项名称     | 写入项在过程连接设备中的项名称。若数据服务器不需要单独的读写项或访问路径，此框禁用。 |  


#### 阶段标签Phase tags  
与 OPC 或 FactoryTalk Linx FactoryTalk Live Data 阶段关联的标签数量取决于创建该阶段的阶段类配置。每个阶段至少有十个标准标签。定义用于创建 OPC 或 FactoryTalk Linx FactoryTalk Live Data 阶段的阶段类时，需定义参数和报告通信所需的附加标签，以及 PCD 向 FactoryTalk Batch 服务器发送请求的附加请求标签。  
请求标签是与每个阶段关联的十个标准标签之一，用于 PCD 向服务器请求服务。有时，PCD 需要向服务器传递比单个标准请求标签更多的信息，此时需在阶段类上指定阶段所需的附加请求标签数量。  
若将阶段类配置为需要任何附加标签，需在 OPC 或 FactoryTalk Linx FactoryTalk Live Data 阶段中创建相应标签。  
提示：对于分配给 Logix5000 CIP 数据服务器的 PhaseManager 阶段，无需配置附加请求标签。当区域模型与 Logix Designer 项目同步时，将自动为 Logix5000 CIP 阶段创建所有必需标签。FactoryTalk Batch 设备编辑器创建的参数标签数量与阶段类上的参数数量相同，报告标签数量与阶段类上的报告数量相同。  


##### 从菜单编辑标签  
“编辑标签”对话框列出为所选区域模型配置的所有标签类及其关联标签。  
从菜单编辑标签的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“标签”。  
3. 在“标签类”下，选择适当的标签类。  
4. 在“标签”下，选择要编辑的标签。  
5. 选择“编辑标签”，将显示“编辑 [标签类型] 标签”对话框，其中 [标签类型] 表示正在编辑的标签类型（阶段或单元）。  
提示：基于指令的标签为仅查看。  
6. 按需修改，然后选择“确定”。  


##### 默认设备名称  
在区域模型中从阶段类创建阶段时，阶段的默认名称为 <phasename>1。例如，若阶段为 AGITATE，从此阶段类创建的阶段默认名称为 AGITATE1。  
阶段的标签项默认名称为：<设备模块名称><标签分隔符><标签扩展名>  
例如，若标签分隔符为句点 (.)，阶段 AGITATE1 的请求标签 (RQ) 为：AGITATE1.RQ  
若阶段名称更改，标签项名称不会自动更新以反映新名称。例如，若阶段名称从 AGITATE1 更改为 AGITATE_U2，标签“名称”将反映新名称 (AGITATE_U2)，但标签“项名称”仍反映阶段的原始名称 (AGITATE1)，此时 AGITATE_U2 阶段的请求标签仍为 AGITATE1.RQ。  
在区域模型中从阶段类创建阶段时，标签访问路径为分配的数据服务器指定的“默认项访问路径”。可在“编辑阶段标签”对话框中更改单个标签的访问路径。  


##### 将所有标签项设置为默认名称和访问路径  
使用以下说明全局更改区域模型中的所有标签项名称以反映其对应阶段的名称，并将每个阶段标签的访问路径重置为其数据服务器指定的“默认项访问路径”。  
提示：若仅更改单个阶段的标签名称，可在阶段的“标签”选项卡上进行更改。  
将所有标签项设置为默认名称和访问路径的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“设置默认标签项”。  
**重要**：此操作不可撤销！选择后，所有标签项名称和访问路径将自动更改。  
3. 选择“确定”继续。  
将显示消息，指示所有标签项已设置为标签名称且访问路径已重置。  
4. 选择“确定”返回设计视图区域。  
提示：分隔阶段标签项名称与其扩展名的默认字符（标签分隔符）可能因 batcheqp.ini 文件中定义的标签分隔符而异，可用字符为下划线 ( _ )、斜杠 ( / ) 或句点 ( . )。若已更改，默认字符不会被覆盖。  


#### 全局单元属性Global unit attribute  
FactoryTalk Batch 将单元类中的单元关联，以表示该类中所有单元的公共功能。这允许构建基于类的配方（针对单元类创建）。公共功能的聚合使配方能够针对单元类的任何实例运行（流路要求和 FactoryTalk Batch 物料管理器功能除外）。  
然而，单元类所有实例的公共功能集可能非常有限，无法创建有用的基于类的配方结构。某些反应器可能存在显著的共性，但并非全部。例如，部分反应器子集可能包含搅拌器，其他子集可能包含温度传感器。  
此外，单元的某些属性（如结构材料或温度）可能使其适用于或不适用于特定配方，但批次产品无法规范或强制执行这些要求。  
在这种情况下，构建利用共性子集的基于类的配方非常有用。全局单元属性提供了此能力：全局单元属性是配置为自动应用于区域模型中所有已定义单元类的单元属性，可避免区域模型设计者手动为每个单元类分配自定义单元属性。  


##### 创建全局单元属性  
使用以下说明创建全局单元属性。  
创建全局单元属性的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“单元属性Unit Attributes”。选择属性时，将填充关联的属性标签，默认选择第一个属性标签。  
3. 在“属性”下，选择“添加”以打开“创建单元属性”对话框。  
4. 在“名称”中，输入新单元属性的名称。  
5. 从“类型”中选择适当的标签类型：  
◦ 若标签类型为“枚举”，从“枚举”列表中选择适当的枚举名称。  
6. 在“工程单位”中，输入标签使用的工程单位。  
7. 在“描述”中，输入标签类的描述。  
8. 若要作为应用于所有新单元的全局单元属性，选中“全局属性”。  
提示：若选中“全局属性”，区域模型中的所有现有和新创建的单元类都将与此单元属性关联。此外，区域模型中的所有现有和后续创建的单元实例都将包含一个单元属性标签实例。  
9. 选择“确定”返回“编辑单元属性”对话框。  
新属性将列在“属性”下。若为全局单元属性，它将与所有现有单元类关联。属性和属性标签为大写并按字母顺序排列。  


##### 编辑全局单元属性  
使用以下说明编辑全局单元属性。  
编辑全局单元属性的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“单元属性”。  
3. 在“属性”下，选择属性并选择“编辑”。  
4. 进行所需修改，然后选择“确定”返回“编辑单元属性”对话框。  


##### 删除全局单元属性  
使用以下说明删除全局单元属性。  
删除全局单元属性的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“单元属性”。  
3. 在“属性”下，选择单元属性并选择“删除”。  
将显示警告，验证是否删除该单元属性的所有单元属性标签。  
4. 若要删除所有属性标签和所选单元属性，选择“是”。  
5. 若要取消删除，选择“否”。  


##### 移除全局单元属性  
使用以下说明移除全局单元属性。  
移除全局单元属性的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑”>“单元属性”。  
3. 在“属性”下，选择要编辑的单元属性并选择“编辑”。  
4. 清除“全局属性”复选框，然后选择“确定”。  
5. 若要移除单元属性，选择“是”。  
6. 若要取消移除，选择“否”。


## 阶段类Phase class概述  
阶段类是可重用的面向过程功能，通常表示执行次要处理活动或单元子功能的设备组，但不描述该活动的具体实现细节。阶段类的示例包括加热（Heat）、搅拌（Agitate）、添加（Add）和转移（Transfer）。  

阶段类可关联参数和报告，每个阶段类包含特定阶段类类型所有阶段的公共属性。阶段类用于在FactoryTalk Batch配方编辑器中创建配方，阶段类的实例即为阶段。每个阶段继承其创建所基于的阶段类属性。  

阶段类和阶段将过程连接设备（PCD）中的工程逻辑与配方链接：阶段类描述配方阶段，而阶段映射到工程逻辑中的设备操作或设备阶段。  
**提示**：对于分配给Logix5000 CIP数据服务器的PhaseManager阶段，无需定义参数、报告和请求标签的数量。当区域模型与Logix Designer同步时，将自动配置所需标签。  

每个OPC或FactoryTalk Linx FactoryTalk Live Data阶段会自动分配十个标准标签，用于与PCD中的工程逻辑通信。定义用于创建OPC或FactoryTalk Linx FactoryTalk Live Data阶段的阶段类时，需指定参数和报告通信所需的标签数量，以及PCD向FactoryTalk Batch服务器发送请求的附加标签。  


#### 标签Tags  
与每个OPC或FactoryTalk Linx FactoryTalk Live Data阶段关联的十个标准标签中，包含一个请求标签（Request tag）。PCD使用请求标签向FactoryTalk Batch服务器请求服务。对于OPC和FactoryTalk Linx FactoryTalk Live Data阶段，PCD有时需要向服务器传递超出单个标准请求标签容量的信息，此时需在阶段类上指定阶段所需的附加请求标签数量。  
**提示**：对于分配给Logix5000 CIP数据服务器的PhaseManager阶段，无需配置请求标签。当区域模型与Logix Designer同步时，将自动为Logix5000 CIP阶段创建标签。FactoryTalk Batch设备编辑器创建的参数标签数量与阶段类的参数数量一致，报告标签数量与阶段类的报告数量一致。  


#### 创建和配置阶段类  
使用“创建阶段类”对话框创建和配置阶段类。  
创建和配置阶段类的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择单元图标，然后选择“向下”( )。设计视图区域可能显示单元图标，“类视图”区域的列标题显示为“类”。  
3. 选择“添加新对象”( )，然后选择“新建阶段类”。  
4. 在“创建阶段类”对话框中，使用以下选项卡配置阶段类：  
◦ 常规  
◦ 参数  
◦ 报告Reports  
◦ 消息  
◦ 控制策略（仅当“常规”选项卡上的“控制策略”框已启用时可用）  
5. 选择“确定”。新阶段类将显示在阶段类列表中。  
**提示**：若要编辑阶段类，右键单击阶段类以打开“编辑阶段类”对话框。  


#### 配置阶段类常规属性  
使用“创建阶段类”对话框的“常规”选项卡配置阶段类常规属性。  
**提示**：使用易于理解的名称，这些名称将在批次执行期间显示给操作员。  
配置阶段类常规属性的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 打开“创建阶段类”对话框，选择“常规”选项卡。  
3. 在“图标”下，选择适当的图标（若图标区域为空，请参见第108页的“验证图标路径”）。  
4. 在“名称”中，输入适当的阶段类名称。  
5. 在“类型”中，输入阶段类类型。  
6. 在“默认控制器程序名称”中，输入在控制器中表示阶段类的名称。  
7. 在“附加功能”下，执行以下操作：  
◦ 选择“控制策略”以指示阶段类是否使用控制策略。  
◦ （可选）若已安装FactoryTalk Batch物料管理器，选择“基于物料的配方”以指示阶段类是否启用物料功能。  
◦ 在“参数/标签锁定”下，启用或禁用参数和标签的锁定：  
▪ 若要编辑从此阶段类创建的阶段关联的参数和报告标签数量，禁用“参数/标签锁定”。此选项仅适用于从此阶段类创建的OPC和FactoryTalk Linx FactoryTalk Live Data阶段。对于Logix5000 CIP阶段，无论所选设置如何，“参数/标签锁定”始终启用。  
▪ 若启用“参数/标签锁定”，“参数”和“报告”框将禁用，并显示当前由“参数/标签锁定”强制的数量。  
▪ 在“标签数量”下，编辑“参数”和“报告”中的标签数量，并在“请求”中输入适当的标签数量。  
◦ 在“消息伙伴”下，在“数量”中输入适当的数量。  
**提示**：若阶段类属于用于通信或同步的阶段链接组，需先在区域模型的阶段类上配置正确的消息伙伴数量。  
8. 选择“应用”保存更改，或选择“确定”保存更改并返回“类视图”区域。  
所选图标将显示在“类视图”区域中。  


#### “创建阶段类”对话框 - 常规选项卡  
阶段类常规属性包括阶段类名称、阶段类类型、阶段类消息伙伴数量以及与每个阶段关联的标签数量。选择图标以图形方式表示区域模型中基于该阶段类的所有阶段。启用或禁用阶段类对控制策略和基于物料配方的使用。  
“常规”选项卡包含以下内容：  

| 名称           | 用途                                                                 |  
|----------------|----------------------------------------------------------------------|  
| 图标区域       | 显示所有可用图标，使用滚动条或垂直滚动条中的上下箭头浏览图标。         |  
| 名称           | 阶段类的名称。                                                       |  
| 类型           | 可选框，用于对阶段类进行分类以生成报告。                               |  
| 默认控制器程序名称 | 创建类实例时使用的控制器程序名称。若留空，使用阶段类的名称。           |  
| 控制策略       | 启用为阶段类使用单独的控制策略。                                       |  
| 基于物料的配方   | （与FactoryTalk Batch物料管理器配合使用）启用物料引用与实际设备的绑定，使阶段类成为启用物料的阶段类。 |  
| 参数/标签锁定   | 若要使阶段类的参数和报告数量始终等于关联阶段类的参数标签和报告标签数量，启用阶段类的“参数/标签锁定”。<br>若禁用“参数/标签锁定”，在阶段类上指定关联的OPC或FactoryTalk Linx FactoryTalk Live Data阶段的参数和报告标签数量，该数量可能与OPC和FactoryTalk Linx FactoryTalk Live Data阶段定义的阶段类参数和报告数量不同。 |  
| 参数标签数量     | 阶段内可供FactoryTalk Batch写入参数信息的内存寄存器数量，通常等于为阶段类定义的参数数量。 |  
| 报告标签数量     | 阶段内可供FactoryTalk Batch读取报告标签信息的内存寄存器数量，通常等于为阶段类定义的报告数量。 |  
| 请求标签数量     | 阶段内可供阶段逻辑写入请求信息的内存寄存器数量。                       |  
| 消息伙伴数量     | 消息伙伴是两个或多个阶段，在各自阶段逻辑执行期间需要相互通信以实现同步和定时。在FactoryTalk Batch配方编辑器中，消息伙伴组织成链接组，用于通知FactoryTalk Batch服务器哪些阶段需要消息传递。<br>若阶段属于用于通信或同步的阶段链接组，此为阶段正常运行必须链接的附加阶段数量。 |  


#### 配置阶段类参数  
使用“创建阶段类”对话框的“参数”选项卡配置阶段类参数。  
**提示**：使用键盘在网格中移动：按Tab键将焦点移至网格，按Ctrl+Alt+Home高亮显示网格中的第一个可编辑单元格。  
配置阶段类参数的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 打开“创建阶段类”对话框，选择“参数”选项卡，将显示与阶段类关联的参数列表。  
**提示**：若为阶段类启用了控制策略，“参数”选项卡顶部将显示“控制策略”列表，仅列出与“控制策略”列表中所选控制策略关联的阶段类参数。若选择“<所有>”，则阶段类参数的“高”“低”“默认”或“枚举/工程单位”框不可编辑。为每个创建的控制策略添加物料参数（包括可选物料参数，若已启用），并编辑每个已配置控制策略的MATERIAL、MATERIAL_CLASS和AMOUNT物料参数值。  
3. 选择“添加参数”添加新的阶段类参数，将显示带有默认值的新参数。  
4. 在“名称”下，输入参数的唯一名称。  
5. 在“类型”下，选择适当的参数类型：  
◦ 若类型为“实数”或“整数”，添加“高”值、“低”值和“默认”值，然后在“枚举/工程单位”框中输入工程单位。  
◦ 若类型为“枚举”，从“枚举/工程单位”列表中选择适当的枚举集，并从“默认”列表中选择适当的默认枚举。  
◦ 若类型为“字符串”，在“枚举/工程单位”框中输入工程单位，并在“默认”框中输入默认字符串。  
6. 若参数在批次缩放时必须在配方内缩放，选中“缩放”复选框（有关详细信息，请参见“缩放参数”）。  
**提示**：若“常规”选项卡的“参数标签数量”中指定的参数标签数量不足，“启动时下载”和“控制转移时下载”复选框不可用。指定与实际参数数量相同的参数标签数量，以使每个参数可用这些复选框。  
7. 若要将参数添加到启动下载子集，选中“启动时下载”复选框。  
8. 若要将参数添加到控制转移下载子集，选中“控制转移时下载”复选框。  
**提示**：启用物料的阶段类不支持控制转移。  
9. 若要为配方的阶段类参数分配上下文或描述符，从“报告上下文”列中选择一个或多个上下文ID。  
10. 若参数值偏离可接受范围时需要电子签名或在FactoryTalk Batch事件日志中生成偏差事件，请参见“配置参数和报告的验证策略”获取说明。  
11. 若要删除参数，选择参数行标题并选择“删除参数”，选择“是”确认删除。  
12. 选择“应用”保存更改，或选择“确定”保存更改并返回“类视图”区域。  


#### “创建阶段类”对话框 - 参数选项卡  
阶段类参数值在配方阶段执行期间从FactoryTalk Batch服务器传递到阶段逻辑。对于使用Logix5000 CIP数据服务器的PhaseManager阶段，阶段定义包含其参数。对于其他数据服务器，为阶段类定义阶段参数，并在过程连接设备中配置相应的参数标签和标签地址。  

可对实数或整数阶段参数配置参数值的验证方法。验证方法定义验证参数最多三组高低限值的策略，并定义参数值超出配置限值时采取的操作。  

若启用“基于物料的配方”，可定义两个参数（MATERIAL和AMOUNT）。为启用物料的阶段添加以下可选参数：CONTAINER、LOT、LABEL和MATERIAL_CLASS。  
**提示**：上下文ID仅分配给阶段类上配置的配方参数和报告参数，因此仅阶段类参数可具有上下文ID，且不可在配方内更改。  
“参数”选项卡包含以下内容：  

| 名称           | 用途                                                                 |  
|----------------|----------------------------------------------------------------------|  
| 控制策略       | 已配置控制策略的列表，用于筛选显示的参数。可从列表中选择单独的控制策略或同时查看所有控制策略，仅当启用“控制策略”时可见。 |  
| 添加可选物料参数 | 启用可选的基于物料配方的参数（CONTAINER、MATERIAL_CLASS、LOT和LABEL），仅当启用“基于物料的配方”时可见，且仅当在“控制策略”列表中选择“<所有>”时启用此复选框。 |  
| 名称           | 阶段类参数的名称，物料参数（MATERIAL、AMOUNT、CONTAINER、LOT或LABEL）的名称不可编辑。 |  
| ID             | 阶段类参数的标识号。若定义参数后启用“控制策略”，ID将增加1，因为控制策略本身的参数ID始终为1。<br>对于启用物料的阶段，参数ID填充为大于零的第一个可用整数，MATERIAL参数是第一个分配ID的基于物料配方的参数（仅查看）。 |  
| 类型           | 阶段参数数据类型：实数、整数、字符串和枚举。<br>启用物料的阶段参数的数据类型不可修改：<br>• MATERIAL、MATERIAL_CLASS和CONTAINER = 枚举<br>• AMOUNT = 实数<br>• LOT和LABEL = 字符串 |  
| 最大值         | 阶段参数的最大限值，默认值为100。                                     |  
| 最小值         | 阶段参数的最小限值，默认值为零 (0)：<br>• 添加：低 = 0，高 = 正数<br>• 分配：低 = 负数，高 = 0<br>• 两者：低 = 负数，高 = 正数<br>**提示**：对于启用物料的阶段参数AMOUNT，最小值和最大值指定阶段是物料添加、分配或两者。 |  
| 默认值         | 阶段参数的默认值，默认值为零 (0)，值必须设置在最小值和最大值之间。<br>若选择“高/低”“高-高/低-低”或“高-高-高/低-低-低”验证方法，默认值必须在高值和低值范围内。<br>对于启用物料的阶段，默认值如下：<br>• MATERIAL默认为NULL_MATERIAL<br>• MATERIAL_CLASS默认为NULL_CLASS<br>• CONTAINER默认为NULL_CONTAINER<br>CONTAINER、LOT或LABEL参数的默认值不可修改。 |  
| 枚举/工程单位   | 阶段参数的工程单位。若参数类型为“枚举”，枚举/工程单位值为枚举集的名称。<br>**提示**：启用物料的阶段参数MATERIAL、CONTAINER、LOT、LABEL或MATERIAL_CLASS的枚举/工程单位不可修改。 |  
| 缩放           | 指示阶段参数在批次创建时是否可随配方缩放。                             |  
| 启动时下载     | 若选中，FactoryTalk Batch服务器可在以下情况下载参数：<br>• 阶段逻辑请求下载时。<br>• 阶段配置为在START命令时自动下载时（有关详细信息，请参见“阶段概述”）。 |  
| 控制转移时下载   | 若选中，当阶段发生控制转移且阶段逻辑请求下载时，FactoryTalk Batch服务器将下载参数。<br>启用物料的阶段类不支持控制转移。 |  
| 报告上下文     | 报告上下文允许定义参数与一组上下文ID之间的关联。每当记录参数事件时，FactoryTalk Batch服务器会在批次事件日志记录的“上下文ID”框中记录定义的上下文ID。新参数的默认值为空字符串。选择浏览( )打开“报告上下文”对话框，为特定参数选择一个或多个上下文字符串。上下文ID是REPORTING_CONTEXTS枚举集的成员。 |  
| 验证方法       | 验证策略的一部分，定义参数或报告的可接受限值集，阶段参数类型必须为实数或整数：<br>• 无限值：配置当参数或报告值在最小和最大限值内时执行的验证策略，也可选择此选项不使用验证策略。<br>• 高/低：允许配置最多两个验证策略，除“无限值”策略外，指定高值和低值限值，以及参数或报告值超出高值限值或低于低值限值时使用的单独验证策略。<br>• 高-高/低-低：允许配置最多三个验证策略，除“无限值”策略和“高/低”策略外，指定第二个高限值、第二个低限值，以及参数或报告值超出此第二个高限值或低于此第二个低限值时使用的单独验证策略。<br>• 高-高-高/低-低-低：允许配置最多四个验证策略，除“无限值”策略、“高/低”策略和“高-高/低-低”策略外，指定第三个高限值、第三个低限值，以及参数或报告值超出此第三个高限值或低于此第三个低限值时使用的单独验证策略。 |  
| 添加参数       | 向列表中添加新参数。                                                 |  
| 删除参数       | 从列表中移除所选参数。                                               |  


#### 配置阶段类报告Reports  
使用“创建阶段类”对话框的“报告”选项卡配置阶段类报告。为阶段类定义阶段类报告，为阶段定义相应的报告标签（包括过程连接设备中的地址或标签）。  
配置阶段类报告的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 打开“创建阶段类”对话框，选择“报告”选项卡，将显示与阶段类关联的阶段类报告列表。  
**提示**：使用键盘在网格中移动：按Tab键将焦点移至网格，按Ctrl+Alt+Home高亮显示网格中的第一个可编辑单元格。  
3. 选择“添加报告”添加新的阶段类报告，将显示带有默认值的新报告：  
◦ 在“名称”下，输入报告参数的唯一名称。  
◦ 在“类型”下，选择适当的参数类型：  
▪ 若类型为“实数”“字符串”或“整数”，在“枚举/工程单位”中输入工程单位。若启用了控制策略，为每个已配置的控制策略编辑“枚举/工程单位”值。  
▪ 若类型为“枚举”，在“枚举/工程单位”中选择适当的枚举集。  
**提示**：若“常规”选项卡的“报告标签数量”中指定的报告标签数量不足，“终端状态时上传”和“控制转移时上传”复选框不可用。指定与实际报告数量相同的报告标签数量，以使每个报告可用这些复选框。  
◦ 在“累积”下，选择FactoryTalk Batch服务器处理上传报告值的方式，有效取值包括：  
▪ 无  
▪ 阶段  
▪ 批次  
◦ 若要将报告添加到终端状态上传子集，选中“终端状态时上传”。  
◦ 若要将报告添加到控制转移上传子集，选中“控制转移时上传”。  
**提示**：启用物料的阶段类不支持控制转移。  
◦ 若要为报告参数分配上下文或描述符，从“报告上下文”列中选择一个或多个上下文ID。  
◦ 若参数值偏离可接受范围时需要电子签名或在FactoryTalk Batch事件日志中生成偏差事件，请参见“配置参数和报告的验证策略”获取说明。  
◦ （可选）在“ERP别名”中，输入SAP R/3报告名称。  
4. 若要删除报告，选择报告行标题并选择“删除报告”，选择“是”确认删除。  
5. 选择“应用”保存更改，或选择“确定”保存更改并返回“类视图”区域。  


#### “创建阶段类”对话框 - 报告选项卡  
阶段类报告值从过程连接设备（PCD）传递到FactoryTalk Batch服务器，报告值包含指示阶段功能的数据，这些数据包含在运行批次的事件日志文件（.evt）中，并可包含在批次报告中。对于使用Logix5000 CIP数据服务器的PhaseManager阶段，阶段定义包含其报告。对于其他数据服务器，为阶段类定义阶段报告，并在PCD中配置相应的参数标签和标签地址。  

可对实数或整数阶段类报告配置报告值的验证方法。验证方法定义验证报告最多三组高低限值的策略，并定义报告值超出配置限值时采取的操作。  

若启用“基于物料的配方”，将自动创建两个阶段类报告（ACTUAL_AMOUNT和FEED_COMPLETE）。  
**提示**：若为阶段类配置了控制策略，“报告”选项卡顶部将显示“控制策略”列表，仅显示与“控制策略”列表中所选控制策略关联的报告。若选择“<所有>”且类型为“实数”“字符串”或“整数”，“枚举/工程单位”框不可编辑，必须为每个控制策略设置。  
为每个创建的控制策略添加启用物料的阶段报告，为每个已配置的控制策略编辑“枚举/工程单位”值。  
“报告”选项卡包含以下内容：  

| 名称           | 用途                                                                 |  
|----------------|----------------------------------------------------------------------|  
| 控制策略       | 已配置控制策略的列表，用于筛选显示的阶段类报告。可从列表中选择单独的控制策略或查看所有控制策略，仅当“常规”选项卡已启用“控制策略”时可用。 |  
| 名称           | 阶段类报告的名称。<br>**提示**：物料阶段类报告ACTUAL_AMOUNT和FEED_COMPLETE的名称不可编辑。 |  
| ID             | 阶段类报告的标识号。<br>对于启用物料的阶段类，参数ID填充为大于零的第一个可用整数，ACTUAL_AMOUNT报告是第一个分配ID的基于物料配方的报告（仅查看）。 |  
| 类型           | 报告数据类型：实数、整数、字符串和枚举。<br>**提示**：启用物料的阶段报告ACTUAL_AMOUNT = 实数和FEED_COMPLETE = 枚举的数据类型不可修改。 |  
| 枚举/工程单位   | 若选择“枚举”类型，显示枚举集的名称；否则显示报告参数的工程单位。<br>**提示**：启用物料的阶段类报告FEED_COMPLETE的枚举/工程单位不可修改。 |  
| 累积           | 定义阶段类报告参数将上传值添加到当前值而不仅仅是存储值：<br>• 无：报告参数充当阶段的常规输出参数。当阶段逻辑使用自动上传或通过PXRQ/请求（2000系列）向FactoryTalk Batch服务器上传值时，值存储在报告中并记录在事件日志中。若阶段逻辑在阶段的单次运行中多次上传，每次值记录在事件日志中，报告参数显示最后上传的值。<br>• 阶段：在整个阶段执行期间，每次阶段逻辑向报告上传值时，报告值累积报告中的值。事件日志将每次上传值记录为报告增量，并记录报告值的总计值，上传类型无关紧要。<br>• 批次：在整个批次期间，每次阶段逻辑向报告上传值时，报告值累积报告中的值。事件日志将每次上传值记录为报告增量，并记录报告值的总计值。若阶段步骤在同批次中再次执行（如循环），值继续累加，上传类型无关紧要。<br>更改“累积”设置也会更改“终端状态时上传”设置：<br>• 若“累积”值设置为“无”（默认），“终端状态时上传”值为启用并可用。<br>• 若“累积”值设置为“阶段”，“终端状态时上传”值为禁用并不可用。<br>• 若“累积”值设置为“批次”，“终端状态时上传”值为禁用并不可用。 |  
| 终端状态时上传   | 若选中，FactoryTalk Batch服务器在以下情况上传报告：<br>• 阶段逻辑请求上传时。<br>• 阶段配置为当步骤更改为COMPLETE、STOPPED或ABORTED时自动上传时（有关详细信息，请参见“创建阶段”）。 |  
| 控制转移时上传   | 若选中，当阶段发生控制转移且发出适当的阶段逻辑请求时，报告上传。<br>启用物料的阶段类不支持控制转移。 |  
| 报告上下文     | 定义阶段报告与一组上下文ID之间的关联。每当记录报告事件时，FactoryTalk Batch服务器会在批次事件日志记录的“上下文ID”框中记录定义的上下文ID。选择浏览( )打开“报告上下文”对话框，为报告选择一个或多个上下文字符串。 |  
| ERP别名        | 报告的SAP名称，ERP别名将报告从FactoryTalk Batch服务器映射到SAP。 |  
| 验证方法       | 验证策略的一部分，定义参数或报告的可接受限值集，阶段类参数或报告类型必须为实数或整数：<br>• 无限值：配置当参数或报告值在验证限值内时执行的验证策略，也可选择此选项不使用验证策略。<br>• 高/低：配置最多两个验证策略，除“无限值”策略外，指定高值和低值限值，以及参数或报告值超出高值限值或低于低值限值时使用的单独验证策略。<br>• 高-高/低-低：配置最多三个验证策略，除“无限值”策略和“高/低”策略外，指定第二个高限值、第二个低限值，以及参数或报告值超出此第二个高限值或低于此第二个低限值时使用的单独验证策略。<br>• 高-高-高/低-低-低：配置最多四个验证策略，除“无限值”策略、“高/低”策略和“高-高/低-低”策略外，指定第三个高限值、第三个低限值，以及参数或报告值超出此第三个高限值或低于此第三个低限值时使用的单独验证策略。 |  
| 添加报告       | 向阶段类添加新报告。                                                 |  
| 删除报告       | 从阶段类中移除所选报告。                                             |  


#### 选择上下文ID context IDs  
上下文ID（或描述符）可与每个阶段类报告或参数关联，以便更轻松地查询和排序事件日志中记录的事件，此关联使报告生成和分析更简单。  
若要为阶段类参数或报告分配上下文ID，在“创建阶段类”对话框中选择一个或多个上下文ID。  
**重要**：上下文ID仅分配给阶段类上配置的配方参数和报告参数，因此仅阶段类参数可具有上下文ID，且不可在配方内更改。  
选择上下文ID的步骤：  
1. 打开“创建阶段类”对话框，选择“参数”或“报告”选项卡，将显示与阶段类关联的阶段类参数或报告列表。  
2. 在“报告上下文”下，选择浏览( )。  
3. 单击选择一个或多个上下文ID，然后选择“确定”，所选报告上下文将添加到报告。  


#### 配置阶段类消息  
使用以下说明从“创建阶段类”对话框的“消息”选项卡中添加新消息、编辑现有消息和删除阶段类消息。  
配置阶段类消息的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 打开“创建阶段类”对话框，选择“消息”选项卡，将显示与阶段类关联的消息列表。  
3. 选择“添加消息”添加新的阶段类消息，将添加新的默认消息。  
4. 在“名称”框中，输入适当的消息。  
5. 在“ID”框中，输入消息ID。  
6. 若要删除消息，选择消息行标题，然后选择“删除消息”，选择“是”确认删除。  
7. 选择“应用”保存更改，或选择“确定”保存更改并返回“类视图”区域。  


#### “创建阶段类”对话框 - 消息选项卡  
阶段类消息通常用于日志记录和阶段逻辑问题排查，在某些情况下会显示给操作员。阶段类消息关联两项数据：名称和消息ID。阶段类消息请求必须从阶段逻辑内生成（30NN或130NN请求），且区域模型中必须为每个阶段类消息请求创建相应的阶段类消息。  
“消息”选项卡包含以下内容：  

| 名称       | 用途                                                                 |  
|------------|----------------------------------------------------------------------|  
| 名称       | 消息的名称，此文本也用作实际阶段类消息。                               |  
| ID         | 报告消息的标识号。                                                   |  
| 添加消息   | 向阶段类添加新的阶段类消息。                                         |  
| 删除消息   | 从阶段类中移除所选阶段类消息。                                       |  


#### 配置阶段类控制策略  
使用以下说明编辑默认控制策略、创建新控制策略和删除控制策略。若要移除所有控制策略，禁用“创建阶段类”对话框“常规”选项卡上的“控制策略”选项。  
**提示**：  
• 除非“创建阶段类”对话框“常规”选项卡中选中“控制策略”复选框，否则“控制策略”选项卡不可见。  
• 禁用阶段类的控制策略会显示警告消息，指示禁用控制策略时丢失的参数信息，需要确认才能完成该过程。  
配置阶段类控制策略的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 打开“创建阶段类”对话框，选择“控制策略”选项卡，将显示与阶段类关联的控制策略列表。  
3. 选择“添加控制策略”添加新的控制策略。  
4. 在“创建枚举”对话框的“枚举”框中，输入新控制策略的名称。  
5. 在“序号”框中，输入控制策略的序号标识值，或接受默认值并选择“确定”，将添加新的控制策略。  
6. 对于“参数”表中的每个参数，在新控制策略的列中选中或清除参数的复选框。  
**重要**：若从与报告相同的控制策略中移除目标参数，报告的验证方法将自动重置为“无限值”。  
7. 对于“报告”表中的每个报告，在新控制策略的列中选中或清除相应的复选框。  
8. 从“设置默认控制策略”列表中，选择适当的控制策略，将该控制策略配置为阶段类的默认策略。  
9. 若要编辑或删除控制策略，选择控制策略列，然后选择“编辑控制策略”或“删除控制策略”。  
10. 选择“应用”保存更改，或选择“确定”保存更改并返回“类视图”区域。  


#### “创建阶段类”对话框 - 控制策略选项卡  
控制策略标识阶段类上配置的阶段类和报告参数的子集，用于运行时。控制策略值分配给阶段类，仅该控制策略的参数和报告可用。阶段类可配置为具有一个或多个控制策略。  

使用已定义阶段类参数和报告的子集单独配置每个控制策略，为每个控制策略独立定义每个参数的值、范围和工程单位，以及每个报告的工程单位。使用FactoryTalk Batch配方编辑器创建主配方时，为配方内阶段类的每个实例指定要使用的控制策略。  

若启用“基于物料的配方”和“添加可选物料参数”，启用物料的阶段类的物料参数和报告将添加到每个创建的控制策略，且不可删除。  

启用控制策略功能时，将创建默认控制策略。  
“控制策略”选项卡包含以下内容：  

| 名称               | 用途                                                                 |  
|--------------------|----------------------------------------------------------------------|  
| 设置默认控制策略   | 阶段类的已配置控制策略列表，所选控制策略是基于阶段类的任何配方的默认控制策略。 |  
| 参数               | 用于将参数分配给控制策略的表。表的每一行表示一个关联参数，每一列表示不同的控制策略（由列标题标识）。通过选中或清除适当控制策略列中参数的复选框，可将参数分配给或取消分配给控制策略，单个参数可分配给多个控制策略。 |  
| 报告               | 用于将报告分配给控制策略的表。表的每一行表示一个关联报告，每一列表示不同的控制策略（由列标题标识）。通过选中或清除适当控制策略列中报告的复选框，可将报告分配给或从控制策略中移除，单个报告可分配给多个控制策略。 |  
| 添加控制策略       | 向阶段类添加新的控制策略。                                             |  
| 编辑控制策略       | 编辑所选控制策略，选择列标题以选择控制策略。                             |  
| 删除控制策略       | 从阶段类中移除所选控制策略。                                           |  


#### 验证策略  
为每个指定为实数或整数类型的参数和报告配置单独的验证策略。  
**提示**：无法为字符串或枚举参数或报告配置验证策略。“验证策略”对话框仍会为字符串和枚举显示，但所有框均为仅查看。  
验证方法包含四个验证级别：  
• 无限值：当参数或报告值在偏差限值内时执行所选策略。  
• 高/低：此区域中选择的选项描述参数或报告值超出计算的高低偏差限值时采取的操作。  
• 高-高/低-低：此区域中选择的选项描述参数或报告值超出计算的高-高/低-低偏差限值时采取的操作。  
• 高-高-高/低-低-低：此区域中选择的选项描述参数或报告值超出定义的高-高-高/低-低-低限值时采取的操作。  


#### 验证策略的工作原理  
选择验证方法时，指定用于确定偏差限值的计算方法。对于每个验证级别，选择验证策略选项：  
**提示**：若要使用签名模板策略，需先配置签名模板。  
• 无：当参数或报告值超出计算的偏差限值时，向FactoryTalk Batch事件日志写入偏差事件，但不需要签名。  
• 签名模板：需要选择预配置的签名模板，该模板描述所需的签核数量以及允许输入电子签名的用户和组。  
• 不允许：若参数或报告值超出计算范围，将阻止批次继续处理。  

所选验证方法以及区域内选择的选项会影响后续更高验证级别区域中的可用选项。例如，若选择“无限值”验证方法，则无法配置“高/低”“高-高/低-低”或“高-高-高/低-低-低”验证方法的任何选项。  

验证选项不能在高于较低验证级别的区域中定义为低于较低验证级别的严格程度。例如，若选择“高-高/低-低”验证方法，且选择值在限值内时的策略为“签名模板”选项，则值超出高/低级别时的策略“无”选项将禁用。  
**提示**：对于配方参数，最高和最低限值必须在“编辑阶段”对话框“参数”选项卡中为参数指定的最小值和最大值范围内，这不适用于报告。  
“参数”选项卡上指定的默认参数值必须在高低限值范围内。  
高低限值集必须符合以下关系：  
最大值 >= 高-高-高 > 高-高 > 高 = 默认值 = 低 > 低-低 > 低-低-低 >= 最小值  


#### 配置参数和报告的验证策略  
使用“编辑阶段类”对话框配置参数和报告的验证策略。  
开始前：  
• 验证电子签名模板的设置。  
**提示**：阶段类参数或报告类型必须为实数或整数，无法为字符串或枚举参数或报告配置验证方法。  
配置参数和报告验证策略的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在“编辑阶段类”对话框中，选择“参数”或“报告”选项卡，分别为参数或报告配置验证策略。  
3. 在参数或报告行标题中，选择“验证方法”浏览以打开“验证策略”对话框。  
4. 从“验证方法”列表中，选择用于参数或报告的验证方法，所选方法确定对话框中哪些框变为启用：  
◦ 若选择“高/低”“高-高/低-低”或“高-高-高/低-低-低”验证方法，指定计算方法。从“计算”列表中，选择用于确定偏差限值的计算方法（参数仅可用“绝对”选择。若选择“无限值”验证方法，“计算”列表禁用，继续执行步骤5）。  
◦ 若选择“绝对”计算方法，可选择“缩放”复选框。“缩放”选项将绝对验证限值按FactoryTalk Batch View中“批次创建”对话框指定的批次缩放值的相同百分比缩放。  
◦ 若选择“百分比”或“相对”计算方法，从“百分比/相对目标参数”列表中选择参数，所选参数值用于确定报告验证限值的百分比或相对计算。列表仅显示分配给正在编辑的阶段类中与报告相同控制策略的实数或整数配方参数。  
**重要**：更改目标参数可能自动更改所有引用报告的验证策略。  
5. 在“值在限值内时的策略”区域中，选择策略选项之一：  
◦ 若选择“签名模板”，选择“签名模板”旁边的浏览( )。  
◦ 从“选择模板”列表中，选择定义此参数或报告验证限值签名策略的签名模板。  
◦ 选择“确定”，“选择签名”对话框关闭，所选签名模板显示在“签名模板”选项旁边的框中。  
6. 对每个启用的策略区域重复步骤4。除这些步骤外，对于每个启用的策略，在每组用于计算验证限值的“低”和“高”框中输入值。  
**重要**：若参数或报告类型从“实数”更改为“整数”，且验证策略的计算方法为“绝对”或“相对”，每组高低限值中的值将自动四舍五入到最接近的整数。  
7. 选择“确定”保存更改并返回“编辑阶段类”对话框。  
8. 若要将验证限值下载到阶段逻辑，启用或定义一组限值标签。设置验证策略后，配置每个阶段的自动（非基于指令）阶段类时，启用或定义这些限值标签。  


#### “验证策略”对话框  
“验证策略”对话框包含以下内容：  

| 名称           | 用途                                                                 |  
|----------------|----------------------------------------------------------------------|  
| 验证方法       | 允许选择验证方法的列表：<br>• 无限值：定义当参数或报告值在验证限值内时采取的操作，选择此选项可不使用验证策略。<br>• 高/低：定义两个验证策略，指定高值和低值限值，以及参数或报告值超出高值限值或低于低值限值时使用的单独验证策略。<br>• 高-高/低-低：配置最多三个验证策略，指定第二个高限值、第二个低限值，以及参数或报告值超出此第二个高限值或低于此第二个低限值时使用的单独验证策略。<br>• 高-高-高/低-低-低：配置最多四个验证策略，指定第三个高限值、第三个低限值，以及参数或报告值超出此第三个高限值或低于此第三个低限值时使用的单独验证策略。 |  
| 计算           | 验证限值计算，仅对报告启用。选择用于计算报告验证限值的方程类型，FactoryTalk Batch服务器在批次添加到批次列表或目标参数更改时计算限值。<br>示例配置设置：<br>目标参数 = 120<br>高限值 = 10<br>低限值 = -10<br>• 绝对：偏差限值为配方中定义的指定值，在FactoryTalk Batch配方编辑器“参数值输入/报告限值输入”对话框中，输入三组高低框中的绝对值显示为LLL、LL、L、H、HH、HHH框的默认值，这是配方参数的默认且唯一的限值计算类型。<br>运行时，服务器计算：<br>高限值 = 10<br>低限值 = -10<br>• 百分比：目标参数值乘以高低框中指定的百分比，仅对报告可用。<br>例如：<br>运行时，FactoryTalk Batch服务器计算：<br>高限值 = 120 + (.10)(120) = 132<br>低限值 = 120 + (-.10)(120) = 108<br>• 相对：目标参数值加上高低框中指定的值，仅对报告可用。<br>例如：<br>运行时，服务器计算：<br>高限值 = 120 + (10) = 130<br>低限值 = 120 + (-10) = 110 |  
| 缩放           | 仅当计算为“绝对”时启用，指示绝对验证限值是否按FactoryTalk Batch View“批次创建”对话框中指定的批次缩放值的相同百分比缩放。 |  
| 百分比/相对目标参数 | 当报告限值的计算为“百分比”和“相对”时启用，选择其值用于确定报告验证限值的百分比或相对计算的参数。<br>列表仅显示分配给正在编辑的阶段类中与报告相同控制策略的实数或整数配方参数。 |  
| 无             | 在FactoryTalk Batch事件日志中记录偏差事件，但不执行其他操作（默认）。 |  
| 签名模板       | 指示参数或报告值超出指定范围时需要签名验证。<br>若选择此选项，选择浏览( )打开“选择签名模板”对话框，选择包含在该验证级别具有输入签名验证安全权限的签核组的签名模板。 |  
| 不允许         | 指示参数或报告值超出定义限值时配方无法继续，事件日志中不记录事件。 |  
| 低/高<br>低-低/高-高<br>低-低-低/高-高-高 | 这些框用于计算默认参数偏差限值，这些值可在配方中更改，但如果配方参数中未提供值，则使用此处输入的值。<br>此框的定义因所选计算方法而异：<br>• 绝对计算：输入的实际值为高低偏差限值，偏差限值 = 绝对值。<br>• 百分比计算：这些值定义用于计算高低偏差限值的目标参数百分比，这些值是此方程中的百分比：偏差限值 = 目标参数 + (目标参数 * 百分比)，输入正负值。若要将低限值定义为低于目标参数值，在低框中输入负值。<br>• 相对计算：输入的实际值添加到目标参数值以确定偏差限值，这些值是此方程中的相对值：偏差限值 = 目标参数 + (目标参数 + 相对值)，输入正负值。若要将低限值定义为低于目标参数值，在低框中输入负值。<br>当参数或报告值超出计算的偏差限值时，执行所选策略。 |  


#### 验证策略如何与控制策略配合工作  
若实施控制策略，为每个控制策略中的每个参数和报告设置不同的验证策略。  

若为报告的验证策略选择“百分比”或“相对”作为计算方法，为每个控制策略选择不同的目标参数，目标参数必须分配给与报告相同的控制策略。启用控制策略时，目标参数列表仅显示分配给与报告相同控制策略的整数和实数参数。  
**重要**：若报告的目标参数从与报告相同的控制策略中移除，验证方法将自动重置为“无限值”。  


#### 编辑目标参数如何影响报告验证策略  
若对参数进行以下任何更改，所有将该参数作为目标参数引用的报告的验证方法将自动重置为“无限值”：  
• 参数名称更改。  
• 参数类型从整数或实数更改为字符串或枚举。  
• 从与报告相同的控制策略中移除参数。  
• 删除参数。  
**重要**：若报告验证策略使用“百分比”或“相对”计算方法设置，更改目标参数可能自动更改引用报告的验证策略。  


#### 启用物料的阶段类  
若将FactoryTalk Batch物料管理器与FactoryTalk Batch结合使用，两个参数（MATERIAL和AMOUNT）和两个报告（ACTUAL_AMOUNT和FEED_COMPLETE）将自动添加到每个启用物料的阶段类。  

为启用物料的阶段类添加可选参数：  
• CONTAINER  
• LOT  
• MATERIAL_CLASS  
• LABEL  
这些可选参数使数据在批次运行时可用于阶段类和客户端程序。  
**提示**：FactoryTalk Batch设备编辑器内的可选物料参数值不可编辑。  
配置阶段类为启用物料时，请注意以下问题，因为启用物料的阶段类与标准阶段类不同：  
• 如何处理现有参数和报告参数。  
• 如何处理阶段类上配置的标签数量。  

若标准阶段类没有为物料保留的匹配参数和报告名称，使此阶段类启用物料非常简单。一旦启用“基于物料的配方”复选框，将添加两个保留参数和两个保留报告参数，“添加可选物料参数”也是如此。  

若禁用“参数/标签锁定”，添加适当数量的标签。  


#### 具有匹配参数和报告名称的标准阶段类  
若标准阶段类使用任何保留的物料参数或物料报告名称，它们必须具有启用物料的阶段类的正确数据类型。此外，若存在MATERIAL参数，还必须选择正确的枚举集。  
**提示**：可选物料参数除外。四个参数（CONTAINER、LOT、MATERIAL_CLASS和LABEL）不能已经作为非系统参数存在。若系统找到与保留名称匹配的参数，在启用“添加可选物料参数”之前删除或重命名参数。  
若现有参数的数据类型不完全符合基于物料配方子系统的预期，启用阶段类支持物料可能导致问题。系统检查正确的数据类型，并显示消息以更正具有无效数据类型的参数。  

先前配置的参数和报告ID保持不变，未配置的其他基于物料配方的参数和报告将添加并使用大于零的第一个可用整数分配ID。  


#### 配置了控制策略的标准阶段类  
若标准阶段类配置了控制策略且启用了“基于物料的配方”，物料参数（包括可选参数，若已启用）和报告将添加到每个控制策略。若禁用“参数/标签锁定”，添加适当数量的标签。  


#### 在启用物料的阶段类上禁用物料  
在启用物料的阶段类上禁用“基于物料的配方”将自动删除两个保留参数（和可选参数，若已启用）和两个报告。若启用“参数/标签锁定”，移除适当数量的标签。  

若使用启用物料的阶段类创建了多个阶段，删除每个单元中的额外阶段，然后在阶段类上禁用“基于物料的配方”。  


#### 复制阶段类  
可使用FactoryTalk Batch设备编辑器工具栏在“类视图”区域内剪切、复制或粘贴阶段类。在区域模型内复制阶段类，包括所有阶段参数、报告和消息，使用此功能将阶段类从一个区域模型剪切或复制到另一个区域模型。  


#### 复制阶段类  
使用以下说明复制阶段类。  
复制阶段类的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 从“类视图”区域中，选择要复制的阶段类。  
3. 选择“编辑”>“复制阶段类”。  
4. 选择“编辑”>“粘贴阶段类”，将创建新的阶段类，默认名称为PHASE CLASS NAME#，其中#是整数（从1开始），每次粘贴阶段类时递增。  


#### 剪切和粘贴阶段类  
使用以下说明剪切和粘贴阶段类。  
**提示**：若要在区域模型之间剪切和粘贴，打开第一个区域模型，剪切或复制适当的阶段类，然后打开第二个区域模型并将阶段类粘贴到“类视图”区域。  
剪切和粘贴阶段类的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 从“类视图”区域中，选择要剪切的阶段类。  
3. 选择“编辑”>“剪切阶段类”，阶段类从“类视图”区域中移除并保存在内存中。  
4. 选择“类视图”区域内的任何阶段类，然后选择“编辑”>“粘贴阶段类”。



## 配置阶段phases  
阶段是特定阶段类的实例。每个单元只能添加一个特定阶段类的实例，除非该阶段类启用了物料功能。将阶段类实例添加到单元实例后，必须对阶段进行配置。  

阶段通过标签地址映射到工程逻辑中的阶段类。如果多个单元需要同一阶段类的单个实例，可在单元之间共享该实例。对于OPC或FactoryTalk Linx FactoryTalk Live Data阶段，每个标签至少必须配置为指示其在过程连接设备(PCD)中的地址位置。  
**提示**：对于分配给Logix5000 CIP数据服务器的PhaseManager阶段，无需配置标签数据。  

阶段标签表示配方执行期间与特定阶段关联的数据。与阶段关联的标签数量取决于阶段类配置。每个阶段至少关联十个预定义标签，可配置附加标签，附加标签分为三种类型：  
• 参数  
• 报表  
• 请求  

如果阶段类配置为需要这些附加标签，将在阶段中创建相应标签。使用启用物料的阶段类时，可向单个单元实例添加同一阶段类的多个实例。尽管这些阶段由同一阶段类创建，但通过与其关联的唯一物料容器进行区分。映射到同一阶段类的阶段具有独立的资源ID。  
**提示**：在设计视图中选择阶段时，其基于的阶段类将高亮显示。如果修改阶段类，阶段将自动更新，修改前创建的阶段也会更新。  

当多个单元需要同一阶段时，可在单元之间共享该阶段，但阶段一次只能由一个单元拥有。  


#### 创建阶段  
使用以下说明创建阶段。  
创建阶段的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 导航到区域模型的阶段类层级（选择“向下”( ) 至最低层级）。  
3. 在“类”树中选择所需的阶段类图标。  
4. 将光标放在设计视图窗格中要放置阶段的位置，单击打开“创建阶段”对话框。  
“创建阶段”对话框包含以下选项卡：  
◦ 常规  
◦ 仲裁Arbitration  
◦ 交叉调用Cross Invocation  
◦ 超链接  
◦ 容器（与物料管理器配合使用）  
◦ 标签  
◦ 参数限值标签  
◦ 报表限值标签  
5. 完成相应选项卡，然后单击“确定”。  
6. 若要向同一单元实例添加同一阶段的多个实例，再次选择阶段类。仅启用物料的阶段类可用于多个阶段。  


#### 配置阶段的常规数据  
使用以下说明配置“编辑阶段”对话框的“常规”选项卡。  
配置阶段常规数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑阶段”对话框的“常规”选项卡。  
3. 在“名称”框中，输入阶段名称。  
4. 在“ERP别名”中，输入SAP R/3阶段名称。  
5. 在“设备ID”中，输入设备ID或接受默认值。  
6. 在“数据服务器”中，确认显示与阶段对应的正确数据服务器。若不正确，从列表中选择适当的服务器。  
**提示**：若数据服务器与阶段不对应，将显示消息，提示继续操作会将分配重置为“<无>”。  
7. （仅与FactoryTalk eProcedure配合使用）  
a. 选择“指令文件”框旁边的浏览( )，打开“指令选择”对话框。  
b. 选择适用于该阶段的指令文件，指令将显示在“指令”区域。  
**重要**：为每个基于指令的阶段定义指令文件。如果基于指令的阶段配置中未关联指令文件，eProcedure服务器将无法启动。  
c. 选择“确定”返回“编辑阶段”对话框。  
8. 在“控制器程序名称”中，输入控制器程序中的阶段名称。  
**提示**：若未输入“控制器程序名称”，将通知该名称将设置为与阶段名称相同。  
9. 若要在START命令时自动下载适当参数，启用“START时自动下载参数”复选框。  
**提示**：仅当关联的阶段类参数和报表至少有一个属于上传/下载参数子集时，阶段的自动上传/下载功能才可用。选择基于指令的服务器时，这些功能禁用。  
10. 若要在批次转换到终端状态（完成、停止或中止）时自动上传适当的报表值，启用全部或单个“终端状态时自动上传参数”复选框。  
11. 选择“应用”保存更改。  


#### “编辑阶段”对话框 - 常规选项卡  
“编辑阶段”对话框的“常规”选项卡包含以下内容：  

| 名称                     | 用途                                                                 |  
|--------------------------|----------------------------------------------------------------------|  
| 名称                     | 阶段的名称。                                                         |  
| 阶段类                   | 创建此阶段的阶段类名称（仅查看），阶段类关联的图标显示在“名称”和“阶段类”旁边。 |  
| ERP别名                 | 阶段的SAP名称，ERP别名将设备模块从FactoryTalk Batch映射到SAP。         |  
| 设备ID                   | 标识此阶段的唯一编号，必须与阶段逻辑中请求此阶段时使用的ID相同。<br>启用动态单元分配并选择“第一个可用”方法时，FactoryTalk Batch服务器将对此框执行最终升序排序，并选择满足要求的最小ID设备。 |  
| 数据服务器               | 显示当前分配的服务器，打开列表时显示已配置的服务器。                     |  
| 指令文件                 | 仅与eProcedure配合使用。若数据服务器不是基于指令的服务器，此功能禁用，映射到与阶段关联的指令文件。 |  
| 控制器程序名称           | 控制器程序中的阶段名称。                                               |  
| START时自动下载参数       | 发出START命令时，FactoryTalk Batch服务器下载阶段中配置为“启动时下载”选项的参数。选中复选框启用此功能。若阶段中无参数，此选项灰显。<br>• 若阶段分配了OPC或FactoryTalk Linx FactoryTalk Live Data服务器，当阶段类的参数标签数量大于或等于参数数量时，此选项启用。<br>• 若阶段分配了Logix5000 CIP数据服务器，当阶段类中至少有一个参数选中“启动时下载”时，此选项启用。<br>• 若阶段分配了基于指令的服务器，此功能禁用。 |  
| 完成时自动上传参数<br>停止时<br>中止时 | 当批次转换到终端状态（完成、停止或中止）时，FactoryTalk Batch服务器上传阶段类中配置为“终端状态时上传”选项的报表值。选中复选框启用此功能。若阶段类中无报表，这些选项灰显。<br>• 若阶段分配了OPC或FactoryTalk Linx FactoryTalk Live Data服务器，当阶段类的报表标签数量大于或等于报表数量时，此选项启用。<br>• 若阶段分配了Logix5000 CIP数据服务器，当阶段类中至少有一个报表选中“终端状态时上传”时，此选项启用。<br>• 若阶段分配了基于指令的服务器，此功能禁用。 |  


#### 配置阶段的标签数据  
配置阶段的标签数据，以下说明仅适用于分配给OPC或FactoryTalk Linx FactoryTalk Live Data服务器的阶段。  
**提示**：对于分配给Logix5000 CIP数据服务器的PhaseManager阶段，无需配置标签数据。  
配置阶段标签数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在“编辑阶段”对话框中，选择“标签”选项卡。  
3. 在“控制中”和“控制外”框中，输入阶段的“控制中”和“控制外”扫描速率。  
如果与阶段关联的数据服务器是允许配置扫描速率的OPC或FactoryTalk Linx FactoryTalk Live Data服务器，可修改阶段的默认扫描速率。若无法修改，框将禁用。  
4. 选择“应用”保存更改。  


#### “编辑阶段”对话框 - 标签选项卡  
在“编辑阶段”对话框的“标签”选项卡中，分配给OPC或FactoryTalk Linx FactoryTalk Live Data服务器的阶段可用以下框：  

| 名称               | 用途                                                                 |  
|--------------------|----------------------------------------------------------------------|  
| 名称               | 阶段的名称（仅查看）。                                                 |  
| 阶段类             | 创建此阶段的阶段类名称（仅查看），阶段类关联的图标显示在“名称”和“阶段类”旁边。 |  
| 阶段标签           | 必须为阶段定义的所有标签的列表。                                       |  
| 默认值             | 将与此阶段关联的所有标签项恢复为其默认项名称和分配给阶段的数据服务器上配置的默认访问路径。默认标签项名称包含阶段名称（有关详细信息，请参见“将标签项设置为默认地址”）。 |  
| 名称               | 高亮显示的标签名称（仅查看）。                                         |  
| 类型               | 阶段标签数据类型（仅查看），类型框下方的框显示与默认标签关联的注释，报表、参数或附加请求标签无关联注释（仅查看）。 |  
| 类描述             | 显示当前所选标签类的描述。                                             |  
| 控制中扫描速率     | 显示与阶段关联的OPC或FactoryTalk Linx FactoryTalk Live Data服务器的控制中扫描速率（仅查看），只能在特定数据服务器定义(DSDF)文件中修改扫描速率，通常无需修改。<br>控制中扫描速率的有效范围为250到30,000毫秒。 |  
| 控制外扫描速率     | 显示与阶段关联的OPC或FactoryTalk Linx FactoryTalk Live Data服务器的控制外扫描速率（仅查看），只能在特定数据服务器定义(DSDF)文件中修改扫描速率，通常无需修改。<br>控制外扫描速率的有效范围为250到60,000毫秒。 |  


#### 阶段标签  
阶段标签自动命名，不可直接修改。若阶段名称更改，标签名称也会更改。每个OPC或FactoryTalk Linx FactoryTalk Live Data阶段创建十个默认标签，附加标签根据指定的报表、参数和请求标签数量创建。  

阶段创建后，必须配置所有阶段标签以包含正确的标签项，标签项引用存储标签数据的地址位置。十个默认标签的数据类型为整数，不可修改。  

任何已配置附加标签的默认数据类型为实数。在阶段类中定义参数和报表标签时可更改其数据类型，编辑阶段时可更改附加请求标签的数据类型。  
**提示**：不支持无符号数据类型。  

向区域模型添加阶段时，为每个标签选择分配的数据服务器。编辑阶段时，可更改分配给标签的数据服务器。  
**提示**：限值标签的数据服务器必须与其关联的参数标签的数据服务器相同。若更改参数标签的数据服务器，关联限值标签的数据服务器也会自动更改。<br>无法更改限值标签的数据服务器。若要更改限值标签的数据服务器，需更改其关联参数标签的数据服务器。  


#### 阶段标签命名约定  
阶段标签的命名约定基于名为CHARGE1的阶段，##为每个用户定义的参数、报表和附加请求标签的序号，从01开始。以下示例中阶段类仅配置了一个参数、报表和附加请求，将##替换为01。  

| 类名称         | 标签名称        | 示例          |  
|----------------|-----------------|---------------|  
| 参数标签       | PARMTR##        | CHARGE1P01    |  
| 参数限值标签   | PARMTR##M       | CHARGE1P01M   |  
|                | PARMTR##L       | CHARGE1P01L   |  
|                | PARMTR##H       | CHARGE1P01H   |  
|                | PARMTR##LL      | CHARGE1P01LL  |  
|                | PARMTR##HH      | CHARGE1P01HH  |  
|                | PARMTR##LLL     | CHARGE1P01LLL |  
|                | PARMTR##HHH     | CHARGE1P01HHH |  
| 报表标签       | REPORT##        | CHARGE1R01    |  
| 报表限值标签   | REPORT##M       | CHARGE1R01M   |  
|                | REPORT##L       | CHARGE1R01L   |  
|                | REPORT##H       | CHARGE1R01H   |  
|                | REPORT##LL      | CHARGE1R01LL  |  
|                | REPORT##HH      | CHARGE1R01HH  |  
|                | REPORT##LLL     | CHARGE1R01LLL |  
|                | REPORT##HHH     | CHARGE1R01HHH |  
| 请求标签       | REQUEST##       | CHARGE1Q01    |  
| 默认标签       | COMMAND         | CHARGE1_OC    |  
|                | FAILURE         | CHARGE1_F     |  
|                | OWNER           | CHARGE1_W     |  
|                | PAUSE           | CHARGE1_P     |  
|                | PAUSED          | CHARGE1_PD    |  
|                | REQUEST         | CHARGE1_RQ    |  
|                | SINGLE_STEP     | CHARGE1_SS    |  
|                | STATUS          | CHARGE1_ST    |  
|                | STEP_INDEX      | CHARGE1_SI    |  
|                | UNIT            | CHARGE1_UN    |  


#### 配置阶段标签  
使用以下说明配置阶段标签。  
配置阶段标签的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 从“编辑标签”对话框的“标签”列表框中，双击所需的阶段标签，打开“编辑阶段标签”对话框。  
3. 从“类型”列表中选择适当的数据类型。OPC或FactoryTalk Linx FactoryTalk Live Data服务器不接受枚举数据类型，应使用整数。若阶段类启用了“参数/标签锁定”，无法修改类型。  
**提示**：不支持未分配的数据类型。  
4. 在“访问路径”中，输入适当的访问路径。  
5. 在“项名称”中，输入适当的项名称。  
6. 若数据服务器需要单独的读写项，在“写入访问路径”框中输入写入访问路径。  
7. 若数据服务器需要单独的读写项，在“写入项名称”框中输入写入项名称。  
8. 从“数据服务器”列表中，若默认值不正确，选择适当的数据服务器。  
9. 选择“确定”返回“编辑标签”对话框。  
10. 选择“确定”关闭“编辑标签”对话框。  


#### “编辑阶段标签”对话框  
使用“编辑阶段标签”对话框配置阶段标签，该对话框包含以下内容：  

| 名称               | 用途                                                                 |  
|--------------------|----------------------------------------------------------------------|  
| 名称               | 阶段标签的自动分配名称（仅查看）。                                     |  
| 标签类             | 阶段标签类（仅查看）。                                                 |  
| 类型               | 阶段标签数据类型。定义为枚举的参数和报表默认类型为整数，不应设置为枚举，因为OPC或FactoryTalk Linx FactoryTalk Live Data服务器不识别此标签类型。定义为枚举的参数和报表应使用整数作为标签类型。若阶段“参数/标签锁定”已启用（选中），无法修改类型。 |  
| 枚举               | 不应使用，OPC或FactoryTalk Linx FactoryTalk Live Data服务器不识别枚举标签类型。定义为枚举的参数和报表必须使用整数作为标签类型。若阶段“参数/标签锁定”已启用（选中），无法修改枚举。 |  
| 访问路径           | 数据服务器尝试订阅标签值或执行读取操作时，与读取项一起使用的OPC访问路径。当关联的OPC数据服务器需要单独的读写项时，此框变为“读取项访问路径”。 |  
| 项名称             | 订阅标签值或执行读取操作时使用的项名称。当关联的OPC数据服务器需要单独的读写项时，此框变为“读取项名称”。 |  
| 写入访问路径       | 写入项的OPC访问路径。若数据服务器不需要单独的读写项，此框禁用。         |  
| 写入项名称         | 写入项的OPC项名称。若数据服务器不需要单独的读写项或访问路径，此框禁用。 |  
| 数据服务器         | 阶段标签使用的用户定义数据服务器名称（请求、控制和限值标签此框禁用）。     |  
| 类型               | DSDF文件中定义的数据服务器（仅查看）。                                 |  


#### 将标签项设置为默认地址  
在区域模型中从阶段类创建阶段时，阶段的默认名称为<phasename>1。例如，若阶段为AGITATE，从此阶段类创建的阶段默认名称为AGITATE1。  

阶段的标签项默认名称为：<设备模块名称><标签分隔符><标签扩展名>  
例如，若标签分隔符为句点(.)，阶段AGITATE1的请求标签(RQ)为：AGITATE1.RQ  

若阶段名称更改，标签项名称不会自动更新以反映新名称。例如，若阶段名称从AGITATE1更改为AGITATE_U2，标签“名称”将反映新名称(AGITATE_U2)，但标签“项名称”仍反映阶段的原始名称(AGITATE1)，此时AGITATE_U2阶段的请求标签仍为AGITATE1.RQ。  

使用“默认值”按钮为阶段重新建立默认地址信息，“项”“读取访问路径”“读取项名称”“写入项路径”和“写入项名称”将恢复为分配给阶段的数据服务器指定的相应默认值，阶段标签名称将更改以反映阶段的当前名称。  
**重要**：此操作不可撤销！选择“默认值”后，所有标签项名称和访问路径将自动更改（有关详细信息，请参见“将所有标签项设置为默认名称和访问路径”）。  

将标签设置为默认地址的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在“编辑阶段”对话框的“标签”选项卡中，选择“默认值”。  
3. 选择“是”设置默认值并返回“编辑阶段”对话框。  


#### 配置阶段的仲裁数据  
使用以下说明配置仲裁数据。  
配置阶段仲裁数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑阶段”对话框的“仲裁”选项卡。  
3. 浏览区域模型的设备层次结构，指定设备阶段获取的设备。设备类型左侧缺少加号或减号表示未定义设备，也可能表示该设备类型在此级别不能用作所需设备项。  
◦ 要添加设备，在“按资源分配设备”区域下，选择阶段所需的设备并选择“添加”，所选设备将显示在右窗格中。  
◦ 要删除设备，在右窗格中选择要删除的设备并选择“删除”，所选设备将从列表中移除。  
4. 选择“应用”保存更改。  
**提示**：阶段没有用于定义的“最大所有者数”框，因为阶段一次只能执行一个配方阶段类，因此所有阶段只能有一个所有者。  


#### “编辑阶段”对话框 - 仲裁选项卡  
“编辑阶段”对话框的“仲裁”选项卡包含以下内容：  

| 名称               | 用途                                                                 |  
|--------------------|----------------------------------------------------------------------|  
| 名称               | 阶段的名称（仅查看），阶段类关联的图标显示在“名称”和“阶段类”旁边。       |  
| 阶段类             | 创建此阶段的阶段类名称（仅查看）。                                     |  
| 按资源分配设备     | 此阶段需要拥有的设备列表，以便任何链接到该阶段的程序元素开始执行。       |  


左窗格以层次结构显示区域模型的当前设备配置，层次结构有两个根：  
• 工艺单元：显示区域模型内的所有工艺单元，按层次结构组织：工艺单元包含单元，单元包含阶段和操作序列。  
• 资源：显示区域模型内所有已配置资源的列表。  
右窗格是此阶段依赖的设备列表，此列表中的任何设备必须由阶段获取，阶段才能开始执行。  

| 添加   | 将所选设备需求添加到“所需设备”列表。                                   |  
|--------|----------------------------------------------------------------------|  
| 删除   | 从“所需设备”列表中移除所选设备需求。                                   |  


#### 配置阶段的交叉调用数据  
使用以下说明配置交叉调用数据。  
**提示**：FactoryTalk eProcedure不支持交叉调用。  
配置阶段交叉调用数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑阶段”对话框的“交叉调用”选项卡。  
3. 在“交叉调用配置”中，输入交叉调用字符串信息。  
4. 选择“应用”保存更改。  


#### “编辑阶段”对话框 - 交叉调用选项卡  
“编辑阶段”对话框的“交叉调用”选项卡包含以下内容：  

| 名称               | 用途                                                                 |  
|--------------------|----------------------------------------------------------------------|  
| 名称               | 阶段的名称（仅查看）。                                                 |  
| 阶段类             | 创建此阶段的阶段类名称（仅查看），阶段类关联的图标显示在“名称”和“阶段类”旁边。 |  
| 交叉调用配置       | 交叉调用字符串用于向FactoryTalk Batch视图和HMI控制快捷菜单添加项目，包括菜单项的标题和选择菜单项时传递给指定自动化服务器的数据。五个字段的默认标签为“交叉调用标签 #”（# 为1到5），这些标签可在“服务器选项”对话框中修改，并在“编辑工艺单元”对话框中显示。 |  


#### 配置阶段的超链接数据  
使用以下说明配置超链接数据。  
配置阶段超链接数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在“编辑阶段”对话框中，选择“超链接”选项卡。  
3. 在“超链接配置”框中，输入有效的URL字符串。  
4. 选择“应用”保存更改。  


#### “编辑阶段”对话框 - 超链接选项卡  
“编辑阶段”对话框的“超链接”选项卡包含以下内容：  

| 名称               | 用途                                                                 |  
|--------------------|----------------------------------------------------------------------|  
| 名称               | 阶段的名称（仅查看）。                                                 |  
| 阶段类             | 创建此阶段的阶段类名称（仅查看），阶段类关联的图标显示在“名称”和“阶段类”旁边。 |  
| 超链接配置         | 与每个超链接标签关联的URL。五个字段的默认标签为“超链接标签 # English”（# 为1到5），可在“服务器选项”对话框中修改，用于eProcedure客户端设备视图。 |  


#### 配置容器数据  
“容器”选项卡仅在启用物料的阶段类中可见。  
配置此阶段可从中选择物料或向其分配物料（或两者）的容器集。  
**提示**：若物料服务器不可用，“容器和存储位置关联”区域将包含错误消息，提示容器数据不可用。“容器”列不可用，但包含先前配置的关联。  

配置容器数据的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 选择“编辑阶段”对话框的“容器”选项卡。  
3. 浏览容器和存储位置树，指定与阶段的关联。“容器”或“存储位置”左侧缺少加号或减号表示未定义容器或存储位置，需在物料编辑器中定义。  
在“容器和存储位置关联”区域下，选择阶段所需的容器或存储位置并选择“添加”，所选项目将显示在右窗格的“容器/存储位置”列下。不允许添加已存在于“容器/存储位置”列中的容器。  
要移除容器或存储位置，在右窗格中选择要删除的项目并选择“删除”，所选项目将从列表中移除。  
4. 选中相应复选框，指示容器是物料源（从该容器提取物料）、物料目标（物料进入该容器）或两者。  
**提示**：配置必须选中至少一个复选框（添加或分配），且必须与容器行为一致。阶段类参数中配置的高值和低值指定容器行为，即阶段类是物料添加、分配或两者：  
添加 - 低 = 0，高 = 正数  
分配 - 低 = 负数，高 = 0  
两者 - 低 = 负数，高 = 正数  
5. 选择“应用”保存更改。  
6. 选择“确定”关闭“编辑阶段”对话框。  


#### “编辑阶段”对话框 - 容器选项卡  
“编辑阶段”对话框的“容器”选项卡包含以下内容：  

| 名称                         | 用途                                                                 |  
|------------------------------|----------------------------------------------------------------------|  
| 名称                         | 阶段的名称（仅查看）。                                                 |  
| 阶段类                       | 创建此阶段的阶段类名称（仅查看），阶段类关联的图标显示在“名称”和“阶段类”旁边。 |  
| 容器和存储位置关联           | 此阶段连接的容器和存储位置列表，右窗格的两列指示容器是物料源还是目标，图标用于表示物料源（带加号的容器）和物料目标（带减号的容器）。 |  


左窗格以层次结构显示物料数据库中当前配置的容器和存储位置集，层次结构有两个根：  
• 容器：显示物料数据库中未与存储位置关联的所有容器，不显示存储位置内的容器，因为阶段仅与独立容器或存储位置关联，从不与存储位置内的容器关联。  
• 存储位置：显示物料编辑器中配置的所有存储位置的列表。  

| 添加   | 将所选容器或存储位置添加到“容器/存储位置”列。                         |  
|--------|----------------------------------------------------------------------|  
| 删除   | 从“容器/存储位置”列中移除所选容器或存储位置。                         |  


#### 参数限值标签  
若启用“参数/标签锁定”，FactoryTalk Batch设备编辑器可确定并构建将所有参数限值和验证配置详细信息下载到阶段逻辑所需的标签。若禁用“参数/标签锁定”，通过为这些参数选择适当的参数限值标签集，将所有限值信息下载到所选参数。基于指令的阶段不显示“参数限值标签”选项卡。  


##### 启用参数限值标签  
使用“编辑阶段”对话框的“参数限值标签”选项卡启用参数限值标签，必须在“编辑阶段”对话框的“常规”选项卡中启用“参数/标签锁定”选项。  
启用参数限值标签后，将为定义了签名验证策略的参数创建所需的验证限值标签。  
启用参数限值标签的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在“编辑阶段”对话框中，选择“参数限值标签”选项卡。  
3. 选中“启用限值标签”复选框。  
此阶段中所有具有签名验证策略的参数所需的限值标签将自动创建并显示在“限值标签”区域。  
4. 选择“确定”关闭“编辑阶段”对话框，或选择“应用”保持对话框打开。  


##### “编辑阶段”对话框 - 参数限值标签选项卡  
自动创建和维护阶段类中定义的参数所需的阶段参数标签。  
如果创建阶段的阶段类启用了“参数/标签锁定”选项，系统将自动为定义了签名验证策略的参数创建所需的验证限值标签。  

| 名称                         | 用途                                                                 |  
|------------------------------|----------------------------------------------------------------------|  
| 名称                         | 阶段的名称。                                                         |  
| 阶段类                       | 创建此阶段的阶段类名称。                                             |  
| 启用限值标签                 | 为阶段类中配置的验证策略创建必要的参数限值标签，仅当在“编辑阶段类”对话框的“常规”选项卡中选择“参数/标签锁定”选项时可用。<br>若未选择“参数/标签锁定”选项，定义限值标签集并将参数标签映射到限值标签。仅当禁用“参数/标签锁定”时，这些区域启用。 |  


##### 参数标签到限值标签映射区域  
| 参数标签                     | 显示阶段类中创建的用户定义参数的标签名称（仅查看）（有关阶段标签命名约定的信息，请参见“阶段标签”）。 |  
|------------------------------|----------------------------------------------------------------------|  
| 类型                         | 显示参数的数据类型（仅查看）。                                         |  
| 限值标签集                   | 为参数创建必要的验证限值标签集，选择与“编辑阶段类”对话框“参数”选项卡中配置的验证方法相同的选项。 |  


##### 限值标签区域  
| 限值标签滚动框               | 显示为所选“限值标签集”创建的阶段标签类集。                             |  
|------------------------------|----------------------------------------------------------------------|  
| 名称                         | 显示为所选标签类定义的阶段标签（仅查看）。                             |  
| 类型                         | 显示阶段标签数据类型，类型框下方的区域描述阶段标签（仅查看）。         |  


##### 将参数标签映射到参数限值标签  
如果阶段类未启用“参数/标签锁定”且手动创建参数标签，使用“编辑阶段”对话框的“参数限值标签”选项卡将参数标签映射到参数限值标签，以下说明仅适用于OPC或FactoryTalk Linx FactoryTalk Live Data阶段。  
如果阶段类禁用了“参数/标签锁定”选项，为每个参数标签手动选择适当的限值标签集。  
将参数标签映射到参数限值标签的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在“编辑阶段”对话框中，选择“参数限值标签”选项卡。  
3. 将光标放在要映射的参数所在行的“限值标签集”框中。  
**提示**：在将参数标签映射到限值标签之前，记住更新“编辑阶段类”对话框“常规”选项卡中的“标签数量”框。即使向阶段类添加了参数并为其配置了验证方法，如果阶段类中输入的标签数量过少，“参数标签到限值标签映射”区域也不会显示参数标签。  
4. 从“限值标签集”列表中，选择与阶段类上为参数定义的验证方法匹配的选项。  
**提示**：如果阶段基于的阶段类使用控制策略，选择具有最多限值的控制策略的验证方法。例如，若阶段类有两个控制策略，策略1的验证方法为H/L，策略2的验证方法为HHH/LLL，选择HHH/LLL限值标签集。  
5. 对每个具有指定参数验证限值的验证策略的参数，重复步骤2和3。  
6. 选择“确定”关闭“编辑阶段”对话框，或选择“应用”保持对话框打开。  
为所选“限值标签集”所需的所有限值标签将创建并显示在“限值标签”区域。  


#### 报表限值标签  
如果启用“参数/标签锁定”，允许FactoryTalk Batch设备编辑器确定并构建将报表限值和验证配置详细信息下载到阶段逻辑所需的标签。如果禁用“参数/标签锁定”，通过为这些参数选择适当的报表限值标签集，将所有限值信息下载到所选报表。基于指令的阶段不显示“报表限值标签”选项卡。  


##### “编辑阶段”对话框 - 报表限值标签选项卡  
启用“启用限值标签”复选框后，将为阶段中定义的参数和报表创建和维护必要的阶段参数和报表标签。  

| 名称                         | 用途                                                                 |  
|------------------------------|----------------------------------------------------------------------|  
| 名称                         | 阶段的名称。                                                         |  
| 阶段类                       | 创建此阶段的阶段类名称。                                             |  
| 启用限值标签                 | 为阶段类中配置的验证策略创建必要的参数限值标签，仅当在“编辑阶段类”对话框的“常规”选项卡中选择“参数/标签锁定”选项时可用。<br>若未选择“参数/标签锁定”选项，定义限值标签集并将参数标签映射到限值标签。仅当禁用“参数/标签锁定”时，这些区域启用。 |  


##### 报表标签到限值标签映射区域  
| 报表标签                     | 显示阶段类中创建的用户定义报表的标签名称（仅查看）（有关阶段标签命名约定的信息，请参见“配置阶段标签”）。 |  
|------------------------------|----------------------------------------------------------------------|  
| 类型                         | 显示报表的数据类型（仅查看）。                                         |  
| 限值标签集                   | 为报表创建必要的验证限值标签集，选择与“编辑阶段类”对话框“报表”选项卡中配置的验证方法相同的选项。 |  


##### 限值标签区域  
| 限值标签滚动框               | 显示为所选“限值标签集”创建的阶段标签类集。                             |  
|------------------------------|----------------------------------------------------------------------|  
| 名称                         | 显示为所选标签类定义的阶段标签（仅查看）。                             |  
| 类型                         | 显示阶段标签数据类型，类型框下方的区域描述阶段标签（仅查看）。         |  


##### 启用报表限值标签  
使用“编辑阶段”对话框的“报表限值标签”选项卡启用限值标签，必须在“编辑阶段”对话框的“常规”选项卡中启用“参数/标签锁定”选项才能启用限值标签。  
启用“启用限值标签”复选框后，将为阶段中定义的参数和报表创建和维护必要的阶段参数和报表标签。  
启用报表限值标签的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在“编辑阶段”对话框中，选择“报表限值标签”选项卡。  
3. 选中“启用限值标签”复选框。  
此阶段中所有具有签名验证策略的报表所需的限值标签将自动创建并显示在“限值标签”区域。  
4. 选择“确定”关闭“编辑阶段”对话框，或选择“应用”保持对话框打开。  


##### 将报表标签映射到报表限值标签  
如果禁用“参数/标签锁定”且手动创建参数标签，按以下步骤创建参数限值标签，以下说明仅适用于OPC或FactoryTalk Linx FactoryTalk Live Data阶段。  
如果禁用“参数/标签锁定”，为每个报表标签手动选择适当的“限值标签集”。  
将报表标签映射到报表限值标签的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 在“编辑阶段”对话框中，选择“报表限值标签”选项卡。  
3. 将光标放在要映射的参数所在行的“限值标签集”框中。  
**提示**：在将报表标签映射到限值标签之前，记住更新“编辑阶段”对话框“常规”选项卡中的“标签数量”框。即使向阶段添加了报表并为其配置了验证方法，如果阶段中输入的标签数量过少，“报表标签到限值标签映射”区域也不会显示报表标签。  
4. 从“限值标签集”列表中，选择与阶段类上为报表定义的验证方法匹配的选项。  
**提示**：如果阶段基于的阶段类使用控制策略，选择具有最多限值的控制策略的验证方法。例如，若阶段类有两个控制策略，策略1的验证方法为H/L，策略2的验证方法为HHH/LLL，选择HHH/LLL限值标签集。  
为所选“限值标签集”所需的所有限值标签将创建并显示在“限值标签”区域。  
5. 选择“确定”关闭“编辑阶段”对话框，或选择“应用”保持对话框打开。  


#### 配置参数和报表限值标签  
启用或映射参数和报表限值标签后，为每个限值标签配置“访问路径”和“项名称”，这些在配置其他阶段标签的同一“编辑阶段标签”对话框中配置。  
**提示**：无法更改限值标签的数据服务器，限值标签的数据服务器必须与参数或映射报表标签的数据服务器相同。更改参数或报表的数据服务器时，其对应限值标签的数据服务器将自动更改以匹配。  


#### 参数、报表和阶段类编辑与限值标签  
启用或映射限值标签后，如果参数或报表的验证方法更改，限值标签将自动调整以匹配新的验证方法，自动创建或删除新标签，无需更改现有限值标签的数量。  
**重要**：启用或映射限值标签后，如果阶段的数据服务器更改为指令服务器，所有限值标签将自动删除，基于指令的阶段不需要限值标签。  

如果启用“参数/标签锁定”：  
• 当阶段类包含控制策略时，参数的限值标签数量为分配给该参数的任何控制策略的最大限值集。删除控制策略时，系统自动重新计算每个参数所需的限值标签集，并相应调整限值标签的数量。如果删除为参数定义最大限值集的控制策略，限值标签的数量将自动减少。  
• 如果创建阶段的限值标签时启用了“参数/标签锁定”，然后禁用该选项，现有标签将保留且不修改。  
• 如果删除参数或报表，相应的限值标签集将自动删除，其他剩余参数或报表的参数标签到限值标签集将保留，分配给每个标签的项名称保持不变。  
**重要**：如果未启用“参数/标签锁定”，从阶段类中删除参数或报表并减少“编辑阶段”对话框“常规”选项卡中的标签数量，需重新映射剩余参数标签到限值标签集，参数标签名称和限值标签关联将移位，不会保留。  


#### 在单元之间共享阶段和操作序列  
当多个单元需要单个阶段或操作序列时，所有需要的单元必须共享该阶段或操作序列，请勿在其他单元中创建同一阶段或操作序列的新实例。共享阶段或操作序列前，验证该阶段或操作序列可实际共享。  
**提示**：阶段不能在批次服务器之间共享。  

阶段或操作序列一次只能有一个所有者。共享单个阶段或操作序列可使任何共享单元在批次执行期间获得其所有权，但同一时间不能被多个单元拥有。  

共享阶段或操作序列时，对其进行的任何更改将反映在包含该共享阶段或操作序列的每个单元中，包括其在设计视图区域中的物理位置。从一个单元中删除共享阶段或操作序列的实例时，该阶段或操作序列将从所选单元中移除，但仍存在于其所属的其他单元中。  


##### 共享阶段或操作序列  
使用以下说明共享阶段或操作序列。  
共享阶段或操作序列的步骤：  
1. 选择“开始”>“Rockwell Software”>“设备编辑器”。  
2. 打开区域模型。  
3. 导航到区域模型中不包含要共享的阶段或操作序列的单元的阶段或操作序列层级。  
4. 选择“共享”。  
将显示“在单元之间共享阶段和操作序列”对话框，通过选择单元名称旁边的加号(+)导航到阶段和操作序列。  
5. 选择要与当前单元共享的阶段或操作序列，然后选择“确定”。  
所选阶段或操作序列的图标将显示在设计视图区域中，活动单元和最初定义该阶段或操作序列的单元中，图标左下角将显示小手图标。



## 操作序列Operation sequence配置
操作序列是特定操作序列类的一个实例。每个单元只能添加特定操作序列的一个实例。一旦将操作序列实例添加到单元实例中，就必须对该操作序列进行配置。  
**提示**：无需配置标签数据，因为序列管理器(SequenceManager)的设备操作序列已分配给Logix5000 CIP数据服务器。  

当在设计视图中选择一个操作序列时，其基础的操作序列类会被高亮显示。如果修改了操作序列所基于的操作序列类，则操作序列会自动更新。在修改操作序列类之前创建的操作序列也会被更新。

### 创建操作序列
使用以下步骤创建操作序列：  
1. 选择 **开始 > Rockwell Software > 设备编辑器**。  
2. 打开区域模型。  
3. 导航至区域模型的操作序列层级（选择 **向下(↓)** 按钮直至最低层级）。  
4. 在 **类(Classes)** 区域中，选择操作序列并将其放置到设计视图中希望实例存在的位置。  
5. 使用 **编辑操作序列(Edit Operation Sequence)** 对话框查看并配置 **常规(General)**、**仲裁(Arbitration)** 和 **标签(Tags)** 选项卡中的属性。  
**提示**：若要允许FactoryTalk Batch写入序列标签，需在Studio 5000 Logix Designer中选择 **使用标签的当前值(Use current value of tag)** 单选按钮。


### 编辑操作序列对话框 - 常规选项卡
操作序列的常规属性包括操作序列类名称、设备ID和当前分配的数据服务器。  
**编辑操作序列**对话框的**常规**选项卡包含：  

| **名称**               | **用途**                                                                 |
|------------------------|--------------------------------------------------------------------------|
| **名称(Name)**         | 操作序列的名称。                                                         |
| **操作类(Operation Class)** | 创建此操作序列的操作序列类名称（只读）。                                  |
| **设备ID(Equipment ID)** | 大于零的唯一编号，用于标识此操作序列。必须与阶段逻辑中请求此操作序列时使用的设备ID相同。 |
| **数据服务器(Data Server)** | 显示当前分配的服务器。打开列表时，将显示已配置的服务器。                     |
| **控制器程序名称(Controller Program Name)** | 控制器程序中操作序列的名称。                                         |
| **启动时自动下载参数(Automatically Download Parameters on Start)** | 当发出**启动(START)**命令时，FactoryTalk Batch服务器将下载操作序列中配置为**启动时下载(Download on Start)**的参数。若操作序列上不存在参数，则此选项将变灰。 |
| **停止、中止和完成时自动上传报告(Automatically Upload Reports on Stop Abort, and Complete)** | 当批次转换到终止状态（**完成(COMPLETE)**、**已停止(STOPPED)**或**已中止(ABORTED)**）时，FactoryTalk Batch服务器将上传操作序列中配置为**终止状态上传(Upload on Terminal State)**的报告值。若操作序列上不存在报告，则此选项将变灰。 |


### 配置操作序列的常规数据
使用以下步骤通过**编辑操作序列**对话框的**常规**选项卡配置操作序列的常规数据：  
1. 选择 **开始 > Rockwell Software > 设备编辑器**。  
2. 打开**编辑操作序列**对话框，选择**常规**选项卡。  
3. 在**名称**字段中，输入操作序列名称。  
4. 在**设备ID**字段中，输入设备ID或接受默认值。  
5. 在**数据服务器**字段中，确认显示正确的数据服务器。若不正确，可选择列表查找合适的服务器。  
6. 在**控制器程序名称**字段中，输入控制器程序名称。  
7. 选择**应用(Apply)**保存更改，或选择**确定(OK)**保存更改并返回设备编辑器。


### 编辑操作序列对话框 - 仲裁选项卡
**编辑操作序列**对话框的**仲裁**选项卡用于配置操作序列实例运行时必须获取的资源。  
**仲裁**选项卡包含：  

| **名称**                     | **用途**                                                                 |
|------------------------------|--------------------------------------------------------------------------|
| **名称(Name)**               | 操作序列的名称（只读）。                                                 |
| **操作类(Operation Class)**   | 创建此操作序列的操作序列类名称（只读）。                                  |
| **按资源分配设备(Equipment Allocation by Resource)** | 此操作序列执行任何关联的程序元素前必须拥有所有权的设备列表。左窗格以层次结构显示区域模型的当前设备配置（包含两个根节点：**处理单元(Process Cells)**显示区域模型中的所有处理单元，**资源(Resources)**显示所有配置的资源）；右窗格显示此操作序列依赖的设备。右窗格中的任何设备必须在操作序列开始执行前被获取。 |
| **添加(Add)**                | 添加所选设备需求。                                                       |
| **删除(Remove)**             | 删除所选设备需求。                                                       |


### 配置操作序列的仲裁数据
使用以下步骤通过**编辑操作序列**对话框的**仲裁**选项卡配置操作序列的仲裁数据：  
1. 选择 **开始 > Rockwell Software > 设备编辑器**。  
2. 打开**编辑操作序列**对话框，选择**仲裁**选项卡。  
3. 浏览区域模型的设备层次结构，指定操作序列需要获取的设备。可通过展开设备查看包含的资源来导航层次结构：  
   - 若要添加设备，在**按资源分配设备**区域下，选择操作序列所需的设备并点击**添加(Add)**，所选设备将显示在右窗格中。  
   - 若要删除设备，在右窗格中选择要删除的设备并点击**删除(Remove)**，所选设备将从列表中移除。  
4. 选择**应用(Apply)**保存更改。


### 编辑操作序列对话框 - 标签选项卡
**编辑操作序列**对话框的**标签**选项卡显示操作序列的CIP通信数据配置。  
**标签**选项卡包含：  

| **名称**                 | **用途**                                                                 |
|--------------------------|--------------------------------------------------------------------------|
| **名称(Name)**           | 操作序列的名称（只读）。                                                 |
| **操作类(Operation Class)** | 创建此操作序列的操作序列类名称（只读）。                                  |
| **操作序列标签(Operation sequence tags)** | 为操作序列定义的所有标签列表（只读）。这些标签在**操作序列类**对话框的**报告(Reports)**和**参数(Parameters)**选项卡中配置。 |
| **名称(Name)**           | 高亮显示的标签名称（只读）。                                             |
| **用途(Usage)**          | 参数类型（只读），分为**输入(Input)**或**输出(Output)**。               |
| **类型(Type)**           | 操作序列标签的数据类型（只读）。                                          |
**提示**：对于Logix5000控制器，使用**ENUM**类型的参数和报告将显示为**INTEGER**类型。


### 配置操作序列类的参数
使用**创建操作序列类**对话框的**参数**选项卡配置操作序列类的参数。  
**提示**：可使用键盘在表格中移动。按**Tab**键将焦点移至表格，按**Ctrl+Alt+Home**高亮显示表格中的第一个可编辑单元格。  

配置操作序列类参数的步骤：  
1. 选择 **开始 > Rockwell Software > 设备编辑器**。  
2. 选择单元图标，然后选择 **向下(↓)**。设计视图区域可能显示单元图标，类视图区域的列标题显示为**类(Classes)**。  
3. 在类视图区域中，右键点击操作序列以打开**编辑操作序列类**对话框。  
4. 选择**参数**选项卡，将显示与操作序列类关联的参数列表。  
5. 选择**添加参数(Add Parameter)**添加新的操作序列类参数，新参数将显示默认值。  
6. 在**名称(Name)**字段中，为操作序列类参数输入唯一名称。  
**重要**：参数名称必须与控制器中设备序列的排序输入参数名称匹配。  
7. 从**类型(Type)**列表中，选择适当的参数类型。该参数类型必须与控制器中设备序列的排序输入参数类型一致。有关排序输入参数类型的信息，请参阅**创建操作序列类**对话框的**参数**选项卡。  
   - 若**类型**为**实数(Real)**或**整数(Integer)**，需添加**最大值(Max value)**、**最小值(Min value)**和**默认值(Default value)**，然后可在**枚举/工程单位(Enum/E.U.)**框中输入工程单位。  
   - 若**类型**为**枚举(Enumeration)**，从**枚举/工程单位**列表中选择适当的枚举集，并从**默认(Default)**列表中选择适当的默认枚举值。  
   - 若**类型**为**字符串(String)**，在**枚举/工程单位**框中输入工程单位，在**默认(Default)**框中输入默认字符串。  
8. 若参数必须在批次缩放时按配方缩放，请选择**缩放(Scale)**复选框（有关详细信息，请参阅**缩放参数**）。  
9. 若要为配方操作序列类参数分配上下文或描述符，请从**报告上下文(Reporting Contexts)**列中选择一个或多个**上下文ID(Context IDs)**。  
10. 若要删除参数：  
    - 选择参数行标题，然后选择**删除参数(Delete Parameter)**。  
    - 选择**是(Yes)**确认删除。  
11. 选择**应用(Apply)**保存更改，或选择**确定(OK)**保存更改并返回类视图区域，所选图标将显示在类视图区域中。


### 配置操作序列类的报告
使用**创建操作序列类**对话框的**报告**选项卡配置操作序列类的报告。操作序列类报告是为操作序列类定义的，而相应的报告标签会自动为操作序列实例创建。  

配置操作序列类报告的步骤：  
1. 选择 **开始 > Rockwell Software > 设备编辑器**。  
2. 选择单元图标，然后选择 **向下(↓)**。设计视图区域可能显示单元图标，类视图区域的列标题显示为**类(Classes)**。  
3. 在类视图区域中，右键点击操作序列以打开**编辑操作序列类**对话框。  
4. 选择**报告**选项卡，将显示与操作序列关联的操作序列报告列表。  
**提示**：可使用键盘在表格中移动。按**Tab**键将焦点移至表格，按**Ctrl+Alt+Home**高亮显示表格中的第一个可编辑单元格。  
5. 选择**添加报告(Add Report)**添加新的操作序列报告，新报告将显示默认值：  
   - 在**名称(Name)**字段中，为报告参数输入唯一名称。  
   **重要**：报告名称必须与控制器中设备序列的排序输出参数名称匹配。  
   - 从**类型(Type)**列表中，选择适当的参数类型。该报告类型必须与控制器中设备序列的排序输出参数类型一致。有关排序输出参数类型的信息，请参阅**创建操作序列类**对话框的**报告**选项卡。  
     - 若**类型**为**实数(REAL)**、**字符串(STRING)**或**整数(INTEGER)**，在**枚举/工程单位(Enum/E.U.)**框中输入工程单位。  
     - 若**类型**为**枚举(ENUM)**，从**枚举/工程单位**框中选择适当的枚举集。  
   - 若要为报告参数分配上下文或描述符，从**报告上下文**列中选择一个或多个**上下文ID**。  
6. 若要删除报告：  
   - 选择报告行标题，然后选择**删除报告(Delete Report)**。  
   - 选择**是(Yes)**确认删除。  
7. 选择**应用(Apply)**保存更改，或选择**确定(OK)**保存更改并返回类视图区域，所选图标将显示在类视图区域中。


### 在单元之间共享阶段和操作序列
当多个单元需要同一个阶段或操作序列时，必须由所有需要它的单元共享，而不要在其他单元中创建相同阶段或操作序列的新实例。在共享阶段或操作序列之前，需验证该阶段或操作序列是否具备物理共享条件。  
**提示**：阶段不能在批次服务器之间共享。  

阶段或操作序列在同一时间只能有一个所有者。共享单个阶段或操作序列允许任何共享单元在批次执行期间获得其所有权，但同一时间不能有多个单元拥有该阶段或操作序列。  

当阶段或操作序列被共享时，对其进行的任何更改都会反映在包含该共享阶段或操作序列的每个单元中，包括其在设计视图区域中的物理位置。当从一个单元中删除共享阶段或操作序列的实例时，该阶段或操作序列将从所选单元中移除，但仍存在于其他所属单元中。


### 共享阶段或操作序列
使用以下步骤共享阶段或操作序列：  
1. 选择 **开始 > Rockwell Software > 设备编辑器**。  
2. 打开区域模型。  
3. 导航至区域模型中不包含要共享的阶段或操作序列的单元层级。  
4. 选择 **共享(Share)**，将显示**单元间共享阶段和操作序列(Share Phases and Operation Sequences Between Units)**对话框。通过选择单元名称旁边的加号(+)导航至阶段和操作序列。  
5. 选择要与当前单元共享的阶段或操作序列，然后选择**确定(OK)**。  
   所选阶段或操作序列的图标将显示在设计视图区域中。在活动单元和最初定义该阶段或操作序列的单元中，图标左下角都会显示一个小手图标。  