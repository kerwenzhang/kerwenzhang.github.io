---                
layout: post            
title: "FactoryTalk Batch入门4：Batch View"                
date:   2022-6-21 14:30:00                 
categories: "FTBatch"                
catalog: true                
tags:                 
    - FTBatch                
---      

FactoryTalk Batch View 用于启动和控制批次流程，并查看正在运行的批次。它具有图形用户界面，配有易用的窗口和按钮，并且与大多数 FactoryTalk Batch 组件一样，主要基于美国仪表学会（ISA）的 S88.01《批次控制标准》的输入要求设计。
![img](https://github.com/kerwenzhang/kerwenzhang.github.io/blob/master/_posts/image/Batch/view1.png?raw=true)  


# 将 FactoryTalk Batch View 客户端连接到服务器
1. 在客户端设备上打开浏览器。
2. 输入 FactoryTalk Batch View 服务器的 URL，示例如下：

        https://192.168.0.10（IP 地址 + 默认端口 3443）
        https://192.168.0.10:4431（IP 地址 + 非默认端口）
        https://Win2019DC-ABC.domain1234.com（完整域名 + 默认端口）

3. 在 FactoryTalk Batch View 登录页面输入用户名和密码，点击登录（Log On）。

提示：默认端口为 3443。若 Batch View 服务安装在其他端口，需在服务器端启动客户端并从 URL 中查看实际端口号（默认端口 3443 在 URL 中不显示端口号）。

# Prompts 提示功能
使用 “提示（Prompts）” 可提醒操作员处理参数值请求、单元绑定、物料绑定、签名或手动指令。在操作员提供所需信息前，控制配方无法完成执行。大多数情况下，未决的信息请求（值提示、签名或手动指令）需用户提供信息或停止 / 中止控制配方后才会被确认。

+ 值提示：提醒操作员处理参数值请求、单元绑定及物料阶段 / 容器绑定。
+ 签名：要求用户进行签核，需用户权限及可选注释。针对控制配方生成签名时，需完成相关签核以确认签名，签名中请求的用户信息由区域模型中定义的签名模板决定。
+ 指令：手动执行阶段的单个步骤。批次执行时，每个激活步骤的指令会按主配方中指定的顺序显示。


## 确认提示 Acknowledge a prompt
当系统发出参数值请求时，提示会向操作员发出警报。确认提示可完成控制配方的执行。  
确认提示的步骤  
1. 选择 提示（Prompts）。
2. 选择需要确认的提示。
3. 输入值并选择 确认（Acknowledge）。
4. 若提示关联签名，需对提示进行签核以完成确认。
## 指令 Instructions
指令代表用户可采取行动响应的阶段单个步骤，包括：

+ 处理说明
+ 配方参数值及值输入
+ 有效 HTML 组件
+ 运行时数据
+ 批次 ID、配方及指令所属阶段

指令按类型标识状态：当前指令显示为启用，已完成和未执行的指令显示为禁用。
### 执行指令
指令作为激活配方步骤的一部分执行，代表阶段的单个步骤。执行批次（batch)时，会显示每个激活步骤的当前手动指令，并按主配方中指定的顺序执行。
若存在多个激活配方步骤，将显示所有步骤的指令。
#### 定位并执行指令的步骤
1. 选择 提示（Prompts）。
2. （可选）使用筛选栏筛选并仅显示要执行的指令。
3. 定位并选择要执行的指令。
4. 按指令中的说明操作。
### 为指令签名
使用以下步骤为指令签名：

1. 选择 提示（Prompts）。
2. 选择目标指令。
3. 选择签名请求。
4. 为每个必需签核输入有效用户 ID 和密码。
5. 如有需要，输入注释。
6. 选择 签名（Sign），签名将显示在指令后方。
### 取消指令签名请求

取消签名请求步骤
1. 选择 提示（Prompts）。
2. 选择目标指令。
3. 选择签名请求。
4. 选择 取消（Cancel）。
5. 选择 是（Yes） 确认取消签名请求。
### 重新激活指令
在当前处于RUNNING（运行中） 且没有pending / 已激活步骤的阶段中，可重新激活已完成的指令。每次仅能重新激活一条指令。

前提条件  
+ 若 “已完成指令” 未显示在提示列表中，点击筛选栏右侧的框，取消勾选 隐藏已完成（Hide Past）。
+ 确保拥有重新激活步骤的属性安全权限。  

重新激活指令步骤  
1. 选择一条有效的已完成指令，点击 重新激活（Reactivate）。
2. 修改任何错误值。
3. 若显示签名请求，输入所需的用户 ID 和密码（如有需要可添加注释），然后选择 签名（Sign）。
4. 选择 确定（OK）。
## 签名功能Signatures
签名用于通过配置签名要求，对 FactoryTalk Batch 运行时流程进行安全控制。这些签名事件将记录在电子批次记录中，包含签名者姓名、签名执行的日期和时间，以及签名关联的含义。

签名类型可包括：

+ 自动 / 手动阶段的报告参数(report parameter)验证
+ 配方参数变更验证
+ 电子程序（eProcedure）步骤验证
+ 批次 / 阶段命令验证
+ 通用用途签名（允许阶段在需要时请求签名）

FactoryTalk Batch 设备编辑器用于配置签名模板，该模板包含签核要求、含义说明、安全权限及注释规则。模板配置完成后，可与命令验证策略关联，从而对特定批次流程实施控制。
### 确认签名
当控制配方要求为批次操作添加签名时，需通过完成签核来确认签名：

1. 选择 提示（Prompts）。
2. 选择对应的签名请求。 若存在多个签核项，需选择相应的签核项。
3. 为每个签核项输入用户名和密码。
4. （可选）输入注释。
5. 选择 签名（Sign）。
### 取消签名请求
取消签名将使控制配方不进行签核，且请求的批次操作不会完成。签名可通过手动或 FactoryTalk Batch 服务器取消。  
提示：取消签名请求适用于所有批次命令和操作，但控制配方中止（ABORT）命令除外，因为该命令会在签名前完成执行。  
取消步骤：  
1. 选择 提示（Prompts）。
2. 选择目标签名请求。
4. 选择 取消（Cancel）。


# 批次操作 Batches
使用 “批次（Batches）” 功能可创建、查看和命令控制配方，监控单个配方的执行过程，并为基于类的配方绑定单元。控制配方创建后将保留在批次列表中，直至被手动移除或 FactoryTalk Batch 服务器通过冷启动重启。系统会以图形方式显示运行中批次及其关联数据。

## 创建控制配方
创建步骤：  
1. 选择 批次（Batches）。
2. 选择 添加（Add + ）。
3. 选择一个主配方。
4. （可选）若配方包含基于物料类的阶段，选择此批次所需的物料，然后点击 下一步（Next）。
5. 输入唯一的批次 ID。  
提示：批次 ID 框允许输入非唯一值，但重复 ID 会导致在 “提示（Prompts）” 中难以关联正确批次。  
6. （可选）执行以下操作：
    + 若需按非 100% 比例运行批次，在 批次比例（Batch Scale） 框中输入百分比。
    + 若需修改批次描述，在 描述（Description） 框中输入新内容。
    + 在 单元绑定（Unit Bindings） 区域为控制配方选择设备。
    + 若需分配或修改公式值，在 公式值（Formula Values） 中输入新值。
7. 选择 确定（OK），将控制配方添加到批次列表。  
## 控制批次操作
Batch支持以下命令：  

+ 中止（Abort）
+ 启动（Start）
+ 停止（Stop）
+ 移除（Remove）
+ 重启（Restart）
+ 保持（Hold）
+ 恢复（Resume）

可从 “批次列表”“详情” 或 “摘要” 部分发出控制配方命令。系统将根据批次当前状态启用有效命令按钮。在 “O-AUTO” 模式下，“详情” 和 “摘要” 部分的命令按钮将影响所选步骤。  

若在 FactoryTalk Batch 设备编辑器中配置了命令策略，FactoryTalk Batch 服务器将在签名完成后执行命令（中止命令除外，该命令会在签名完成前立即执行）。  

执行批次命令步骤：  
1. 选择 批次（Batches）。
2. （可选）若需在执行命令前查看控制配方详情，先选择目标批次。
3. 选择要执行的命令。  


## 清除失败消息
当批次命令执行失败或因阶段故障、意外执行条件、通信问题等情况，系统会显示失败消息。若需重新运行批次，需先清除失败消息：

在 “批次列表”“详情” 或 “摘要” 部分选择 清除失败（Clear Failures）。

## 更改活动步骤
使用 “批次> 详情” 可更改活动步骤。活动步骤是批次中当前进行的步骤，仅当包含活动步骤的配方层级处于手动模式时，才允许更改活动步骤。  
操作步骤：
1. 选择 批次（Batches）。
2. 选择目标批次 Batch。
3. 在 “批次详情 Batch Detail ” 显示中，选择包含活动步骤的配方层级，然后选择 手动（Manual）。  
    提示：若未显示 “手动” 选项，请确认用户配置文件具备手动控制配方的权限。
4. 选择 更改活动步骤（Change Active Step）。  
    提示：处于保持（HELD） 状态的步骤无法取消激活为活动步骤。
5. 若需取消激活某步骤，选择该步骤，其将显示在 待取消激活步骤（Steps to deactivate） 列表中。  
    提示：待取消激活的步骤应处于终止状态（如 STOPPED、ABORTED、COMPLETED 等）。  
6. 若需激活某步骤，选择该步骤，其将显示在 待激活步骤（Steps to activate） 列表中。  
    提示：仅处于空闲（IDLE） 状态的步骤可被选为活动步骤。  
7. 选择 执行（Execute）。  
8. 确认更改活动步骤，选择 是（Yes）。  
## 监控批次
可通过顺序功能图（详情部分）或表格格式（摘要部分）监控控制配方的执行状态。系统将根据批次当前状态启用相应的命令按钮。  
1. 选择 批次（Batches）。
2. 选择目标批次。
3. 按以下方式监控批次执行：
    + 若需以顺序功能图（SFC） 格式查看步骤和转换，选择 详情（Detail）。
    + 若需以表格格式查看，选择 摘要（Summary）。
4. （可选）若需查看批次描述或设备信息，选择 常规（General）。

详情（Detail） 部分有时会显示配方注释，这些注释包含在配方编辑器中添加的只读说明、指示或信息。配方注释包括：  

+ 注释名称（Comment Name）：由配方编辑器生成的名称，格式为 C#，其中数字按顺序递增，确保每个注释在配方范围内具有唯一名称。
+ 注释内容（Comment）：注释文本。
+ 关联对象（Association，可选）：注释关联的步骤或转换名称。


## 覆盖参数表达式值
当参数表达式的计算出现问题时，操作员可通过分配新值覆盖表达式，并清除覆盖值。

重要提示：强烈建议此命令与命令签名或 FactoryTalk Security 结合使用，以要求在覆盖表达式值前进行授权。
### 强制触发转换
强制转换（Force Transition） 命令可立即触发活动转换。例如，若转换表达式引用报告参数且其值阻止转换触发，可使用此选项强制触发。
操作步骤：
1. 选择 批次（Batches）。
2. 选择正在运行的批次。
3. 在 “批次详情” 显示中，选择活动或待命状态的转换。  
    提示：  
    + 强制转换命令适用于程序、单元程序和操作层级。  
    + 手动模式或转换处于保持（HELD） 状态时不可用。  
4. 选择 强制转换（Force Transition）。
5. （可选）若强制转换需要签名，完成确认或电子签名流程。


### 步骤的有效状态和模式
以下状态和模式对步骤有效，步骤的有效状态包括：

+ READY（就绪）：步骤准备好执行，但尚未激活。
+ IDLE（空闲）：步骤未运行且未被激活，处于初始状态。
+ RUNNING（运行中）：步骤正在执行。
+ RESTARTING（重启中）：步骤正在重新启动，恢复执行。
+ HOLDING（保持中）：步骤正在处理保持请求，尚未完全进入保持状态。
+ HELD（已保持）：步骤暂停执行，等待进一步指令。
+ STOPPING（停止中）：步骤正在处理停止请求，尚未完全停止。
+ STOPPED（已停止）：步骤已停止执行，处于终止状态。
+ ABORTING（中止中）：步骤正在处理中止请求，尚未完全中止。
+ ABORTED（已中止）：步骤已被中止，处于终止状态。
+ COMPLETE（已完成）：步骤正常执行完毕。
+ DOWNLOADING（下载中）：步骤相关数据正在下载。
+ UPLOADING（上传中）：步骤相关数据正在上传。

每个有效步骤可处于以下四种模式之一：

+ O_AUTO（操作员自动）：批次按正常顺序执行。命令可发送至 O_AUTO 模式的配方层级，该模式适用于所有配方层级。O_AUTO 模式下的配方步骤可由操作员直接命令控制。
+ P_AUTO（程序自动）：批次按正常顺序执行，但无法向 P_AUTO 模式的配方层级发送命令，该模式适用于所有配方层级。P_AUTO 模式下的配方步骤由其所属的上级程序控制。 
+ S_AUTO（半自动）：批次按正常顺序执行，但会在 “真转换（True transition）” 处暂停，等待恢复（RESUME） 命令。RESUME 命令需发送至 S_AUTO 模式的配方层级，该模式适用于所有配方层级。  
+ MANUAL（手动）：批次序列停止执行，命令可发送至下级配方层级的步骤。更改活动步骤（change active step） 命令仅在手动模式的配方层级有效，手动模式不适用于阶段（phase）层级。

## 将批次设置为自动模式  
处于半自动或手动模式的批次必须设置为自动模式才能恢复正常执行。  
1. 选择 **批次（Batches）**。  
2. 选择目标批次，系统将打开“详情”部分。  
   **提示**：若需将整个批次设置为自动模式，需选择最高配方层级（如操作、单元程序或程序）并设置为自动模式。  
3. 选择 **摘要（Summary）** 或 **详情（Detail）**，然后选择要设置为自动模式的项目。  
4. 选择 **自动（Auto）**，模式将更改为自动。  
   **提示**：根据情况，批次可能恢复正常执行。若服务器重启时出现故障/暖启动，程序会切换至手动模式，此时需在切换至自动模式后重启或清除故障（如有）。  


## 将批次设置为半自动模式  
将批次设置为半自动模式可控制特定配方层级的步骤执行，可在批次处于手动或自动模式时进行设置。当批次设为半自动模式时，所有上级步骤将设为手动模式，所有下级步骤设为自动模式。  
1. 选择 **批次（Batches）**。  
2. 选择目标批次，系统将打开“详情”部分。  
3. 选择 **摘要（Summary）** 或 **详情（Detail）**。  
4. 选择要设置为半自动模式的批次层级。  
5. 选择 **半自动（Semi-auto）**。  
6. 若需继续执行，选择要恢复的步骤并点击 **恢复（Resume）**，步骤将切换至**RUNNING（运行中）** 状态。  
7. 对每个下级步骤重复点击 **恢复（Resume）**。  
8. 若需继续正常执行，将批次设为自动模式；或在其他批次层级继续进行半自动处理。  


## 将批次设置为手动模式  
使用手动模式可停止批次的自动序列。手动模式下的批次允许任何下级活动步骤完成，但不会自动切换至下一步骤。  
例如，若需通过更改活动步骤确定要执行的步骤，可将批次设为手动模式。将批次层级设为手动模式时会发生以下两件事：  
- 包含该手动模式批次层级的任何上级配方也将切换至手动模式。  
- 手动模式批次层级包含的任何下级步骤将切换至O-AUTO模式。  

### 设置手动模式步骤：  
1. 选择 **批次（Batches）**。  
2. 选择目标批次，系统将打开“详情”部分。  
3. 选择 **摘要（Summary）** 或 **详情（Detail）**。  
4. 选择包含需要手动命令步骤的批次层级。  
5. 选择 **手动（Manual）**。此时活动步骤将完成，但转换不会触发（即使表达式计算为True），步骤将切换至**COMPLETE（已完成）** 状态。  
6. 若需恢复执行，将批次设为自动模式。  


## 查看顺序功能图  
通过“批次 > 详情”可查看所选批次的顺序功能图（SFC）视图。  
当未选择任何步骤或转换时，可在“参数（Params）”和“报告（Reports）”选项卡查看批次层级的配方和报告参数。选择步骤可查看该步骤的配方和报告参数。  

### 查看批次顺序功能图步骤：  
1. 通过选择步骤或SFC图表上方标题中的导航链接，查看配方和报告参数。点击相关步骤的向下箭头可导航至批次的不同层级。  
   **提示**：显示的SFC图表可调整大小。  
2. 选择转换表达式可查看转换详情。对于活动或待命状态的转换，“详情”部分将分别显示当前值和预期值。  
   **提示**：只要选中转换表达式，值将动态更新。  


## 查看和管理系统元素  
可通过“批次详情 > 仲裁（Arbitration）”查看、获取、释放系统元素并对其重排序。  
若批次尝试获取已被占用的系统元素，转换的执行状态将设为**Acquiring（获取中）**。  
当系统元素被释放时，队列中的下一个系统元素将按“所需对象（Needed By）”列表中的顺序自动获取该元素。  


### 查看仲裁信息  
如需导航至系统元素详情，选择批次并使用“批次详情 > 仲裁”。  
1. 选择 **批次（Batches）**。  
2. 选择包含要查看系统元素的批次。  
3. 在“批次详情”显示中，选择 **仲裁（Arbitration）** 选项卡。  
4. 在“拥有（Owns）”、“被拥有（Owned By）”、“需要（Needs）”或“所需对象（Needed By）”列表中，选择菜单并点击 **查看<系统元素>（View <system element>）**。  


### 获取系统元素  
当系统元素未被占用或当前占用数少于定义的最大占用数时，可获取该元素。仅当前所有者可释放系统元素。  
**提示**：  
- 仅授权用户（作为操作员）可获取系统元素，需在FactoryTalk Batch安全设置中配置。  
- 获取已占用系统元素的请求将入队，当元素释放时，队列中的下一个元素将自动获取。  

#### 从批次详情获取系统元素步骤：  
1. 选择 **批次（Batches）**。  
2. 选择包含要获取系统元素的批次。  
3. 在“批次详情”显示中，选择 **仲裁（Arbitration）** 选项卡。  
4. 在“拥有（Owns）”区域，点击要获取的系统元素旁的菜单，选择 **获取（Acquire）**。  
5. 在授权提示中，选择 **是（Yes）**。  
   - 若系统元素可用，当前操作员将获得所有权。  
   - 若不可用，当前操作员将被添加到“所需对象（Needed By）”列表的队列末尾。  


### 释放系统元素  
获取系统元素后可释放该元素，使其可供其他进程使用。  
**提示**：仅授权用户（作为操作员）可释放系统元素，需在FactoryTalk Batch安全设置中配置。  

#### 释放系统元素步骤：  
1. 选择 **批次（Batches）**。  
2. 选择包含要释放系统元素的批次。  
3. 在“批次详情”显示中，选择 **仲裁（Arbitration）** 选项卡。  
4. 在“拥有（Owns）”区域，点击系统元素旁的菜单，选择 **释放（Release）**。  
5. 在授权提示中，选择 **是（Yes）**。  
*BATCH-GR011G-EN-D - 2025年1月 72页 Rockwell Automation, Inc.*  
*第5章 FactoryTalk Batch View*  


### 重排序所需对象队列  
如需更改等待获取系统元素的优先级顺序，可使用“仲裁 > 所需对象（Needed By）”。  
例如：批次1、批次2、批次3按顺序请求获取单元1，批次1获取后，批次2在队列中排第一，批次3排最后。若流程变更需要批次3在批次2前运行，可重排序单元1的所需对象队列，使批次3成为下一个获取对象。  

#### 从批次详情重排序队列步骤：  
1. 选择 **批次（Batches）**。  
2. 选择包含需要重排序队列的系统元素的批次。  
3. 在“批次详情”显示中，选择 **仲裁（Arbitration）** 选项卡。  
4. 选择目标系统元素。  
5. 在“所需对象（Needed By）”部分，选择要重排序的系统元素。  
6. 点击 **上移（Up）** 或 **下移（Down）** 箭头调整顺序。

# 设备视图  
使用“设备（Equipment）”可从设备视角查看已定义的区域模型，显示内容由FactoryTalk Batch设备编辑器定义。  

设备视图包含三个层级：工艺单元（Process Cell）、单元（Unit）、阶段或操作序列（Phase/Operation Sequence），每个层级包含各资源的运行时数据和其他信息。在阶段层级，可查看阶段特定信息，并独立于配方手动运行阶段或操作序列。  

在设备视图中，可通过以下不同方式查看区域模型层级：  
- **列表视图（默认）**：每项根据窗口大小（移动设备或桌面端）显示不同值，桌面端显示更多字段。  
- **图表视图**：工艺单元、单元、阶段/操作序列以图形元素显示在区域模型中：  
  - 图表视图左上角有**放大、缩小、适应窗口**按钮。  
  - 右上角显示当前查看的设备层级（工艺单元、单元或阶段/操作序列）。  
- **阶段摘要视图**：以列表形式同时查看所有工艺单元中所有单元的阶段或操作序列。  


## 以列表或图表视图查看工艺单元、单元和阶段/操作序列  
查看设备的工艺单元、单元和阶段/操作序列的方法如下：  
1. 选择 **设备（Equipment）**。  
2. 在筛选框右侧选择显示类型：  
   - **列表（List）**：以项目列表形式查看设备层级。  
   - **图表（Diagram）**：以区域模型图形元素形式查看设备层级。  
   - **阶段摘要（Phase Summary）**：以列表形式同时查看所有阶段或操作序列。  


### 工艺单元（Process Cell）  
“工艺单元”区域包含所选区域中的每个工艺单元，可通过两种视图查看：列表视图（默认）和图表视图。  
**提示**：  
- 在区域、工艺单元和单元每个层级，均显示给定状态下的阶段或操作序列数量。  
- 仅当阶段或操作序列作为批次列表中的批次步骤执行时，批次计数才会增加。  
- 设备视图中的批次计数可能与批次列表不同，原因如下：  
  - 设备视图计数显示实际绑定的设备。  
  - 批次列表计数表示设备需求，而非绑定设备。  
  - 例如：若批次列表中有两个运行批次需要同一阶段，同一时间仅一个批次可绑定到该阶段。在设备视图中，单元或工艺单元的批次计数（列表视图）或活动批次计数（图表视图）显示为1，即使批次列表中有两个批次。  

#### 列表视图  
- 工艺单元名称。  
- 阶段状态计数。  
- 阶段失败计数（如有失败）。  
- 提示计数（如有提示）。  
  **提示**：提示计数包括未确认的提示、签名和指令。  
- 批次计数。  
- 批次ID和批次状态。  
- 工艺单元菜单（选择菜单后显示）：  
  - **向下导航（Navigate Down）**：导航至单元层级。  
  - **有失败的阶段（Phases With Failures）**：导航至阶段摘要视图，仅显示该工艺单元中存在失败的阶段。  
  - **有提示的阶段（Phases With Prompts）**：导航至阶段摘要视图，仅显示该工艺单元中存在提示的阶段或操作序列。  
  - **显示批次（Display Batches）**：若工艺单元关联批次，导航至批次列表并仅显示关联批次。  
  - **显示提示（Display Prompts）**：若工艺单元关联提示，导航至提示列表并仅显示关联提示。  

#### 图表视图  
- 工艺单元名称。  
- 单元状态计数：  
  - 活动状态（运行中、已保持、已停止、已中止）计数。  
  - 非活动状态（空闲或已完成）计数。  
- 阶段失败计数（如有失败）。  
- 提示计数（若所选工艺单元关联阶段存在提示）：选择提示计数将打开提示页面，显示该工艺单元关联的提示。  
- 活动批次计数：选择“活动批次”链接将打开批次列表，仅显示该工艺单元关联的批次。  
- 超链接（若已配置）：显示在工艺单元名称附近，选择后打开新窗口。  


### 单元（Unit）  
“单元”区域包含所选工艺单元中的每个单元，可通过两种视图查看：列表视图（默认）和图表视图。  
**提示**：  
- 仅当阶段或操作序列作为批次列表中的批次步骤执行时，活动批次计数才会增加。  
- 设备视图中的批次计数可能与批次列表不同，原因如下：  
  - 设备视图计数显示实际绑定的设备。  
  - 批次列表计数表示设备需求，而非绑定设备。  
  - 例如：若批次列表中有两个运行批次需要同一阶段，同一时间仅一个批次可绑定到该阶段。在设备视图中，单元或工艺单元的批次计数（列表视图）或活动批次计数（图表视图）显示为1，即使批次列表中有两个批次。  

#### 列表视图  
- 单元名称和状态。  
- 阶段状态计数：  
  - 活动状态（运行中、已保持、已停止、已中止）计数。  
  - 非活动状态（空闲或已完成）计数。  
- 阶段失败计数（如有失败）。  
- 提示计数（若所选单元关联阶段存在提示）。  
  **提示**：提示计数包括未确认的提示、签名和指令。  
- 活动批次计数。  
- 批次ID和批次状态。  
- 单元菜单（选择菜单后显示）：  
  - **向下导航（Navigate Down）**：导航至阶段层级。  
  - **向上导航（Navigate Up）**：导航至工艺单元层级。  
  - **有失败的阶段（Phases With Failures）**：导航至阶段摘要视图，仅显示该单元中存在失败的阶段。  
  - **有提示的阶段（Phases With Prompts）**：导航至阶段摘要视图，仅显示该单元中存在提示的阶段或操作序列。  
  - **显示批次（Display Batches）**：若单元关联批次，导航至批次列表并仅显示关联批次。  
  - **显示提示（Display Prompts）**：若单元关联提示，导航至提示列表并仅显示关联提示。  

#### 图表视图  
- 单元名称和状态。  
- 阶段状态计数：  
  - 活动状态（运行中、已保持、已停止、已中止）计数。  
  - 非活动状态（空闲或已完成）计数。  
- 阶段失败计数（如有失败）。  
- 提示计数（若所选单元关联阶段存在提示）：选择提示计数将打开提示页面，显示该单元关联的提示。  
- 活动批次计数：选择“活动批次”链接将打开批次列表，仅显示该单元关联的批次。  
- 单元间流路径。  
- 超链接（若已配置）：显示在单元名称附近，选择后打开新窗口。  


### 阶段（Phase）  
“阶段”区域包含单元中的每个阶段，可通过列表或图表视图查看，支持两种视图：列表视图（默认）和图表视图。  

#### 列表视图  
- 阶段或操作序列名称。  
- 阶段或操作序列状态。  
- 阶段或操作序列子状态名称（暂停中、已暂停）。  
- 所有者。  
- 步骤索引（仅当阶段非空闲时显示）。  
- 模式（仅当阶段或操作序列被获取时显示）。  
- 阶段失败计数（如有失败）：选择阶段将在名称附近显示失败消息。  
- 提示计数（若所选阶段或操作序列存在提示）：选择阶段或操作序列将在列表左侧打开命令菜单，包含“提示”链接，选择后打开提示页面，显示该阶段关联的提示。  
  **提示**：提示计数包括未确认的提示、签名和指令。  
- 批次ID和批次状态：选择批次ID链接将导航至“批次 > 详情”（常规批次）或“批次 > 摘要”（关联手动阶段控制或手动操作序列控制的批次）。  
- 阶段菜单（选择菜单后显示）：  
  - **向上导航（Navigate Up）**：导航至单元层级。  
  - **显示批次（Display Batches）**：导航至“批次 > 详情”（常规批次）或“批次 > 摘要”（关联手动阶段控制或手动操作序列控制的批次）。  
  - **显示提示（Display Prompts）**：导航至提示列表，仅显示该阶段或操作序列关联的提示。  

#### 图表视图  
- 阶段或操作序列名称。  
- 阶段或操作序列状态计数。  
- 活动步骤索引（仅当阶段或操作序列非空闲时显示）。  
- 模式（仅当阶段或操作序列被获取时显示）。  
- 阶段错误（如有）：选择失败图标将在弹出窗口中显示失败文本。  
- 提示计数（若所选阶段存在提示）：选择提示计数将打开提示页面，显示该阶段关联的提示。  
  **提示**：提示计数包括未确认的提示、签名和指令。  
- 批次ID和批次状态（若批次已分配到阶段或操作序列）：选择批次ID将导航至“批次 > 详情”（常规批次）或“批次 > 摘要”（关联手动阶段控制或手动操作序列控制的批次）。  
- 超链接（若已配置）：显示在阶段名称附近，选择后打开新窗口。  


## 手动阶段控制  
使用设备视图可查看阶段特定信息，并独立于配方手动命令阶段，强制执行阶段逻辑。阶段仅在未被占用时可获取，使用手动阶段控制前必须先获取阶段。手动阶段控制适用于在将配方发布到生产环境前进行测试。  

### 手动命令阶段  
手动控制阶段将创建默认批次ID，该ID基于当前占用单元的控制配方；若不存在控制配方，批次ID为默认值BATCH_ID。  

#### 手动命令阶段步骤：  
1. 选择 **设备（Equipment）**。  
2. 导航至阶段并选择要控制的阶段。  
3. 选择 **获取（Acquire）** 图标。  
4. 选择 **启动（Start）** 图标。  
5. 如有提示，确认命令。  
6. 选择 **是（Yes）** 启动阶段。  
7. 提示时输入唯一批次ID并选择 **确定（OK）**。阶段将显示当前步骤索引、活动状态、所有者和模式，依次切换至**RUNNING（运行中）** 状态，执行完所有步骤后切换至**COMPLETED（已完成）** 状态。  
8. 若阶段显示提示：  
   a. 选择 **提示（Prompts）**。  
   b. 在提示列表中选择提示并输入对应值。  
   c. 选择 **确认（Acknowledge）**。  
   **提示**：若存在提示，左侧边栏导航将显示“x 提示”链接，选择后跳转至提示列表，仅显示该阶段的提示。  
9. 阶段完成后，选择 **重置（Reset）** 图标重置阶段。  
10. 选择 **释放（Release）** 图标释放所选阶段。  


### 手动命令基于材料的阶段  
在设备视图中使用手动阶段控制命令基于材料的阶段。  
**警告**：若在设备视图中与材料服务器通信失败，且材料策略选项配置为“切换至手动（Switch to Manual）”，将显示与阶段关联的所有容器，且列表不会按所选材料过滤。在无材料服务器时操作需格外谨慎，根据材料性质，选错容器或阶段对可能导致危险情况。  

#### 手动命令基于材料的阶段步骤：  
1. 选择 **设备（Equipment）**。  
2. 选择启用材料的阶段并点击 **获取（Acquire）**。  
3. 如有提示，确认命令。  
   **提示**：手动阶段控制会话将请求阶段所有权（“OPERATOR”将出现在阶段的“所需对象”列表中），必须由控制配方释放阶段后，操作员才能获取。  
4. 选择 **启动（Start）**。  
5. 如有提示，确认命令。  
6. 若阶段同时配置为材料分配和添加，从**进料类型（Feed Type）** 列表中选择阶段类型。  
   **提示**：若阶段未同时配置为材料分配和添加，则材料阶段的已配置进料类型不可更改。  
7. 从**材料（Material）** 列表中选择使用的材料，点击 **继续（Continue）**。  
8. 输入唯一批次ID。  
9. （可选）若阶段有控制策略，从**控制策略（Control Strategy）** 框中选择策略。  
10. 选择容器并点击 **确定（OK）**，批次状态显示为**DOWNLOADING（下载中）**。  
    **提示**：若阶段有自动上传和下载，提示列表将显示需要确认的提示。  
11. 若阶段生成提示，选择 **提示（Prompts）**。  
    **提示**：若存在提示，左侧边栏导航将显示“x 提示”链接，选择后跳转至提示列表，仅显示该阶段的提示。  
12. 在提示列表中选择提示，输入对应值并点击 **确认（Acknowledge）**。  
13. 阶段完成后，选择阶段并点击 **重置（Reset）**。  
14. 保持阶段选中状态，点击 **释放（Release）**。  


### 手动命令阶段控制策略  
在设备视图中使用手动阶段控制命令带控制策略的阶段，控制策略用于标识阶段类配置的运行时使用的阶段类报告和参数子集。  

#### 手动命令阶段控制策略步骤：  
1. 选择 **设备（Equipment）**。  
2. 导航至阶段并选择目标阶段。  
3. 选择 **获取（Acquire）**。  
4. 如有提示，确认命令。  
   **提示**：手动阶段控制会话将请求阶段所有权（“OPERATOR”将出现在阶段的“所需对象”列表中），必须由控制配方释放阶段后，操作员才能获取。  
5. 选择 **启动（Start）**。  
6. 如有提示，确认命令。  
7. 提示时输入唯一批次ID。  
8. 从**控制策略（Control Strategy）** 框中选择策略，点击 **确定（OK）**。  
   **重要提示**：若在FactoryTalk Batch设备编辑器中为阶段实例配置控制策略时选中“启动时自动下载参数（Automatically Download Parameters Upon Start）”，FactoryTalk Batch服务器将在向阶段发送START命令前下载这些参数。验证下载完成后，服务器启动阶段，批次状态显示为DOWNLOADING直至参数下载并在提示中确认。  
9. 若阶段生成提示，选择 **提示（Prompts）**。  
    **提示**：若存在提示，左侧边栏导航将显示“x 提示”链接，选择后跳转至提示列表，仅显示该阶段的提示。  
10. 在提示列表中选择提示，输入对应值并点击 **确认（Acknowledge）**。  
11. 阶段完成后，选择阶段并点击 **重置（Reset）**。  
12. 保持阶段选中状态，点击 **释放（Release）**。  


### 以半自动模式手动命令阶段  
使用SEMI-AUTO模式手动逐步执行阶段，阶段逻辑必须在适当位置设置暂停位（Paused bit），这些编程断点决定了半自动处理时阶段的暂停位置。  

#### 半自动模式手动命令阶段步骤：  
1. 选择 **设备（Equipment）**。  
2. 导航至阶段并选择目标阶段。  
3. 选择 **获取（Acquire）**。  
4. 选择 **启动（Start）**。  
5. 如有提示，确认命令。  
6. 选择 **是（Yes）** 启动阶段。  
7. 提示时输入唯一批次ID并点击 **确定（OK）**，阶段显示当前步骤索引、活动状态、所有者和模式，依次切换至**RUNNING（运行中）** 状态，执行完所有步骤后切换至**COMPLETED（已完成）** 状态。  
8. 选择 **半自动（Semi-Auto）** 启动阶段处理。  
9. 若阶段生成提示：  
   a. 选择 **提示（Prompts）**。  
   b. 在提示列表中选择提示并输入值。  
   c. 选择 **确认（Acknowledge）**。  
   **提示**：若存在提示，左侧边栏导航将显示“x 提示”链接，选择后跳转至提示列表，仅显示该阶段的提示。  
10. 选择 **恢复（Resume）** 重新启动阶段执行。  
11. 选择 **自动（Auto）** 将阶段返回AUTO模式。  
12. 阶段完成后，选择 **重置（Reset）** 重置阶段。  
13. 选择 **释放（Release）** 释放所选阶段。  


## 超链接  
设备视图为每个显示的工艺单元、单元和阶段包含最多五个超链接，在图表视图中，超链接显示在设备图标附近。  
使用FactoryTalk Batch View的设备视图超链接功能时，需要将文件位置更改为指向适当的FactoryTalk Batch View目录。  
**提示**：超链接描述符和默认值在FactoryTalk Batch设备编辑器中定义，更多信息请参阅《FactoryTalk Batch设备编辑器用户指南》。  

### 在FactoryTalk Batch View目录中创建超链接文件夹  
1. 在文件资源管理器中导航至FactoryTalk Batch View Web根目录，若按默认位置安装，路径为：  
   `C:\Program Files (x86)\Rockwell Software\Batch View Server\Bin\wwwroot`  
2. 创建新文件夹并命名（如“Project_Files”）。  
3. 将需要链接的文件放入该文件夹。  
4. 在FactoryTalk Batch设备编辑器中，确保为超链接配置的路径与步骤2设置的目录路径匹配（如“/Project_Files/<文件名>”）。  
5. 若为超链接文件使用多个文件夹（如图像或视频），重复步骤2-4。  


## 查看区域模型更新结果  
当FactoryTalk Batch服务器更新在线区域模型时，FactoryTalk Batch View将显示更改并向操作员发出更新警报：  
- 在线区域模型更新期间，FactoryTalk Batch View服务器将断开除与Batch服务器必要连接外的所有连接，操作员无法与系统交互，可能看到**服务器通信错误：在线区域更新（Server Communication Error: Online Area Update）** 消息。  
- 在线区域模型更新完成后，将显示信息消息，提醒操作员在线区域模型已更新。  

当FactoryTalk Batch服务器与Batch View之间的通信丢失后恢复时，Batch View中的工作基本不受影响，但操作员将被导航到用户界面的顶层位置，例如：  
|  更新前操作员查看位置               |  更新后操作员将查看位置               |  
|-------------------------------------|--------------------------------------|  
| 批次详情显示                        | 批次列表                             |  
| 提示/确认签名签核页面               | 提示列表                             |  
| 手动指令页面                        | 提示列表                             |  
| 诊断选项卡（选中服务器、统计、日志或仲裁） | 诊断选项卡（选中状态）               |  
| 设备视图中的工艺单元、单元或阶段/操作序列详情层级 | 区域顶层层级                  |  
| 特定主题的帮助                      | 帮助顶层页面                         |


# 诊断功能  
使用“诊断（Diagnostics）”可查看服务器和服务状态、服务器性能、服务器统计信息、批次事件日志及仲裁信息：  
- **状态（Status）**：查看FactoryTalk Batch View、FactoryTalk Batch服务器、FactoryTalk服务、电子程序（eProcedure）服务器和FactoryTalk激活的版本及连接信息，显示已配置数据服务器和服务的状态。  
- **服务器（Server）**：查看服务器性能、硬件和软件信息。  
- **统计信息（Statistics）**：查看连接信息、设备模型文件名和保存时间，并执行标签验证。  
- **日志（Journals）**：查看所有可用事件日志的列表。  
- **仲裁（Arbitration）**：查看、获取、释放系统元素并对其重排序。  


## 查看服务器信息  
查看FactoryTalk Batch服务器的性能、硬件和软件信息以排查服务器问题。  

### 查看服务器信息步骤：  
1. 选择 **诊断（Diagnostics）**。  
2. 选择 **服务器（Server）**。  
3. 查看相应的服务器信息：  
   - **正常运行时间（Uptime）**：查看操作系统、FactoryTalk Batch服务器和FactoryTalk Batch View服务的运行时间。  
   - **内存（Memory）**：查看已用内存总量、可用空闲内存量及FactoryTalk Batch View服务使用的内存量。  
   - **磁盘（Disk）**：查看磁盘空间总量和可用空闲磁盘空间量。  


## 查看服务器和服务状态  
“状态”选项卡显示应用程序使用的服务状态和版本信息，以及Batch服务器使用的每个数据服务器的状态。  

### 查看服务器和服务状态步骤：  
1. 选择 **诊断（Diagnostics）**。  
2. 选择 **状态（Status）**。  
3. 查看相应的服务器或服务：  
   - **服务（Services）**：查看FactoryTalk Batch View服务、FactoryTalk Batch服务器、eProcedure服务器、FactoryTalk服务和FactoryTalk激活的状态。  
   - **数据服务器（Data Servers）**：查看已配置数据服务器的状态及材料服务器的状态。  
   **提示**：每个服务和数据服务器的状态由颜色标识：  
   ▪ **绿色**：通信正常。  
   ▪ **黄色**：通信可疑。  
   ▪ **橙色**：通信不良。  
   ▪ **红色**：通信丢失。  


## 查看统计信息  
“统计信息”选项卡显示以下信息：  
- **连接（Connection(s)）**：监控FactoryTalk Batch服务器与客户端软件（如FactoryTalk Batch View服务、FactoryTalk Batch View和HMI控件）之间的组件对象模型（COM）和过程控制对象链接与嵌入（OPC）会话数量。  
- **设备模型（Equipment Model）**：显示文件名和上次保存时间。  
- **标签验证（Tag Verification）**：读取区域模型中定义的标签当前值，并显示已验证标签数、错误标签数和未验证标签数。  


### 查看连接  
“连接”区域监控FactoryTalk Batch服务器与客户端软件（如FactoryTalk Batch View服务、FactoryTalk Batch View和HMI控件）之间的COM和OPC会话数量，查看连接有助于排查与FactoryTalk Batch服务器的连接问题。  

#### 查看连接步骤：  
1. 选择 **诊断（Diagnostics）**。  
2. 选择 **统计信息（Statistics）**。  
3. 在“连接”区域查看项目计数、OPC连接数和COM连接数。  


### 查看设备模型信息  
查看正在使用的设备模型的文件名和时间戳。  

#### 查看设备模型信息步骤：  
1. 选择 **诊断（Diagnostics）**。  
2. 选择 **统计信息（Statistics）**。  
3. 查看设备模型信息：  
   - **文件（File）**：设备模型的文件名。  
   - **上次保存时间（Last Save Time）**：设备模型的上次保存时间。  


### 验证标签  
标签验证显示已验证标签数、错误标签数和未验证标签数。验证过程中会显示已验证、错误和未验证的标签计数，完成后显示已验证和错误标签的计数。  

#### 验证标签步骤：  
1. 选择 **诊断（Diagnostics）**。  
2. 选择 **统计信息（Statistics）**。  
3. 选择 **启动（Start）**。  
   **提示**：若需中止标签验证，选择 **中止（Abort）** 而非“启动”。  


## 管理诊断页面系统元素  
当需要全面查看或管理某个区域的系统元素时，使用“诊断 > 仲裁（Diagnostics > Arbitration）”。“诊断 > 仲裁”提供了从不同角度显示仲裁信息的方法。  
系统元素的所有者数量基于其在区域模型中的定义，当系统元素未被占用或当前所有者数量少于定义的最大数量时可被获取，仅当前所有者可释放系统元素。  


### 查看仲裁信息  
如需导航至系统元素详情，使用“诊断 > 仲裁”。  

#### 查看仲裁信息步骤：  
1. 选择 **诊断（Diagnostics）**。  
2. 选择 **仲裁（Arbitration）**。  
3. 在“选择系统元素（Choose a System Element）”中选择类型以筛选可用选项。  
4. 在“系统元素列表（System Element list）”中选择要查看的系统元素。  


### 获取系统元素  
当系统元素未被占用或当前所有者数量少于定义的最大数量时，可获取该元素。  
**提示**：  
- 仅授权用户（作为操作员）可获取系统元素，需在FactoryTalk Batch安全设置中配置。  
- 获取已占用系统元素的请求将入队，当元素释放时，队列中的下一个元素将自动获取。  

#### 获取系统元素步骤：  
1. 选择 **诊断（Diagnostics）**。  
2. 选择 **仲裁（Arbitration）**。  
3. 在“选择系统元素”中选择类型以筛选可用选项。  
4. 在“系统元素列表”中选择要获取的系统元素。  
5. 在菜单中选择 **获取（Acquire）**。  
   - 若系统元素可用，当前操作员将获得所有权。  
   - 若不可用，当前操作员将被添加到“所需对象（Needed By）”列表的队列末尾，系统元素将添加到操作员的“需要（Needs）”列表中。  


### 释放系统元素  
仅系统元素的当前所有者可释放它。完成对系统元素的命令后，释放元素以便其他进程使用。  
**提示**：仅授权用户（作为操作员）可释放系统元素，需在FactoryTalk Batch安全设置中配置。  

#### 释放系统元素步骤：  
1. 选择 **诊断（Diagnostics）**。  
2. 选择 **仲裁（Arbitration）**。  
3. 在“选择系统元素”中选择类型以筛选可用选项。  
*BATCH-GR011G-EN-D - 2025年1月 84页 Rockwell Automation, Inc.*  
*第5章 FactoryTalk Batch View*  
4. 在“系统元素列表”中选择要释放的系统元素。  
5. 在菜单中选择 **释放（Release）**。  


### 重排序所需对象队列  
如需更改等待获取系统元素的优先级顺序，使用“仲裁 > 所需对象（Arbitration > Needed By）”。  
例如：批次1、批次2、批次3按顺序请求获取单元1，批次1获取后，批次2在队列中排第一，批次3排最后。若流程变更需要批次3在批次2前运行，可重排序单元1的所需对象队列，使批次3成为下一个获取对象。  

#### 重排序所需对象队列步骤：  
1. 选择 **诊断（Diagnostics）**。  
2. 选择 **仲裁（Arbitration）**。  
3. 在“选择系统元素”中选择系统元素类型以筛选可用选项。  
4. 在“系统元素列表”中选择需要重排序队列的系统元素。  
5. 在“所需对象（Needed By）”部分选择要重排序的系统元素。  
6. 点击 **上移（Up）** 或 **下移（Down）** 箭头调整顺序。  


## 材料服务器通信  
当与材料服务器通信丢失时，命令启用材料的阶段会显示“未使用材料服务器（Material Server Not in Use）”警告。根据FactoryTalk Batch服务器在材料服务器通信丢失时的材料策略配置，重新建立与材料服务器的通信：  
- 若FactoryTalk Batch服务器选项中将通信丢失的材料策略配置为“失败并保持（Failure and Hold）”，服务器将在可用时自动恢复与材料服务器的通信，“诊断 > 状态”中的材料服务器状态指示器变为“良好”或绿色，已保持的批次继续运行。  
- 若配置为“切换至手动（Switch to Manual）”，请在材料服务器可用时重新建立通信。当材料状态指示器变为“可疑”或黄色时，尝试重新连接材料服务器。  
**提示**：每个服务和数据服务器的状态由颜色标识：  
- 绿色：通信正常。  
- 黄色：通信可疑。  
- 橙色：通信不良。  
- 红色：通信丢失。  

操作员在无材料服务器通信时做出的所有基于材料的决策或选择，将在“诊断 > 日志”中记录为“材料服务器丢失（Loss of Material Server）”和“材料跟踪丢失（Loss of Material Tracking）”事件。当材料数据库可用时，需手动将事件日志与材料日志对账，并使用材料库存的数量、批次和标签信息更新材料数据库，更多信息请参阅《FactoryTalk Batch材料编辑器用户指南》。  
恢复与材料服务器的通信后，所有处于“已保持”状态的基于材料的步骤必须执行至“已完成”状态，才能继续处理。  


### 在手动批次上重新建立与材料服务器的通信  
当材料状态指示器变为“可疑”时，尝试重新连接材料服务器。  
**重要提示**：恢复与材料服务器的通信后，需手动将批次事件日志与材料数据库对账。所有“材料跟踪丢失”和“材料服务器丢失”事件表明材料步骤在无材料服务器通信时执行，使用此信息手动更新材料数据库中材料库存的数量、批次和标签信息，更多信息请参阅《FactoryTalk Batch材料编辑器用户指南》。  
**提示**：每个服务和数据服务器的状态由颜色标识：  
- 绿色：通信正常。  
- 黄色：通信可疑。  
- 橙色：通信不良。  
- 红色：通信丢失。  

#### 手动批次重新建立通信步骤：  
1. 选择 **诊断（Diagnostics）**，然后选择 **状态（Status）**。  
2. 在“数据服务器”区域选择 **重新连接（Reconnect）**。  
   **提示**：当状态变为“可疑”时，“重新连接”将显示在材料服务器状态旁。  


## 日志（Journals）  
“日志”显示特定批次的电子批次记录，该记录包含批次执行或阶段执行期间发生的事件信息，FactoryTalk Batch自动创建电子批次记录。  
可在批次或阶段运行时或处理完成后查看电子批次记录，如需指定电子批次记录中包含的事件类型，使用FactoryTalk Batch设备编辑器的“服务器选项”对话框，更多信息请参阅《FactoryTalk Batch设备编辑器用户指南》。  


### 查看日志  
在电子批次记录中查看批次或阶段执行的事件信息。  

#### 查看日志步骤：  
1. 选择 **诊断（Diagnostics）**。  
2. 选择 **日志（Journals）**。  
3. 选择相应的批次，将显示该批次的事件日志。  
   **提示**：也可通过选择“批次 > 常规（Batches > General）”并选择“<批次创建ID>.evt”文件来访问日志。  


### 排序和筛选日志列  
筛选日志以限制返回的数据，日志列按升序或降序排序（数字和特殊字符优先级最高，其次是字母顺序），默认日志列为“时间（Time）”。若批次在三个不同单元上运行，通过筛选特定单元，仅显示请求单元的数据。  
**重要提示**：若未安装FactoryTalk Batch材料管理器和FactoryTalk Batch电子程序，相关日志列将不显示。  

#### 排序和筛选日志列步骤：  
1. 选择“诊断 > 日志（Diagnostic > Journals）”并选择一个日志。  
2. 如需排序，选择列并点击列箭头。  
3. 如需筛选，在所选列中输入参数。  
   **提示**：若某列未显示，请确认该列已配置为显示。  


## 仲裁（Arbitration）  
当FactoryTalk Batch服务器使用系统元素执行配方时，称为“仲裁”。在FactoryTalk Batch View中，“仲裁”视图允许用户与仲裁过程交互，操作员可查看系统元素状态，并获取、释放这些元素及对获取请求重排序。系统元素包括工艺单元、单元、阶段、操作序列、资源、批次和操作员。  

当系统元素收到获取请求时，FactoryTalk Batch服务器代表该元素发出请求以获取其依赖的系统元素。一旦被请求的系统元素获取了自身依赖的元素，即可被操作员或批次资源用户获取。  
**提示**：仅授权用户（作为操作员）可获取和释放系统元素，需在FactoryTalk Batch安全设置中配置。  

批次可请求获取任何可获取的系统元素（包括工艺单元、单元、阶段、操作序列和资源），但不能请求获取其他批次或操作员。  
操作员可请求获取工艺单元、单元、阶段、操作序列和资源，但不能请求获取批次。  

在FactoryTalk Batch View中，“仲裁”视图可在以下场景使用：  
- 如需全面查看和管理某区域的资源，使用“诊断 > 仲裁（Diagnostics > Arbitration）”。  
- 如需观察单个控制配方的执行，使用“批次 > 批次详情 > 仲裁（Batches > Batch Detail > Arbitration）”。  


### 仲裁中的系统元素  
可仲裁的系统元素包括：  
- **工艺单元（Process cell）**：生产一个或多个批次所需设备的逻辑分组。  
- **单元（Unit）**：由相关设备和阶段组成的集合，可执行一个或多个主要处理活动，操作员可查看单元获取、需要或拥有的设备。  
- **阶段（Phase）**：表示为协调设备资源使用的逻辑实现的处理动作，通常使用Logix Designer中的阶段管理器功能实现为设备阶段程序，并在ControlLogix控制器中执行。  
- **操作序列（Operation sequence）**：协调阶段执行，类似于操作配方，但操作序列在ControlLogix控制器中执行，而操作配方在FactoryTalk Batch服务器中执行。  
- **资源（Resource）**：可配置为依赖另一台设备或其他系统元素。  
- **批次（Batch）**：通过使输入材料按定义的不连续处理动作顺序使用一个或多个设备，从而生产有限数量材料的过程，可请求获取单元、操作序列、阶段和资源的所有权。  
- **操作员（Operator）**：对工厂某区域的设备使用和控制配方做出明智决策，以保持生产过程平稳运行，可请求获取工艺单元、单元、阶段、操作序列和资源的所有权。  


### 仲裁工作原理  
操作员或批次通过获取系统元素来拥有它。当阶段或操作序列系统元素被获取时，可命令其更改状态。在管理同时运行的批次时，使系统元素对其余批次系统不可用通常已足够。当系统元素使用完成后，将其释放。  

系统元素配置有最大用户数，获取系统元素可能使其对其余FactoryTalk Batch系统不可用。  
例如：储罐可通过管道歧管同时为两个单元进料，储罐和单元之间的管道歧管配置为设备资源，最大所有者数为2。若三个单元需要从储罐抽取材料，前两个请求获取管道歧管的单元将获得所有权，第三个单元的请求被拒绝并入队。当其中一个拥有单元释放管道歧管后，第三个单元将获得所有权。  

当系统元素请求获取已达最大所有权的另一系统元素时，请求元素将添加到“所需对象（Needed By）”列表。当前所有者释放系统元素后，“所需对象”列表中的下一个元素自动成为所有者。若“所需对象”列表为空，系统元素可被下一个获取请求使用。  
**提示**：  
- 若系统元素已被占用，尝试获取会增加其请求者数量。  
- 单元、阶段和操作序列只能有一个所有者。  
- 操作员可对系统元素的“所需对象”列表中的系统元素进行重排序。  

如需查看和管理系统元素，使用以下仲裁选项：  
- **拥有（Owns）**：已请求并当前拥有的系统元素列表。  
- **被拥有（Owned By）**：拥有另一系统元素的系统元素列表，单元、阶段和操作序列同一时间只能被一个系统元素拥有，工艺单元和资源有配置的最大所有者数。  
- **需要（Needs）**：等待获取的请求系统元素列表，该元素对另一系统元素存在仲裁依赖。  
- **所需对象（Needed By）**：已请求获取另一系统元素并等待获取的系统元素列表。


# 使用筛选器搜索  
通过筛选器可显示符合筛选条件的提示、签名、控制配方和设备。  

筛选表达式可包含多个AND或OR运算符，以及它们的任意组合。若要缩小搜索范围，可使用运算符；若要创建灵活强大的筛选器，可将运算符组合成表达式。表达式中的逻辑运算符应用顺序如下：  
1. ( )  
2. AND  
3. OR  

当使用多个优先级相同的运算符时，按从左到右的顺序应用。例如，`b:A OR b:B AND b:C OR b:D`的计算顺序为：  
- `b:B AND b:C`（AND优先于OR）= 结果1  
- `b:A OR 结果1`（从左到右遇到的第一个OR）= 结果2  
- `结果2 OR b:D`（从左到右遇到的下一个OR）= 最终结果  

**提示**：  
- 筛选条件之间的空格隐含AND逻辑。例如，`someString someString2`等同于`someString AND someString2`。  
- 搜索`someString`会包含所有搜索字段。例如，该搜索也会返回`recipe:someString`的结果，而`recipe:somestring`仅将结果限制在配方字段。  
- 搜索可包含括号`()`以改变运算顺序。  
- 精确匹配搜索字符串中请勿使用括号。例如：`recipe:"some(st)ring"`  


### 使用筛选器搜索步骤：  
1. 在筛选框中输入关键字和运算符。  
   筛选框将变为橙色，筛选文本显示在筛选器右侧，并显示筛选项数量/总项数。例如，清除筛选图标旁显示`(2/4)`。  

   | 筛选目标         | 使用运算符       | 示例                                                                 |  
   |------------------|------------------|----------------------------------------------------------------------|  
   | 两个或多个关键字 | AND（全大写）    | `vanilla AND speed` 返回包含字符串“vanilla”和“speed”的项目列表。     |  
   | 多个关键字之一   | OR（全大写）     | `vanilla OR speed` 返回包含字符串“vanilla”或“speed”的项目列表。      |  
   | 精确关键字       | ""（引号）       | `"high limit"` 返回包含字符串“high limit”的项目列表，引号表示精确短语的起止，仅当短语与引号内内容完全一致时才返回匹配项。 |  

2. 使用快捷方式辅助筛选列表：  
   - [提示筛选快捷方式](#筛选快捷方式)  
   - [控制配方筛选快捷方式](#控制配方筛选快捷方式)  
   - [监控批次筛选快捷方式](#监控批次筛选快捷方式)  
   - [主配方筛选快捷方式](#主配方筛选快捷方式)  
   - [设备筛选快捷方式](#设备筛选快捷方式)  
   - [日志筛选快捷方式](#日志筛选快捷方式)  
3. （可选）若需清除筛选器并显示所有条目，选择 **清除筛选（Clear Filter）**。  


## 筛选快捷方式  
使用以下快捷方式筛选提示、签名和指令列表。  
筛选框通过包含字母数字字符、完整单词、单词片段或单个字母/数字的文本筛选列表。可使用运算符和筛选器实现精确筛选，例如：`description:premium AND recipe:vanilla`。  

- 按描述筛选：使用 `description:描述文本`、`desc:描述文本` 或 `d:描述文本`。  
- 按配方名称筛选：使用 `recipe:配方名称` 或 `r:配方名称`。  
- 按设备单元筛选：使用 `units:单元名称` 或 `u:单元名称`。  
- 按阶段名称筛选：使用 `phases:阶段名称` 或 `p:阶段名称`。  
- 按工艺单元筛选：使用 `processcells:工艺单元名称` 或 `pc:工艺单元名称`。  
- 按签名类型筛选：  
  - 所有签名：`type:e` 或 `t:e`。  
  - 所有提示（不含签名）：`type:o` 或 `t:o`。  
  - 所有指令提示：`type:m` 或 `t:m`。  
  - 按指令提示状态筛选：点击筛选栏右侧的框并选择状态。  
- 按批次ID筛选：使用 `batchid:批次名称` 或 `b:批次名称`。  
- 按创建ID筛选：使用 `createid:创建ID` 或 `c:创建ID`。  


## 控制配方筛选快捷方式  
使用以下快捷方式筛选控制配方列表。  
筛选框通过包含字母数字字符、完整单词、单词片段或单个字母/数字的文本筛选列表。可使用运算符和筛选器实现精确筛选，例如：`description:premium AND recipe:vanilla`。  

- 按描述筛选：使用 `description:描述文本`、`desc:描述文本` 或 `d:描述文本`。  
- 按配方名称筛选：使用 `recipe:配方名称` 或 `r:配方名称`。  
- 按批次ID筛选：使用 `batchid:批次名称` 或 `b:批次名称`。  
- 按设备单元筛选：使用 `units:单元名称` 或 `u:单元名称`。  
- 按批次状态筛选：使用 `state:状态名称` 或 `s:状态名称`。  
- 按是否包含失败筛选：  
  - 显示有失败的批次：`failure:yes` 或 `f:yes`。  
  - 显示无失败的批次：`failure:no` 或 `f:no`。  
- 按阶段名称筛选：使用 `phases:阶段名称` 或 `p:阶段名称`。  
- 按工艺单元筛选：使用 `processcells:工艺单元名称` 或 `pc:工艺单元名称`。  
- 按创建ID筛选：使用 `createid:创建ID` 或 `c:创建ID`。  
- 按模式筛选：使用 `m:模式` 或 `mode:O_auto`。  


## 监控批次筛选快捷方式  
在“批次详情”显示中，使用以下快捷方式在“参数（Params）”、“报告（Reports）”和“绑定（Binding）”选项卡中筛选。  
筛选框通过包含字母数字字符、完整单词、单词片段或单个字母/数字的文本筛选参数、报告和绑定列表。可使用运算符和筛选器实现精确筛选，例如：`name:参数名称` 或 `n:参数名称`。  

- 按参数名称筛选：`name:参数名称` 或 `n:参数名称`。  
- 按参数值筛选：`value:参数值` 或 `v:参数值`。  
- 按工程单位筛选参数：`EngUnit:工程单位`、`e:工程单位` 或 `eu:工程单位`。  
- 按报告名称筛选：`name:报告名称` 或 `n:报告名称`。  
- 按报告值筛选：`value:报告值` 或 `v:报告值`。  
- 按工程单位筛选报告：`EngUnit:工程单位`、`eu:工程单位` 或 `eu:工程单位`。  
- 按绑定名称筛选：`name:绑定名称` 或 `n:绑定名称`。  
- 按绑定类型筛选：`type:绑定类型` 或 `t:绑定类型`。  
- 按类或实例筛选绑定：`ClassOrInst:绑定类或实例` 或 `ci:绑定类或实例`。  


## 主配方筛选快捷方式  
筛选框通过包含字母数字字符、完整单词、单词片段或单个字母/数字的文本筛选主配方列表。可使用运算符和筛选器实现精确筛选，例如：`description:premium AND recipe:vanilla`。  

- 按描述筛选：使用 `description:描述文本`、`desc:描述文本` 或 `d:描述文本`。  
- 按配方名称筛选：使用 `recipe:配方名称` 或 `r:配方名称`。  
- 按程序摘要筛选：使用 `abstract:摘要词` 或 `a:摘要词`。  
- 按设备类型筛选：使用 `equipment:设备类型` 或 `e:设备类型`，设备类型包括：class、instance、class/instance。  
- 按配方类型筛选：使用 `recipetype:配方类型名称` 或 `rt:配方类型名称`，配方类型包括：procedure、unit procedure、operation。  
- 按产品代码筛选：使用 `productcode:产品代码` 或 `pc:产品代码`。  


## 设备筛选快捷方式  
使用快捷方式筛选设备阶段列表。  
筛选框通过包含字母数字字符、完整单词、单词片段或单个字母/数字的文本筛选设备列表。可使用运算符和筛选器实现精确筛选，例如：`name:阶段名称 AND failure:no`。  

设备数据是分层的，无论查看哪个层级（工艺单元、单元、阶段），筛选都会应用于所有层级。例如，在工艺层级的筛选框中输入`phases:wp_heat_m2`，将仅显示包含名称为“wp_heat_m2”阶段的工艺单元。  

- 按名称筛选：使用 `name:名称` 或 `n:名称`。  
- 按设备单元筛选：使用 `units:单元名称` 或 `u:单元名称`。  
- 按批次ID筛选：使用 `batchid:批次名称` 或 `b:批次名称`。  
- 按阶段状态筛选：使用 `state:状态名称` 或 `s:状态名称`。  
- 按是否包含失败筛选：  
  - 显示有失败的阶段：`failure:yes` 或 `f:yes`。  
  - 显示无失败的阶段：`failure:no` 或 `f:no`。  
- 按模式筛选：使用 `mode:模式名称` 或 `m:模式名称`。  
- 按所有者筛选：使用 `owner:所有者名称` 或 `o:所有者名称`。  
- 按工艺单元筛选：使用 `processcells:工艺单元名称` 或 `pc:工艺单元名称`。  
- 按阶段名称筛选：使用 `phases:阶段名称` 或 `p:阶段名称`。  
- 按是否包含提示筛选：  
  - 显示有提示的阶段：`prompts:yes` 或 `pr:yes`。  
  - 显示无提示的阶段：`prompts:no` 或 `pr:no`。  
**注意**：状态筛选不支持显式筛选（如`state:"Running"`）。  


## 日志筛选快捷方式  
使用以下快捷方式在“诊断 > 日志（Diagnostics > Journals）”中筛选日志列表。  
筛选框通过包含字母数字字符、完整单词、单词片段或单个字母/数字的文本筛选日志列表。可使用运算符和筛选器实现精确筛选，例如：`description:premium AND recipe:vanilla`。  

- 按描述筛选：使用 `description:描述文本`、`desc:描述文本` 或 `d:描述文本`。  
- 按配方名称筛选：使用 `recipe:配方名称` 或 `r:配方名称`。  
- 按批次ID筛选：使用 `batchid:批次名称` 或 `b:批次名称`。  
- 按时间筛选：使用 `time:时间戳` 或 `t:时间戳`。

# 绑定操作  
绑定是将控制配方中的步骤映射到工厂实际设备的过程，具体包括：  
- **单元绑定**：选择符合配方单元需求标准的单元，使步骤和数据引用在运行时可映射到标签和阶段程序，仅适用于基于类的配方。  
- **材料阶段绑定**：将未绑定的启用材料的阶段步骤绑定到材料阶段及关联容器，或在控制配方中重新绑定已绑定的启用材料的阶段步骤。  


## 单元绑定  
单元绑定是选择符合配方单元需求标准的单元的过程，允许步骤和数据引用在运行时映射到标签和阶段程序，仅适用于基于类的配方。  
**提示**：由于`$Null`和`$Timer`是FactoryTalk Batch服务器在配方任何层级运行的系统程序，因此不需要或显示绑定数据。  

### 单元绑定的层级  
单元绑定可发生在以下层级：  
- **操作配方**：协调阶段执行，约束在一个单元中运行并具有一个单元需求，每个步骤映射到执行配置动作的阶段。  
  - 当操作是顶级程序时，单元绑定可以是基于实例（定义在特定单元中运行）或基于类（使用批次创建绑定方法选择单元）。  
  - 当操作配方在单元程序内时，分配单元程序的绑定单元。例如，单元程序串联运行三个操作配方，每个操作配方必须与单元程序在同一单元中运行，单元程序绑定后，其内部的所有操作也随之绑定。  
- **单元程序配方**：协调操作执行，约束在一个单元中运行并具有一个单元需求，引用操作配方的步骤使用绑定单元将步骤映射到阶段。  
  - 当单元程序是顶级程序时，单元绑定可以是基于实例或基于类。  
  - 当单元程序配方在批处理程序内时，分配批处理程序步骤的绑定单元。  
- **批处理程序配方**：协调单元程序执行，可跨多个单元，每个单元程序步骤引用单元需求。步骤运行前，其单元需求必须绑定到单元。步骤绑定时，其单元程序、单元程序引用的操作配方以及操作配方引用的所有阶段也会绑定，批处理程序步骤内的所有阶段和操作序列映射到可执行配置动作的阶段和操作序列。  

### 批处理程序配方的四种单元绑定方法  
- **First Available（首个可用）**：FactoryTalk Batch服务器尝试获取所有合法绑定候选，绑定首个可用候选并取消其余请求。若无单元绑定候选，批次将因失败而保持。  
  **提示**：失败时，操作员必须清除失败、解决绑定候选问题并重启批次。  
- **Prompt（提示）**：单元程序准备运行时，服务器生成提示，操作员需响应提示并分配绑定单元，所选单元实例将被获取并绑定到单元需求。  
  **提示**：提示中的绑定候选顺序反映已配置的绑定偏好（如有）。  
- **Batch Creation（批次创建）**：创建批次并添加到批次列表时，提示操作员从单元候选列表中选择单元。若无绑定候选，显示错误消息，批次不创建且不添加到列表。  
  **提示**：创建绑定使用绑定表达式时，表达式在批次创建时求值，绑定后表达式值可能变更。为避免此情况，使用Prompt或First Available选项。  
- **Operator Choice（操作员选择）**：创建批次时，操作员选择单元，或选择First Available或Prompt绑定。  


### 理解单元需求  
单元需求在FactoryTalk Batch配方编辑器中配置，包含绑定要求和绑定偏好。  
**提示**：  
- 单元程序配方和操作层级配方在一个单元中运行并具有一个单元需求，批处理程序配方可具有多个单元需求。  
- 批处理程序配方中可编辑单元需求名称，单元程序配方和操作配方中，单元需求以`Alias_<类名>`单元类命名，不可编辑。  
- 批处理程序步骤未绑定时，批次详情显示单元需求名称；绑定时显示绑定单元名称。  
- 若单元需求基于实例，按定义已绑定并显示绑定单元名称。  


### 创建单元绑定与错误  
创建绑定是批次从配方创建时将单元绑定到单元需求的方法。绑定方法配置为创建绑定的每个单元需求，在批次添加到批次列表前提示操作员选择绑定单元。仅通过所有配置绑定要求的单元类成员为绑定候选，此外：  
- 初始绑定候选列表包含所有单元实例。  
- 列表按绑定要求筛选。  
- 列表按流路径求值筛选。  
- 列表按绑定偏好排序。  

绑定偏好提供对候选列表排序的方式，将最偏好的候选显示在顶部，最不偏好的显示在底部。此外：  
- 单元不满足绑定偏好时仍可选择。  
- 未满足绑定偏好不排除单元，未满足绑定要求则排除单元。  

当服务器无法找到满足配方单元需求的单元时发生创建绑定错误，绑定候选列表为空，服务器返回四类错误数据：  
- 错误消息：`No legal bind targets found for unit requirement: <单元需求名称>`。  
- 单元实例被拒绝的原因：对未绑定单元需求引用的单元类的每个单元实例，错误消息显示单元名称及其非合法绑定候选的原因。  
- 应用的绑定要求标识：对单元需求的每个绑定要求，显示绑定规则的配置。  
- 作为表达式的绑定要求标识：对每个作为表达式的绑定规则，显示应用于每个单元实例的表达式及其术语，以及表达式的布尔求值结果。  


### 查看单元需求  
单元需求在配方编辑器中配置，包含绑定要求和偏好，可在批次执行期间查看：  
1. 选择 **批次（Batches）**。  
2. 选择包含要查看单元需求的批次。  
3. 在批次详情显示中，选择顶级配方或程序，或单元程序步骤。  
4. 选择 **绑定（Binding）** 选项卡，显示单元需求摘要信息。  
   **提示**：若需在列表中查找单元需求，选择筛选字段并输入单元信息，可按名称、类型和类/实例筛选。  


### 查看单元绑定要求  
绑定要求是单元需求的可选部分，指定逻辑表达式（求值为真或假）或指令（基于配置包含或排除单元），单元需求可包含任意数量的绑定要求。  
配方执行期间尝试绑定单元需求时，针对每个潜在绑定候选计算单元需求上定义的所有绑定要求，无法满足所有绑定要求的单元将被排除。绑定要求表达式（在配方编辑器中定义）求值为真或假（例如，`"TEMPERATURE < 20.3"`）。  

#### 查看步骤：  
1. 选择 **批次（Batches）**。  
2. 选择包含要查看单元需求的批次。  
3. 在批次详情显示中，执行以下操作之一：  
   - 对单元程序或操作批次，选择背景。  
   - 对批处理程序，选择步骤查看该步骤的单元需求，或选择程序查看与批处理程序关联的所有单元需求。  
4. 选择 **绑定** 选项卡，显示单元需求摘要信息。  
5. 选择单元需求。  
6. 在“单元需求详情”中查看绑定要求信息，包括类型和描述。  
   **提示**：若绑定要求类型为表达式，选择要求以显示实时动态值。  
7. 完成后选择 **关闭（Close）**。  


### 查看单元绑定偏好  
绑定偏好是单元需求的可选部分，指定算术表达式（求值为数字）、最小化或最大化参数或属性，或指令（基于配置偏好或避免单元），单元需求可包含任意数量的绑定偏好，可指定偏好或避免的阶段、操作序列、单元属性、表达式或最小化/最大化表达式。  

#### 查看步骤：  
1. 选择 **批次（Batches）**。  
2. 选择包含要查看绑定偏好的批次。  
3. 在批次详情显示中，执行以下操作之一：  
   - 对单元程序或操作批次，选择程序。  
   - 对批处理程序，选择步骤查看该步骤的单元需求，或选择程序查看所有单元需求。  
4. 选择 **绑定** 选项卡，显示单元需求摘要信息。  
5. 选择单元需求。  
6. 在“单元需求详情”中查看绑定偏好信息，包括类型和描述。  
7. 完成后选择 **关闭（Close）**。  


### 单元绑定的表达式值  
在“绑定要求表达式值”对话框中，显示单元需求的潜在合法绑定候选列表，每个单元需求显示：  
- 单元名称  
- 当前值（真或假），显示绑定候选是否满足所选绑定要求  
- 单元顺序，基于绑定偏好表达式的求值  
- 当前值随表达式输入变更动态更新，关闭并重新打开对话框时可能重新排序单元  
- 表达式值，指示绑定候选是否满足所选绑定要求  

#### 查看步骤：  
1. 选择 **批次（Batches）**。  
2. 选择包含要查看单元需求表达式数据的批次。  
3. 在批次详情显示中，执行以下操作之一：  
   - 对单元程序或操作批次，选择程序。  
   - 对批处理程序，选择步骤或程序。  
4. 选择 **绑定** 选项卡，显示单元需求摘要信息。  
5. 选择单元需求。  
6. 在“单元需求详情”的“绑定要求”下，选择绑定要求或偏好以显示表达式的实时值：  
   - 绑定要求：显示“绑定要求表达式值”对话框。  
   - 绑定偏好：显示“绑定偏好表达式值”对话框。  
7. 查看表达式数据。  
8. 完成后依次选择 **关闭（Close）**。  


### 手动绑定单元  
在批处理程序控制配方中，操作员可手动将单元绑定到单元程序步骤引用的单元需求，也可手动取消绑定先前绑定的单元需求并重新绑定到不同单元，还可将单元程序步骤重新分配为Prompt绑定或First Available绑定。  

#### 前提条件：  
- 所选步骤的单元需求基于类。  
- 步骤非活动，或步骤前的转换具有“BINDING”绑定状态。  

#### 操作步骤：  
1. 选择 **批次（Batches）**。  
2. 选择包含要绑定的单元程序步骤的程序级控制配方。  
3. 在批次详情显示中，选择单元程序步骤。  
4. 选择 **绑定（Bind）**。  
5. 在“选择要绑定单元需求的单元”列表中，选择适当的绑定选项并点击 **确定（OK）**。  


### 设置提示单元绑定  
提示绑定是生成提示后将单元绑定到单元程序步骤的过程，仅绑定方法定义为“Prompt”的单元需求生成提示。  
配置提示绑定时，当未绑定步骤上方的转换为真时，批次执行暂停。  

#### 操作步骤：  
1. 选择 **批次（Batches）**。  
2. 选择批次。  
3. 在批次详情显示中，选择单元程序步骤。  
4. 选择 **绑定（Bind）**。  
5. 在“选择要绑定单元步骤的单元”中选择 **Prompt**。  
6. 选择 **确定（OK）**。  


### 响应单元绑定提示  
操作员为单元程序步骤设置提示绑定时显示单元绑定提示，配方运行时响应提示以选择绑定到单元程序步骤的单元。  

#### 操作步骤：  
1. 选择 **批次（Batches）**。  
2. 选择批次。  
3. 在批次详情显示中，选择 **启动（Start）** 执行配方，显示提示警报。  
4. 选择 **提示（Prompts）** 并选择正在运行的配方的单元绑定提示。  
5. 从列表中选择单元。  
6. 选择 **确认（Acknowledge）**。  


## 材料阶段绑定  
材料阶段绑定是以下过程之一：  
- 将未绑定的启用材料的阶段步骤绑定到材料阶段及关联容器  
- 在控制配方中重新绑定先前绑定的启用材料的阶段步骤  

配置引用材料阶段类的操作配方步骤时，操作员可选择以下三种绑定类型之一：  
- **特定材料阶段和容器**：从列表中选择特定阶段和容器对。  
- **自动（Automatic）**：服务器选择与最高优先级容器关联的设备阶段。  
- **提示（Prompt）**：配方运行时操作员必须选择阶段/容器。  

#### 必须满足的条件：  
- 步骤在配方中与启用材料的阶段类关联。  
- 步骤非活动或状态为“BINDING”。  


### 手动绑定材料阶段实例  
操作配方步骤的已配置材料需求为服务器和材料服务器提供足够信息，以选择阶段实例及其关联材料容器并绑定到批次，从而选择并运行可访问所需成分的正确阶段。  
手动绑定启用材料的阶段步骤要求操作员不仅选择阶段，还需选择阶段关联的容器，并根据材料容器类型选择确切子批（成分的特定测量量）。  

#### 前提条件：  
- 所选阶段步骤启用材料。  
- 步骤设置为Prompt绑定且服务器已发出操作员绑定提示时，步骤非活动或步骤前的转换具有“BINDING”绑定状态。  

#### 操作步骤：  
1. 选择 **批次（Batches）**。  
2. 选择包含需要绑定步骤的批次。  
3. 在操作的批次详情显示中，选择材料阶段步骤。  
4. 选择 **绑定（Bind）**。  
5. 在“绑定材料阶段步骤”中，选择要绑定到材料阶段步骤的阶段/容器对。  
6. 选择 **确定（OK）**。  


### 手动分配材料阶段绑定  
提示材料阶段绑定是生成提示后绑定材料阶段的过程，仅绑定方法定义为“Prompted Binding”的需求生成提示。  
设置提示材料阶段绑定时，当未绑定步骤上方的转换为真时，批次执行暂停。  

#### 操作步骤：  
1. 选择 **批次（Batches）**。  
2. 选择批次。  
3. 在批次详情显示中，选择材料步骤。  
4. 选择 **绑定（Bind）**。  
5. 在“绑定材料阶段步骤”中选择 **Prompt**。  
6. 选择 **确定（OK）**。  


### 响应材料阶段绑定提示  
操作员为材料阶段/容器对设置提示绑定时显示材料阶段绑定提示，配方运行时响应提示以选择材料阶段/容器对。  

#### 操作步骤：  
1. 选择 **批次（Batches）**。  
2. 选择批次。  
3. 在批次详情显示中，选择 **启动（Start）** 执行配方，显示提示警报。  
4. 导航至提示列表并选择正在运行的配方的材料阶段绑定提示。  
5. 从列表中选择材料阶段/容器对。  
6. 选择 **确认（Acknowledge）**。