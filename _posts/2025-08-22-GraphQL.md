---                
layout: post                
title: "GraphQL å­¦ä¹ ç¬”è®°"                
date:   2025-8-22 17:30:00                 
categories: "Web"                
catalog: true                
tags:                 
    - Web                
---      

# GraphQL
GraphQLæ˜¯Facebookå¼€å‘çš„ä¸€ç§æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œå®ƒäº2015å¹´å…¬å¼€å‘å¸ƒã€‚  
GraphQL APIçš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³ä¼ ç»ŸRESTful APIåœ¨æŸäº›åœºæ™¯ä¸‹çš„ä¸€äº›é™åˆ¶å’ŒæŒ‘æˆ˜ã€‚  
ä¸‹é¢æ˜¯ä¸€äº›å¯¼è‡´GraphQL APIå‡ºç°çš„ä¸»è¦åŸå› :  

+ å‡å°‘å¤šæ¬¡è¯·æ±‚ï¼šä¼ ç»Ÿçš„RESTful APIä¸€æ¬¡è¯·æ±‚åªèƒ½è¿”å›ä¸€ä¸ªèµ„æºï¼Œè€ŒGraphQL APIä¸€æ¬¡å¯ä»¥è¿”å›å¤šä¸ªèµ„æºï¼Œå› æ­¤å¯ä»¥å‡å°‘å¤šæ¬¡è¯·æ±‚çš„æ¬¡æ•°ã€‚  
+ é¿å…è¿‡åº¦è·å–å’Œæ¬ è·å–ï¼šä¼ ç»Ÿçš„RESTful APIé€šå¸¸ä»¥é¢„å®šä¹‰çš„æ•°æ®ç»“æ„è¿”å›æ•°æ®ï¼Œå¯¼è‡´å®¢æˆ·ç«¯è¦ä¹ˆè·å–äº†è¿‡å¤šçš„æ•°æ®ï¼Œè¦ä¹ˆè·å–äº†ä¸è¶³çš„æ•°æ®ã€‚GraphQL APIé€šè¿‡è®©å®¢æˆ·ç«¯æŒ‡å®šæ‰€éœ€çš„æ•°æ®ç»“æ„ï¼Œé¿å…äº†è¿™ç§é—®é¢˜ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç²¾ç¡®åœ°è·å–æ‰€éœ€çš„å­—æ®µå’Œå…³è”æ•°æ®ï¼Œé¿å…äº†æ•°æ®çš„æµªè´¹å’Œä¸è¶³ã€‚  

ç”±äºrestful apié¢„å®šä¹‰å¥½äº†æ¯ä¸ªæ¥å£çš„è¿”å›çš„æ•°æ®ï¼Œæ‰€ä»¥å³ä½¿æˆ‘åªæƒ³è¦ç”¨æˆ·çš„nameï¼Œå´è¿˜æ˜¯ä¼šè¿”å›ç”¨æˆ·çš„æ•´ä¸ªå­—æ®µå†…å®¹ç»™æˆ‘ã€‚è€ŒgraphqlæŸ¥è¯¢ï¼Œå¦‚æœæˆ‘åªè¦ç”¨æˆ·çš„nameï¼Œé‚£ä¹ˆå°±åªä¼šè¿”å›nameç»™æˆ‘ï¼Œä¸ä¼šè¿”å›æ•´ä¸ªç”¨æˆ·å­—æ®µç»™åˆ°ç”¨æˆ·ï¼Œé¿å…äº†æ•°æ®çš„è¿‡åº¦è·å–ã€‚    

graphqlæ˜¯ä¸€ç§æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼ŒGraphQLçš„APIé€šå¸¸æ˜¯ä¸€ä¸ªURLå¯¹åº”å¤šç§æŸ¥è¯¢ï¼Œä¸åŒçš„æŸ¥è¯¢æ˜¯é€šè¿‡è¯·æ±‚ä½“æ¥åŒºåˆ†çš„ã€‚

## Hello World
è¿è¡Œ GraphQL API æœåŠ¡å™¨çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ Express  

1. åˆå§‹åŒ–ä¸€ä¸ªproject `npm init -y`
2. å®‰è£…ä¾èµ–

        npm install express graphql-http graphql --save

3. æ­å»ºä¸€ä¸ªexpress server

        var express = require('express');

        var app = express();
        app.use(express.static('public'));

        app.listen(3001, ()=>{
            console.log('Server running on port 3001');
        })


4. æ·»åŠ graphQL

        var { buildSchema } = require('graphql');
        const { createHandler } = require('graphql-http/lib/use/express');

    åœ¨ GraphQL ä¸­ï¼Œschema å®šä¹‰äº†å®¢æˆ·ç«¯å¯ä»¥æŸ¥è¯¢çš„æ•°æ®ç±»å‹ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚ä½¿ç”¨ buildSchema å‡½æ•°å¯ä»¥åˆ›å»º schema å¯¹è±¡ã€‚è¿™ä¸ª schema å¯¹è±¡å¯ä»¥è¢«ä¼ é€’ç»™ GraphQL çš„æ‰§è¡Œå™¨ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ‰§è¡Œæ¥è‡ªå®¢æˆ·ç«¯çš„æŸ¥è¯¢ï¼Œå¹¶è¿”å›æ‰€éœ€çš„æ•°æ®ã€‚

        // Construct a schema, using Graphql schema language. 1
        // The parameter of buildSchema function is a String type. 2
        var schema = buildSchema(`
            type Query {
                hello : String!
            }
        `);

    è¿™æ®µschema å®šä¹‰äº†æ‰€æœ‰å¯èƒ½çš„ç±»å‹å’Œæ“ä½œï¼Œå¹¶ä¸”å……å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å¥‘çº¦ã€‚æ³¨æ„ï¼ŒbuildSchemaæ–¹æ³•çš„å‚æ•°è¿™é‡Œä½¿ç”¨çš„æ˜¯åå¼•å·.
    åœ¨è¿™ä¸ª schema ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±»å‹ï¼š`Query`   
    Queryç±»å‹æ˜¯ GraphQL schema ä¸­çš„é¢„å®šä¹‰ç±»å‹ã€‚å…¶ä¸­å®šä¹‰äº†ä¸€äº›æŸ¥è¯¢æ“ä½œï¼ˆæ–¹æ³•ï¼‰ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨è¿™äº›æ“ä½œä»æœåŠ¡å™¨ä¸­æ£€ç´¢æ•°æ®ã€‚  
    åœ¨Queryç±»å‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå­—æ®µï¼š`hello`ã€‚helloå­—æ®µæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œå®ƒçš„å€¼ä¸º`String!`ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªéç©ºçš„å­—ç¬¦ä¸²ç±»å‹ã€‚  
    åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªåä¸ºhelloçš„å‡½æ•°ï¼Œç”¨äºå¤„ç†æŸ¥è¯¢æ“ä½œã€‚

        //The root provide a resolver function for each API endpoint 1
        var root = {
            hello: () => {
                return 'hello world';
            }
        };

    åœ¨ GraphQL ä¸­ï¼Œroot å¯¹è±¡æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„å®é™…å¯¹è±¡ï¼ˆæ ¹å¯¹è±¡ï¼‰ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰çš„å¤„ç†å‡½æ•°ã€‚hello æ–¹æ³•æ˜¯ç®­å¤´å‡½æ•°çš„è¡¨ç¤ºæ–¹å¼ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸² 'hello world'ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºå¤„ç† hello æŸ¥è¯¢æ“ä½œã€‚åœ¨GraphQL ä¸­ï¼ŒæŸ¥è¯¢æ“ä½œæ˜¯å®¢æˆ·ç«¯ç”¨äºä»æœåŠ¡å™¨æ£€ç´¢æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚

        // Create and use the GraphQL handler.
        app.all(
            '/graphql',
            createHandler({
                schema: schema,
                rootValue: root,
                graphiql: true,
            }),
        );

5. åœ¨publicæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯index.html

        <!DOCTYPE html>
        <html lang="en">

        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Document</title>
        </head>

        <body>
            <button onclick="getdata()">è·å–æ•°æ®</button>
            <div id="result" style="margin-top:20px;"></div>
            <script>
                function getdata() {
                    const query = `query{ hello }`;
                    fetch('http://localhost:3001/graphql', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            query: query
                        })
                    })
                    .then(res => res.json())
                    .then(data => {
                        // Display the result in the page
                        const resultDiv = document.getElementById('result');
                        if (data) {
                            resultDiv.textContent = "è¿”å›æ•°æ®: " + JSON.stringify(data, null, 2);
                        }
                    })
                    .catch(err => {
                        document.getElementById('result').textContent = 'è¯·æ±‚å¤±è´¥: ' + err;
                    });
                }
            </script>
        </body>
        </html>

6. ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œæ­¤ GraphQL æœåŠ¡å™¨ï¼š

        node index.js

    æ­¤æ—¶ï¼Œä½ å°†æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ GraphQL API  
    æ‰“å¼€æµè§ˆå™¨è®¿é—®`http://localhost:3001`ï¼Œç‚¹å‡»æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›`Hello World`æ•°æ®

7. è‡ªå·±å†™ä¸€ä¸ªå®¢æˆ·ç«¯æµ‹è¯•graphqlå¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç°æˆçš„ GraphQL å®¢æˆ·ç«¯æ¥å‘ API å‘å‡º GraphQL æŸ¥è¯¢ã€‚å®˜æ–¹æä¾›çš„æ–¹æ³•æ˜¯ä½¿ç”¨ `ruru` åŒ…ï¼Œè¯¥åŒ…æ†ç»‘äº†é¢„æ„å»ºçš„ GraphiQL å’Œä¸€äº›æµè¡Œçš„å¢å¼ºåŠŸèƒ½ã€‚ ä¸ºæ­¤ï¼Œè¯·å®‰è£…æ¨¡å—

        npm install --save ruru

    ç„¶åå°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åé‡æ–°å¯åŠ¨å‘½ä»¤ï¼šnode index.js


        const { ruruHTML } = require('ruru/server');

        // Serve the GraphiQL IDE.
        app.get('/', (_req, res) => {
            res.type('html');
            res.end(ruruHTML({ endpoint: '/graphql' }));
        });

    å¯¼èˆªåˆ° http://localhost:3001ï¼Œåº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªå…è®¸æ‚¨è¾“å…¥æŸ¥è¯¢çš„ç•Œé¢ã€‚ åœ¨å·¦ä¾§è¾“å…¥

        {
            hello
        }

    ç‚¹å‡»Execute Query, å¯ä»¥çœ‹åˆ°å³ä¾§è¿”å›

        {
            "data": {
                "hello": "hello world"
            }
        }


## æ•°æ®ç±»å‹

+ åŸºæœ¬æ•°æ®ç±»å‹ï¼š `String`, `Int`, `Float`, `Boolean`, `ID`(IDç±»å‹çš„æœ¬è´¨æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä½†æ˜¯å¦‚æœæ˜¯IDç±»å‹å°±è¡¨ç¤ºæ•°æ®ä¸èƒ½é‡å¤ï¼Œä½†æ˜¯GraphQLæœ¬èº«å¹¶æ²¡æœ‰å†…ç½®çš„æœºåˆ¶æ¥å¼ºåˆ¶ç¡®ä¿IDç±»å‹çš„æ•°æ®ä¸é‡å¤ï¼Œéœ€è¦ååŒæ•°æ®åº“å…±åŒæ§åˆ¶)ï¼Œè¿™å‡ ä¸ªç±»å‹éƒ½å¯ä»¥åœ¨schemaå£°æ˜çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ã€‚
+ `[ç±»å‹]`ä»£è¡¨æ•°ç»„ï¼Œä¾‹å¦‚`[Int]`ä»£è¡¨æ•´æ•°æ•°ç»„ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç±»å‹éƒ½æ˜¯å¯ä¸º null çš„ - è¿”å›ä»»ä½•ç±»å‹éƒ½æ˜¯åˆæ³•çš„ã€‚ä½¿ç”¨æ„Ÿå¹å·è¡¨ç¤ºç±»å‹ä¸èƒ½ä¸ºç©ºï¼Œä¸å¯ä¸ºç©ºçš„å­—ç¬¦ä¸²string!

### è‡ªå®šä¹‰æ•°æ®ç±»å‹
GraphQLä¸­é™¤äº†å‡ ç§åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œæœ‰ä¸¤ç§é¢„å®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œä¸€ç§æ˜¯`Query`ï¼Œå¦ä¸€ç§æ˜¯`Mutation`ã€‚
å¦‚æœç”¨æˆ·æƒ³è‡ªå®šä¹‰å…¶å®ƒæ•°æ®ç±»å‹ï¼Œåˆ™å¯ä»¥åœ¨buildSchemaæ–¹æ³•ä¸­é€šè¿‡typeå®šä¹‰å…¶å®ƒç±»å‹ï¼Œä¾‹å¦‚æˆ‘ä»¬æƒ³å®šä¹‰ä¸€ä¸ªUserç±»å‹å’ŒPostï¼ˆåšå®¢ï¼‰ç±»å‹ã€‚

    var schema = buildSchema(`
        type User {
            id: ID!
            name: String!
            posts: [ID!]
        }
        type Post {
            id: ID!
            title: String!
            content: String!
            author: ID!
        }
        type Query {
            hello : String!
            getUser: User!
            getPost: Post!
        }
    `);


    var root = {
        hello: () => {
            return 'hello world';
        },
        getUser() {
            return {
                id: '1',
                name: 'John Doe',
                posts: ['1', '2']
            };
        },
        getPost() {
            return {
                id: '1',
                title: 'Post Title',
                content: 'Post Content',
                author: '1'
            };
        }
    };

åœ¨`getUser`å’Œ`getPost`æ–¹æ³•çš„å…·ä½“å®ç°ä¸­ï¼Œéƒ½éœ€è¦è¿”å›å¯¹åº”çš„è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬çš„è¿”å›å€¼æ˜¯å­—å…¸ç±»å‹ï¼Œå¯ä»¥è¿”å›æ¯”æœŸæœ›çš„æ•°æ®ç±»å‹æ›´å¤šçš„é”®å€¼å¯¹ï¼Œå› ä¸ºgraphQLåªä¼šåŒ¹é…å’ŒæœŸæœ›çš„æ•°æ®ç±»å‹ä¸­ç›¸åŒçš„å­—æ®µã€‚ä½†æ˜¯ä¸èƒ½æ›´å°‘ï¼ˆä¸ä¼šæŠ¥é”™ï¼‰ï¼Œä½†æ˜¯è¿™æ ·åœ¨æŸ¥è¯¢çš„æ—¶å€™å¯¹åº”è¢«é—æ¼çš„å­—æ®µçš„å€¼å°±ä¸ºnulläº†ï¼Œå¦‚æœæ°å¥½è¢«é—æ¼çš„å­—æ®µçš„å€¼ä¸èƒ½ä¸ºnullï¼Œåˆæ°å¥½å»æŸ¥è¯¢äº†è¿™ä¸ªå­—æ®µçš„å€¼ï¼Œé‚£ä¹ˆæŸ¥è¯¢å°±ä¼šæŠ¥é”™ã€‚  
ç”±äº`getUser`æ–¹æ³•å’Œ`getPost`æ–¹æ³•çš„è¿”å›ç±»å‹éƒ½æ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™æˆ‘ä»¬å¿…é¡»ä½¿ç”¨`{}`æ¥æŒ‡å®šæˆ‘ä»¬å¸Œæœ›æœåŠ¡å™¨ç«¯è¿”å›ç»™æˆ‘ä»¬å“ªå‡ ä¸ªå­—æ®µçš„å€¼  

    {
        getUser{
            id
            name
        }
        getPost{
            id
            title
        }
    }

è¿”å›æ•°æ®

    {
        "data": {
            "getUser": {
                "id": "1",
                "name": "John Doe"
            },
            "getPost": {
                "id": "1",
                "title": "Post Title"
            }
        }
    }

## å‚æ•°ä¼ é€’
å’Œjsä¼ é€’å‚æ•°ä¸€æ ·ï¼Œåœ¨å°æ‹¬å·å†…å®šä¹‰è¡Œå‚ï¼Œä½†æ˜¯å‚æ•°éœ€è¦åœ¨schemaä¸­å®šä¹‰ç±»å‹ã€‚  
graphQLè¯·æ±‚å‚æ•°ï¼Œå‚æ•°çš„å€¼å¦‚æœæ˜¯Stringï¼Œå¿…é¡»ä½¿ç”¨åŒå¼•å·ï¼Œä½¿ç”¨å•å¼•å·ä¼šæŠ¥é”™ã€‚  

    type Query {
        getUserById(id:ID!): User!
        getPostById(id: ID!): Post!
    }

    getUserById({id}){
        var User1={id:'001',name:'Alice',posts:['11','12']}
        var User2={id:'002',name:'Mary',posts:['13','14']}
        if(User1.id === id){
            return User1
        } else {
            return User2;
        }
    },
    getPostById({id}){
        var Post1={id:'1',title:'What is API',content:'API is an interface ..', author:'1'}
        var Post2={id:'1',title:'What is GraphQL',content:'GraphQL is an langu...', author:'1'}
        if(Post1.id === id){
            return Post1
        } else {
            return Post2;
        }
    }

å‘å‡ºä»¥ä¸‹è¯·æ±‚ 

    {
        getUserById(id:"001"){
            id
            name
            posts
        }
    }

å¾—åˆ°çš„ç»“æœ

    {
        "data": {
            "getUserById": {
                "id": "001",
                "name": "Alice",
                "posts": [
                    "11",
                    "12"
                ]
            }
        }
    }

## queryå’Œmutation
åœ¨GraphQLä¸­ï¼Œ`Query`å’Œ`Mutation`æ˜¯ä¸¤ç§ç‰¹æ®Šçš„æ ¹æ“ä½œç±»å‹ï¼Œéƒ½æ˜¯é¢„å®šä¹‰å¥½çš„ï¼Œç”¨äºå®šä¹‰å¯æ‰§è¡Œçš„æŸ¥è¯¢å’Œå˜æ›´æ“ä½œã€‚  
Queryç±»å‹ï¼š  
Queryç±»å‹ç”¨äºå®šä¹‰å¯ä»¥æ‰§è¡Œçš„è¯»å–æ“ä½œã€‚å®ƒè¡¨ç¤ºä½ å¯ä»¥ä»æœåŠ¡å™¨è·å–æ•°æ®çš„èƒ½åŠ›ã€‚åœ¨å‰é¢æˆ‘ä»¬ä¸€ç›´æ˜¯æŸ¥è¯¢æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰€æœ‰æŸ¥è¯¢æ“ä½œçš„å®šä¹‰å…¶å®éƒ½å†™åœ¨Query typeä¸‹é¢ã€‚

    type Query {
        getUser(id: ID!): User!
        getPost(id: ID!): Post!
    }

Mutationç±»å‹ï¼š  
Mutationç±»å‹ç”¨äºå®šä¹‰å¯ä»¥æ‰§è¡Œçš„å†™å…¥æˆ–ä¿®æ”¹æ“ä½œã€‚å®ƒè¡¨ç¤ºä½ å¯ä»¥å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ä»¥æ›´æ”¹æ•°æ®çš„èƒ½åŠ›ã€‚é€šå¸¸ï¼ŒMutation`ç±»å‹ä¸­çš„å­—æ®µå¯¹åº”äºå¯ä»¥å¯¹æœåŠ¡å™¨ä¸Šçš„æ•°æ®è¿›è¡Œä¿®æ”¹çš„æ“ä½œã€‚
å‡è®¾ç›®å‰æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€æ¡Accountæ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥å’Œä¹‹å‰ä¸€æ ·ä½¿ç”¨typeè‡ªå®šä¹‰Accountæ•°æ®ç±»å‹ï¼š

    type Account {
        id: ID!
        name: String
        age: Int
        salary(city: String): Int
    }

ä½†æ˜¯<strong>ä½¿ç”¨typeå®šä¹‰å‡ºæ¥çš„æ•°æ®ç±»å‹åªèƒ½ä½œä¸ºæŸ¥è¯¢ç±»å‹ï¼Œå´ä¸èƒ½ä½œä¸ºè¯·æ±‚çš„è¾“å…¥ç±»å‹</strong>ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨`input`å®šä¹‰è¾“å…¥ç±»å‹AccountInputä½œä¸ºè¯·æ±‚çš„è¾“å…¥å‚æ•°ï¼š  

    input AccountInput {
        name: String
        age: Int
        city: String
    }

æ¥ä¸‹æ¥æˆ‘ä»¬å®šä¹‰mutationç±»å‹ä»¥åŠå…¶createAccountæ“ä½œï¼ŒcreateAccountçš„è¾“å…¥å‚æ•°æ˜¯AccountInputç±»å‹ï¼š 

    type Mutation {
        createAccount(input: AccountInput): Account
    }

æ³¨æ„ï¼Œç”±äºå¦‚æœåªæœ‰Mutationç±»å‹è€Œæ²¡æœ‰Queryç±»å‹çš„è¯ï¼ŒgraphQLä¸æ”¯æŒï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ªQueryç±»å‹ï¼š

    type Query {
        getAccount(id: ID!): Account
    }

å®Œæ•´ä»£ç :

    var schema = buildSchema(`
        type Account {
            id: ID!
            name: String
            age: Int
            salary(city: String): Int
        }
        input AccountInput {
            name: String
            age: Int
            city: String
        }
        type Query {
            getAccount(id: ID!): Account
        }
        type Mutation {
            createAccount(input: AccountInput): Account
        }
    `);

    var root = {
        createAccount({ input }) {
            const name = input.name;
            const age = input.age;
            // salary is a field resolver, not a direct value
            return {
                id: "001",
                name,
                age,
                salary: ({ city }) => (city === 'Shenzhen' ? 2000 : 1000)
            };
        },
        getAccount({ id }) {
            let name = '';
            let age = null;
            if (id === '001') {
                name = 'Tom';
                age = 29;
            }
            return {
                id,
                name,
                age,
                salary: ({ city }) => (city === 'Shenzhen' ? 2000 : 1000)
            };
        }
    };

è¾“å…¥ä»¥ä¸‹æŸ¥è¯¢

    mutation{
        createAccount(input:{name:"xx1", age:18, city:"Shenzhen"}){
            id
            name
            age
            salary(city:"Shenzhen")
        }
    }

å¾—åˆ°çš„ç»“æœ

    {
        "data": {
            "createAccount": {
            "id": "001",
            "name": "xx1",
            "age": 18,
            "salary": 2000
            }
        }
    }

# Apollo
## Apollo Server
æˆ‘ä»¬ä»ä¹‹å‰çš„æ¡ˆä¾‹é‡Œé¢å¯ä»¥çœ‹å‡ºæ¥ï¼Œå¯åŠ¨çš„graphqlæœåŠ¡æ˜¯å»ºç«‹åœ¨expressåŸºç¡€ä¸Šçš„ã€‚  
ä¸‹é¢æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªapollo-serverå¯¹æ¯”çœ‹çœ‹  
1. åˆ›å»ºé¡¹ç›®å¹¶åˆå§‹åŒ–

        mkdir apollo
        cd apollo
        npm init -y
        //é¡ºä¾¿æŠŠpackage.jsoné‡Œé¢çš„typeä¿®æ”¹æˆmoduleæ¨¡å¼ï¼Œæ”¯æŒesModule
        npm pkg set type="module"

2. å®‰è£…ä¾èµ–

        npm install @apollo/server graphql

3. åˆ›å»ºgraphqlæœåŠ¡  

        import { ApolloServer } from "@apollo/server";
        import { startStandaloneServer } from "@apollo/server/standalone";

        const typeDefs = `
            type Query {
                hello: String
            }
        `;

        const resolvers = {
            Query: {
                hello: () => "Hello, world!",
            },
        };

        const server = new ApolloServer({ typeDefs, resolvers });

        startStandaloneServer(server, {
            listen: { port: 4000 },
        }).then(({ url }) => {
            console.log(`ğŸš€  Server ready at: ${url}`);
        });

4. å¯åŠ¨æœåŠ¡ `node index.js`  
5. è®¿é—®ä¸‹`http://localhost:4000/` å°±ä¼šè¿›å…¥è¿™ä¸ªé¡µé¢
    ![apollo](https://raw.githubusercontent.com/kerwenzhang/kerwenzhang.github.io/master/_posts/image/apollo.png)
    å®ƒæ˜¯ä¸€ä¸ª`graphQL`å¯è§†åŒ–é¡µé¢ã€‚è¿™ä¸ªå¯è§†åŒ–é¡µé¢æå¤§æ–¹ä¾¿äº†æˆ‘ä»¬å†™graphQLã€‚


ä»¥ä¸‹æ˜¯ä»£ç å¯¹æ¯”  
![img](https://github.com/kerwenzhang/kerwenzhang.github.io/blob/master/_posts/image/graphql.png?raw=true)

### plugins
ApolloServerPluginDrainHttpServer  

`ApolloServerPluginDrainHttpServer` æ˜¯ Apollo Server æä¾›çš„ä¸€ä¸ªæ’ä»¶ï¼Œç”¨äºåœ¨å…³é—­ Node.js HTTP æœåŠ¡å™¨æ—¶ï¼Œä¼˜é›…åœ°å…³é—­ï¼ˆdrainï¼‰ä¸ Apollo Server ç›¸å…³çš„è¿æ¥å’Œèµ„æºã€‚  

ä¸»è¦ä½œç”¨ï¼š  
å½“ä½ è°ƒç”¨ httpServer.close() æˆ–åº”ç”¨è¿›ç¨‹é€€å‡ºæ—¶ï¼Œç¡®ä¿æ‰€æœ‰æ­£åœ¨è¿›è¡Œçš„ GraphQL è¯·æ±‚å’Œè®¢é˜…éƒ½èƒ½è¢«æ­£ç¡®å¤„ç†å’Œå…³é—­ã€‚
é˜²æ­¢æœåŠ¡å™¨â€œå¼ºåˆ¶â€å…³é—­å¯¼è‡´çš„è¯·æ±‚ä¸¢å¤±æˆ–è¿æ¥å¼‚å¸¸ã€‚  
å¸¸ç”¨äºé›†æˆ WebSocketï¼ˆå¦‚ graphql-wsï¼‰å’Œ HTTP æœåŠ¡çš„åœºæ™¯ï¼Œä¿è¯ HTTP å’Œ WebSocket éƒ½èƒ½ä¼˜é›…å…³é—­ã€‚  
ç”¨æ³•ç¤ºä¾‹ï¼š  

    import { ApolloServer } from '@apollo/server';
    import { ApolloServerPluginDrainHttpServer } from '@apollo/server/plugin/drainHttpServer';
    import http from 'http';

    const httpServer = http.createServer(app);
    const server = new ApolloServer({
        schema,
        plugins: [
            ApolloServerPluginDrainHttpServer({ httpServer }),
        ],
    });

## Apollo Client
ä¹‹å‰çš„`express+graphql`å¯åŠ¨çš„æœåŠ¡ï¼Œæˆ‘ç”¨å‰ç«¯è®¿é—®æ¥å£çš„æ—¶å€™ï¼Œç›´æ¥ç”¨çš„htmlæ–‡ä»¶ï¼Œä½¿ç”¨fetchå»è®¿é—®graphQLæœåŠ¡ã€‚  
ç°åœ¨ `appolo-client` é›†æˆäº†`react`ã€‚  
1. åˆå§‹åŒ–é¡¹ç›®, åˆ©ç”¨viteåˆ›å»ºä¸€ä¸ªreacté¡¹ç›®  

        npm create vite@latest

    é€‰æ‹©react, javascript based

2. å®‰è£…ä¾èµ–

        npm install @apollo/client graphql rxjs

3. åœ¨`main.jsx`æ–‡ä»¶é›†æˆ`apollo-client`, æˆ‘ä»¬åœ¨ä¸Šé¢`apollo-server`é‡Œé¢å·²ç»åˆ›å»ºäº†ä¸€ä¸ª`graphql`æœåŠ¡ï¼Œç°åœ¨å°±å¯åŠ¨å®ƒï¼Œç„¶ååœ¨mainæ–‡ä»¶é‡Œé¢ä½¿ç”¨å®ƒ  

        import { ApolloClient, HttpLink, InMemoryCache, gql} from "@apollo/client";
        import { ApolloProvider } from "@apollo/client/react";

        const client = new ApolloClient({
            link: new HttpLink({ uri: "http://localhost:4000/" }),
            cache: new InMemoryCache(),
        });

        // Supported in React 18+
        const root = ReactDOM.createRoot(document.getElementById("root"));

        root.render(
            <ApolloProvider client={client}>
                <App />
            </ApolloProvider>
        );

4. åœ¨ç»„ä»¶é‡Œé¢ä½¿ç”¨, åœ¨`app.jsx`é‡Œé¢

        // Import everything needed to use the `useQuery` hook
        import { gql } from "@apollo/client";
        import { useQuery } from "@apollo/client/react";

        const Query_Hello = gql`
            query {
                hello
            }
        `;

        export default function App() {
            const { loading, error, data } = useQuery(Query_Hello);

            if (loading) return <p>Loading...</p>;
            if (error) return <p>Error : {error.message}</p>;

            return (
                <div>Get data from graphQL: {data.hello}</div>
            );
        }


    `Query_Hello`å°±æ˜¯`grqphql`çš„`gql`è¯­å¥ï¼Œç”¨æ¥è·å–æ•°æ®ï¼Œä»¥å‰è·å–æ•°æ®éƒ½ç”¨çš„æ˜¯`fetch`è¯·æ±‚ï¼Œç°åœ¨ä¸ç”¨äº†ï¼Œç›´æ¥ä¸€ä¸ªhookså°±è§£å†³äº†ï¼Œæ›´åŠ æ–¹ä¾¿  
`apollo-client` å°†`graphql`æœåŠ¡åœ°å€é›†ä¸­ç®¡ç†ï¼Œå°†è·å–åˆ°çš„æ•°æ®é›†ä¸­ç”±contextç®¡ç†ï¼ŒæŒ‰ç…§ ContextApiçš„æ–¹å¼å°†æ‰€æœ‰çš„å€¼åœ¨çˆ¶ç»„ä»¶é‡Œé¢ä¼ é€’å‡ºå»ã€‚åœ¨å­ç»„ä»¶é‡Œé¢ï¼Œä½¿ç”¨ `useQuery`å’Œ`useLazyQuery` é…åˆ gql è·å–æ•°æ®ã€‚  

# GraphQL In TypeScript: TypeGraphQL
TypeGraphQL æ˜¯ä¸€ä¸ªåŸºäº TypeScript çš„åº“ï¼Œç”¨äºæ„å»º GraphQL APIã€‚å®ƒåˆ©ç”¨ TypeScript çš„ç±»å‹ç³»ç»Ÿå’Œè£…é¥°å™¨è¯­æ³•ï¼Œä½¿å¾—å®šä¹‰ GraphQL schema å’Œ resolver æ›´åŠ ç›´è§‚å’Œç±»å‹å®‰å…¨ã€‚  

    @ObjectType()
    export class User {
        @Field(()=>Int)
        id: number;

        @Field()
        firstName: string;

        @Field()
        lastName: string;

        @Field(()=>Int)
        age: number;
    }

1. åˆå§‹åŒ–ä¸€ä¸ªproject

        npm init -y

2. å®‰è£…ä¾èµ–

        npm install type-graphql apollo-server reflect-metadata graphql 
        npm install typescript ts-node @types/node --save-dev

3. é…ç½®TypeScript `tscofnig.json`

        "experimentalDecorators": true,
        "emitDecoratorMetadata": true

4. ä½¿ç”¨ TypeGraphQL å®šä¹‰ GraphQL ç±»å‹ã€‚åˆ›å»ºä¸€ä¸ªç®€å•çš„ `User` ç±»å‹ã€‚

        // src/types/user.ts
        import { Field, Int, ObjectType } from "type-graphql";

        @ObjectType()
        export class User {
            @Field(()=>Int)
            id!: number;

            @Field()
            firstName!: string;

            @Field()
            lastName!: string;

            @Field(()=>Int)
            age!: number;
        }

5. åˆ›å»ºä¸€ä¸ª `UserResolver` æ¥å¤„ç†ç”¨æˆ·ç›¸å…³çš„ GraphQL æŸ¥è¯¢ã€‚  

        // src/resolvers/userResolver.ts
        import { Query, Resolver, Arg, Mutation,Int} from "type-graphql";
        import { User } from "../types/user";

        @Resolver()
        export class UserResolver{
            private users: User[] = [
                {id:1, firstName:"John", lastName:"Doe", age:25},
                {id:2, firstName:"Jane", lastName:"Smith", age:30}
            ];

            @Query(() => [User])
            getUsers(): User[]{
                return this.users;
            }

            @Query(() => User, {nullable:true})
            getUser(@Arg("id", () => Int) id: number): User | undefined{
                return this.users.find(user => user.id === id);
            }

            @Mutation(() => User)
            createUser(
                @Arg("firstName") firstName: string, 
                @Arg("lastName") lastName: string, 
                @Arg("age", () => Int) age: number
            ): User{
                const newUser: User = {
                    id: this.users.length + 1,
                    firstName,
                    lastName,
                    age
                };
                this.users.push(newUser);
                return newUser;
            }
        }

6. ä½¿ç”¨ `Apollo Server` æ¥è®¾ç½® GraphQL API æœåŠ¡ã€‚

        import "reflect-metadata";
        import { ApolloServer } from "apollo-server";
        import { buildSchema } from "type-graphql";
        import { UserResolver } from "./resolvers/userResolver";


        async function bootstrap(){
            const schema = await buildSchema({
                resolvers: [UserResolver],
            });

            const server = new ApolloServer({ schema });
            server.listen(4000, () => {
                console.log("Server is running on http://localhost:4000/graphql");
            });
        }

        bootstrap();

7. åœ¨package.jsonä¸­æ·»åŠ æ–°çš„Command

        "dev": "ts-node src/index.ts"

8. è¿è¡Œå‘½ä»¤`npm run dev`, è®¿é—®`http://localhost:4000`ï¼Œå¯ä»¥çœ‹åˆ°GraphQL Sandboxç•Œé¢

ä»¥ä¸‹æ˜¯ä»£ç å¯¹æ¯”, è™½ç„¶çœ‹èµ·æ¥TypeGraphQLæ›´åŠ å¤æ‚äº†ï¼Œä½†å®ƒå¯¹schemaå’Œresolverè¿›è¡Œäº†ç±»å‹å¼ºåˆ¶æ£€æŸ¥ï¼Œæœ‰åˆ©äºä»£ç çš„ç»´æŠ¤ã€‚     
![img](https://github.com/kerwenzhang/kerwenzhang.github.io/blob/master/_posts/image/graphql2.png?raw=true)

TypeGraphQLåœ¨Githubé‡Œæä¾›äº†å¾ˆå¤šå®ä¾‹ã€‚[Github](https://github.com/MichalLytek/type-graphql/tree/v2.0.0-rc.2/examples)

# graphql-ws
`graphql-ws` æ˜¯ä¸€ä¸ªç”¨äºåœ¨ GraphQL ä¸­å®ç° WebSocket å®æ—¶è®¢é˜…ï¼ˆsubscriptionsï¼‰çš„ç°ä»£åè®®å’Œåº“ã€‚   

ä¸»è¦ä½œç”¨ï¼š  
+ è®©å‰ç«¯å’Œåç«¯é€šè¿‡ WebSocket å®ç° GraphQL çš„å®æ—¶æ•°æ®æ¨é€ï¼ˆå¦‚è®¢é˜…æ¶ˆæ¯ã€å®æ—¶æ›´æ–°ï¼‰ã€‚  
+ æ›¿ä»£æ—§çš„ `subscriptions-transport-ws`ï¼Œæ›´ç°ä»£ã€è§„èŒƒã€å…¼å®¹æ€§æ›´å¥½ã€‚  
+ æ”¯æŒ Node.jsã€æµè§ˆå™¨ç­‰å¤šç§ç¯å¢ƒã€‚  

å…·ä½“guideå¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š  
[GraphQL-WebSocket](https://the-guild.dev/graphql/ws/get-started)

# Apollo Angular
Apolloæä¾›äº†Apollo Clientåœ¨Angularç«¯çš„å®ç°ã€‚  

1. ç”Ÿæˆä¸€ä¸ªAngular project

        ng new client

2. å®‰è£…å¿…è¦ä¾èµ–

        npm i apollo-angular @apollo/client graphql

3. æ£€æŸ¥tsconfig.jsonï¼Œ @apollo/clientè¦æ±‚ES2020æˆ–æ›´é«˜ç‰ˆæœ¬ï¼š

        {
            "compilerOptions": {
                // ...
                "lib": ["es2020", "dom"],
            },
        }

4. æ›´æ–°app.config.ts, æ·»åŠ `provideHttpClient`å’Œ`provideApollo`

        import { ApplicationConfig, inject, provideZoneChangeDetection } from '@angular/core';
        import { provideRouter } from '@angular/router';
        import { routes } from './app.routes';

        import { provideApollo } from 'apollo-angular';
        import { HttpLink } from 'apollo-angular/http';
        import { InMemoryCache } from '@apollo/client/cache/inmemory/inMemoryCache';
        import { provideHttpClient } from '@angular/common/http';

        export const appConfig: ApplicationConfig = {
            providers: [
                provideZoneChangeDetection({ eventCoalescing: true }), provideRouter(routes),
                provideHttpClient(),

                provideApollo(() => {
                    const httpLink = inject(HttpLink);
                    return {
                        link: httpLink.create({ uri: 'http://localhost:4000/graphql' }),
                        cache: new InMemoryCache(),
                    }
                })
            ]
        };

    é€šè¿‡`HttpLink`æœåŠ¡ï¼Œå°†clientä¸GraphQL Serverè”ç³»èµ·æ¥ã€‚è¿™æ®µä»£ç è·ŸReacté‡Œçš„å¾ˆåƒã€‚  

5. åœ¨`app.component.ts`é‡ŒQueryæ•°æ®

        export class AppComponent implements OnInit {
            title = 'client';
            data: any;
            loading = true;
            error: any;

            constructor(private readonly apollo: Apollo) {}

            ngOnInit(): void {
                this.apollo.watchQuery({
                    query: gql`
                        {
                        hello
                        }
                    `
                })
                .valueChanges.subscribe((result: any) => {
                    this.data = result.data;
                    this.loading = result.loading;
                    this.error = result.error;
                });
            }
        }


    `Apollo` æ˜¯ä¸€ä¸ªç”± apollo-angular å¯¼å‡ºçš„ Angular æœåŠ¡ï¼Œç”¨äºåœ¨ UI ä¸­å…±äº« GraphQL æ•°æ®ã€‚  
    é¦–å…ˆï¼Œä½¿ç”¨ `gql` å‡½æ•°åŒ…è£…GraphQL æŸ¥è¯¢è¯­å¥ï¼Œå°†å…¶ä¼ é€’ç»™ Apollo.watchQuery æ–¹æ³•çš„ query å±æ€§ã€‚  
    watchQuery æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª `QueryRef` å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…·æœ‰ä¸€ä¸ª `valueChanges` å±æ€§ï¼Œå®ƒæœ¬èº«æ˜¯ä¸€ä¸ª Observableã€‚  
    é€šè¿‡ Observable ä¼ é€’çš„å¯¹è±¡åŒ…å« `loading`ã€`error` å’Œ `data` å±æ€§ã€‚Apollo Client ä¼šè‡ªåŠ¨è·Ÿè¸ªé”™è¯¯å’ŒåŠ è½½çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€ä¼šåæ˜ åœ¨ loading å’Œ error å±æ€§ä¸­ã€‚ä¸€æ—¦æŸ¥è¯¢ç»“æœè¿”å›ï¼Œå®ƒå°†é™„åŠ åœ¨ data å±æ€§ä¸Šã€‚  

6. ä¿®æ”¹`app.component.html`ï¼Œåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºdata

        @if (loading) {
            <div>Loading...</div>
        }
        @if (error) {
            <div>Error :(</div>
        }
        @if (data) {
            Get New Data from Apollo GraphQL:
            <p>{{data.hello}}</p>
        }

7. è¿è¡Œæˆ‘ä»¬ä¹‹å‰ç”Ÿæˆçš„Apollo Serverï¼Œ`npm run start`è¿è¡Œclient

# CodeGen
`GraphQL Code Generator` æ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œæ—¨åœ¨å¸®åŠ©æˆ‘ä»¬å……åˆ†å‘æŒ¥ GraphQL æŠ€æœ¯æ ˆçš„ä¼˜åŠ¿ã€‚

å®ƒå¯ä»¥è‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹å†…å®¹ï¼Œä»åç«¯åˆ°å‰ç«¯ï¼š

+ ç”¨äº Reactã€Vueã€Angularã€Next.jsã€Svelte çš„ç±»å‹åŒ–æŸ¥è¯¢ï¼ˆQueriesï¼‰ã€å˜æ›´ï¼ˆMutationsï¼‰å’Œè®¢é˜…ï¼ˆSubscriptionsï¼‰ï¼Œæ”¯æŒ Apollo Clientã€URQL æˆ– React Queryã€‚  
+ ç”¨äº Node.jsï¼ˆå¦‚ GraphQL Yogaã€GraphQL Modulesã€TypeGraphQL æˆ– Apolloï¼‰æˆ– Java GraphQL æœåŠ¡å™¨çš„ç±»å‹åŒ–è§£æå™¨ï¼ˆResolversï¼‰ã€‚  
+ å®Œå…¨ç±»å‹åŒ–çš„ Node.js SDKã€Apollo Android æ”¯æŒç­‰ã€‚  

æˆ‘ä»¬ä»¥ä»¥ä¸‹ `TypeGraphQL`ç« èŠ‚ä¸­çš„ schema ä¸ºä¾‹ï¼š  

    type Hello {
        result!: string;
    }

    type SayHelloQuery {
        sayHello: Hello
    }

åœ¨æ²¡æœ‰ GraphQL Code Generator çš„æƒ…å†µä¸‹ï¼Œå‰ç«¯é€šå¸¸ä¼šè¿™æ ·æŸ¥è¯¢ APIï¼š  

    const GET_POSTS = gql`
        query SayHello {
            sayHello {
                result
            }
        }
    `

    interface Hello {
        result: string
    }

æ‰‹åŠ¨ç»´æŠ¤ç±»å‹æˆ–ç¼ºå°‘ç±»å‹ä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ï¼š  
+ ç±»å‹ä¸å½“å‰ Schema ä¸ä¸€è‡´
+ æ‹¼å†™é”™è¯¯
+ æ•°æ®ç±»å‹ä¸å®Œæ•´ï¼ˆSchema ä¸­çš„å­—æ®µæœªå…¨éƒ¨æ˜ å°„ï¼‰

è¿™äº›é—®é¢˜ä¼šåœ¨å¤šä¸ªç»„ä»¶ä¸­äº§ç”Ÿè¿é”ååº”ã€‚è‡ªåŠ¨ç”Ÿæˆ GraphQL æ“ä½œçš„ç±»å‹å¯ä»¥æ˜¾è‘—æå‡å¼€å‘ä½“éªŒå’Œç³»ç»Ÿç¨³å®šæ€§ã€‚  
ä½¿ç”¨CodeGenåï¼Œæ— éœ€å†æ‰‹åŠ¨ç»´æŠ¤ TypeScript ç±»å‹   
å‰ç«¯å¼€å‘è€…å°†è·å¾—ï¼š  
+ å®æ—¶æ›´æ–°çš„ç±»å‹å®šä¹‰
+ æŸ¥è¯¢ã€å˜æ›´ã€è®¢é˜…çš„è‡ªåŠ¨è¡¥å…¨
+ æ›´å°‘çš„æ ·æ¿ä»£ç ï¼ˆå¦‚è‡ªåŠ¨ç”Ÿæˆ React hooksï¼‰


1. å®‰è£…ä¾èµ–ï¼š

        npm i graphql
        npm i -D typescript
        npm i -D @graphql-codegen/cli
        npm i -D @graphql-codegen/typescript
        npm i -D @graphql-codegen/typescript-operations
        npm i -D @graphql-codegen/typescript-apollo-angular

2. åœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆ`codegen.ts`æ–‡ä»¶

        import type { CodegenConfig } from '@graphql-codegen/cli';

        const config: CodegenConfig = {
            schema: 'http://localhost:4000/graphql',
            documents: 'src/gql/*.graphql',
            generates: {
                './src/gql/generated.ts': {
                    plugins: ['typescript', 'typescript-operations', 'typescript-apollo-angular']
                }
            }
        };

        export default config;

3. å°†æˆ‘ä»¬åœ¨Apollo Sandboxé‡Œç”Ÿæˆçš„Queryè¯­å¥ä¿å­˜åœ¨`src\gql\hello.graphql`æ–‡ä»¶ä¸­

        query SayHello {
            sayHello {
                result
            }
        }


4. æ›´æ–°`package.json`ï¼Œæ·»åŠ generateå‘½ä»¤

        {
            "scripts": {
                "generate": "graphql-codegen"
            }
        }

5. å°†`TypeGraphQL`ç« èŠ‚ä¸­çš„Serverè·‘èµ·æ¥ï¼Œ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è‡ªåŠ¨ç”Ÿæˆ `generated.ts`æ–‡ä»¶

        npm run generate 

6. æˆ‘ä»¬çœ‹ä¸€ä¸‹ç”Ÿæˆçš„`generated.ts`æ–‡ä»¶  

        export type Hello = {
            __typename?: 'Hello';
            result: Scalars['String']['output'];
        };

        export type Query = {
            __typename?: 'Query';
            sayHello: Hello;
        };


        export type SayHelloQuery = { __typename?: 'Query', sayHello: { __typename?: 'Hello', result: string } };

        export const SayHelloDocument = gql`
            query SayHello {
                sayHello {
                    result
                }
            }
            `;

        @Injectable({
            providedIn: 'root'
        })
        export class SayHelloGQL extends Apollo.Query<SayHelloQuery, SayHelloQueryVariables> {
            document = SayHelloDocument;
            
            constructor(apollo: Apollo.Apollo) {
            super(apollo);
            }
        }

    `CodeGen`è‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆäº†`SayHelloGQL`å’Œ`SayHelloQuery`

7. æ›´æ–°source code ç›´æ¥å¼•ç”¨å®ƒä¿©

        // BE SURE TO USE Observable from `rxjs` and not from `@apollo/client/core` when using map
        import { Observable } from 'rxjs';
        import { map} from 'rxjs/operators';
        import { SayHelloGQL, SayHelloQuery } from '../gql/generated';
        
        @Component({
            /* â€¦ */
        })
        export class AppComponent{
            title = 'client';
            data: any
            loading = true;
            error: any;
            sayHelloQuery: Observable<SayHelloQuery['sayHello']>;

            constructor(private readonly sayHelloGQL: SayHelloGQL) {
                this.sayHelloQuery = sayHelloGQL.watch().valueChanges.pipe(
                    map(result => result.data.sayHello)
                );
                this.sayHelloQuery.subscribe(result => {
                    this.data = result.result;
                    this.loading = false;
                });
            }
        }

çœ‹èµ·æ¥å¥½åƒæ›´éº»çƒ¦äº†æ˜¯ä¸ï¼Œåœ¨æˆ‘ä»¬çš„Hello Demoé‡Œç¡®å®æ˜¯ç”»è›‡æ·»è¶³ï¼Œä½†å¦‚æœæˆ‘ä»¬Serverç«¯çš„schemaå¤æ‚èµ·æ¥ï¼Œä¸å†æ˜¯

    Hello {
        result
    }

è€Œæ˜¯æ›´åŠ å¤æ‚çš„ï¼Œæ¯”å¦‚ï¼š

    Posts {
      id
      title
      author {
        id
        firstName
        lastName
      }
      ...
    }

å½“æˆ‘ä»¬ä»Serverç«¯æŸ¥è¯¢åˆ°è¿™æ ·çš„æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨å®ƒï¼Œé‚£åœ¨Clientç«¯ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰æ¥å£

    interface Post {
        id: string
        title: string
        author?: {
            id: string
            firstName: string
            lastName: string
        }
        ...
    }

è¿™ä¸ªæ¥å£æ˜¯ä¸æ˜¯å’ŒServerç«¯Schemaå¾ˆç›¸ä¼¼ã€‚å¦‚æœServer schemaé‡Œæœ‰æˆç™¾ä¸Šåƒä¸ªå±æ€§å‘¢ï¼Ÿä½¿ç”¨CodeGenèƒ½è‡ªåŠ¨ç”Ÿæˆè¿™äº›æ¥å£ï¼Œç®€åŒ–äº†Clientç«¯çš„å·¥ä½œã€‚  

# Reference
[ä½¿ç”¨GraphQLå’ŒApolloæ„å»ºAngular ToDoåº”ç”¨](https://blog.csdn.net/weixin_32480007/article/details/148592021)  
[GraphQLçœŸé¦™å…¥é—¨æ•™ç¨‹](https://juejin.cn/post/6844903841813495822)    
[è‡ªåŠ¨ç”ŸæˆGraphQLæ¥å£æ–‡ä»¶çš„æ­¥éª¤](https://blog.csdn.net/qq_31851435/article/details/102853649)  
[GraphQL çš„ æ­£ç¡®æ‰“å¼€æ–¹å¼ ï¼ˆapollo-clientå‰æˆï¼‰](https://juejin.cn/post/7426239502011105280)  
[apollo-client å’Œ apollo-serverçš„æ­£ç¡®æ‰“å¼€æ–¹å¼](https://juejin.cn/post/7426389669526372352)  
[Apollo_Angular_GraphQl_Start](https://github.com/stevelaclasse/Apollo_Angular_GraphQl_Start)  
[Angular Integration with GraphQL: Complete Guide to Setup and Usage](https://medium.com/@erickzanetti/angular-integration-with-graphql-complete-guide-to-setup-and-usage-6f16e5657dc4)   
[Complete guide to GraphQL in Angular](https://signoz.io/blog/angular-graphql/)   
[Apollo Server](https://www.apollographql.com/docs/apollo-server/getting-started)  
[Apollo Client](https://www.apollographql.com/docs/react)  
[TypeGraphQL](https://typegraphql.com/)  
[TypeGraphQL examples](https://github.com/MichalLytek/type-graphql/tree/v2.0.0-rc.2/examples)  
[TypeScript + GraphQL = TypeGraphQL](https://zhuanlan.zhihu.com/p/56516614)  
[TypeScript ä¸ GraphQL çš„ç»“åˆåº”ç”¨](https://blog.51cto.com/u_14540126/11082618)  
[å¦‚ä½•ä½¿ç”¨TypeScriptå’ŒGraphQLå¼€å‘åº”ç”¨](https://developer.aliyun.com/article/925988)  
[GraphQLï¼šæ·±å…¥ç†è§£GraphQLè®¢é˜…åŠŸèƒ½](https://zhuanlan.zhihu.com/p/711830509)   
[GraphQL-WebSocket](https://the-guild.dev/graphql/ws/get-started)     
[Apollo Angular](https://the-guild.dev/graphql/apollo-angular/docs)   
[CodeGen Getting start](https://the-guild.dev/graphql/codegen/docs/getting-started)   
[CodeGen Angular](https://the-guild.dev/graphql/codegen/docs/guides/angular)   
